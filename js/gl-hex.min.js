"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),VERTICES_PER_HEX=6,ScaleToFit={FitCenter:0,Fill:1,FitEnd:2,FitStart:3},Point=function(){function t(e,i){_classCallCheck(this,t),this.x=e,this.y=i}return _createClass(t,[{key:"isInside",value:function(t,e,i,n){return e>this.y!=n>this.y&&this.x<(i-t)*(this.y-e)/(n-e)+t}},{key:"offset",value:function(t,e){this.x+=t,this.y+=e}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"{x: "+this.x+", y: "+this.y+"}"}}],[{key:"fromPoint",value:function(e){return new t(e.x,e.y)}},{key:"midpointOf",value:function(e,i){var n=.5*(e.x+i.x),s=.5*(e.y+i.y);return new t(n,s)}}]),t}(),Vec2=function(){function t(e,i){_classCallCheck(this,t),this.x=e,this.y=i}return _createClass(t,[{key:"len",value:function(){return Math.sqrt(this.len2())}},{key:"len2",value:function(){return this.x*this.x+this.y*this.y}},{key:"normalize",value:function(){this.divScalar(this.len())}},{key:"mulScalar",value:function(t){this.x*=t,this.y*=t}},{key:"divScalar",value:function(t){this.x/=t,this.y/=t}},{key:"add",value:function(t){this.x+=t.x,this.y+=t.y}},{key:"subtract",value:function(t){this.x-=t.x,this.y-=t.y}},{key:"multiply",value:function(t){this.x*=t.x,this.y*=t.y}},{key:"divide",value:function(t){this.x/=t.x,this.y/=t.y}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"invert",value:function(){this.x=-this.x,this.y=-this.y}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"{x: "+this.x+", y: "+this.y+" len: "+this.len()+"}"}}],[{key:"from",value:function(e,i){return new t(i.x-e.x,i.y-e.y)}}]),t}(),Rect=function(){function t(e,i,n,s){_classCallCheck(this,t),this.left=e,this.top=i,this.right=n,this.bottom=s}return _createClass(t,[{key:"set",value:function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom}},{key:"setLTRB",value:function(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n}},{key:"setLBRT",value:function(t,e,i,n){this.left=t,this.top=n,this.right=i,this.bottom=e}},{key:"setLRBT",value:function(t,e,i,n){this.left=t,this.top=n,this.right=e,this.bottom=i}},{key:"setEmpty",value:function(){this.left=0,this.top=0,this.right=0,this.bottom=0}},{key:"setUnion",value:function(t,e,i){this.left=this.right=t[e++],this.top=this.bottom=t[e++],this.unionPoints(t,e,i-1)}},{key:"sort",value:function(){if(this.bottom>this.top){var t=this.top;this.top=this.bottom,this.bottom=t}if(this.left>this.right){var e=this.right;this.right=this.left,this.left=e}}},{key:"isEmpty",value:function(){this.left>=this.right||this.bottom>=this.top}},{key:"isValid",value:function(){return this.right>=this.left&&this.top>=this.bottom}},{key:"width",value:function(){return this.right-this.left}},{key:"height",value:function(){return this.top-this.bottom}},{key:"area",value:function(){return width()*height()}},{key:"topLeft",value:function(){return new Point(this.left,this.top)}},{key:"bottomLeft",value:function(){return new Point(this.left,this.bottom)}},{key:"bottomRight",value:function(){return new Point(this.right,this.bottom)}},{key:"topRight",value:function(){return new Point(this.right,this.top)}},{key:"center",value:function(){return new Point(this.centerX(),this.centerY())}},{key:"centerX",value:function(){return.5*(this.left+this.right)}},{key:"centerY",value:function(){return.5*(this.bottom+this.top)}},{key:"containsRect",value:function(t){return this.left<=t.left&&t.right<=this.right&&this.bottom<=t.bottom&&t.top<=this.top}},{key:"containsPoint",value:function(t){return this.contains(t.x,t.y)}},{key:"contains",value:function(t,e){return this.left<=t&&t<=this.right&&this.bottom<=e&&e<=this.top}},{key:"unionRect",value:function(t){this.left=Math.min(this.left,t.left),this.right=Math.max(this.right,t.right),this.bottom=Math.min(this.bottom,t.bottom),this.top=Math.max(this.top,t.top)}},{key:"unionPoints",value:function(t,e,i){for(var n=0;i>n;n++)this.union(t[e++],t[e++])}},{key:"unionPoint",value:function(t){this.union(t.x,t.y)}},{key:"union",value:function(t,e){this.left=Math.min(t,this.left),this.top=Math.max(e,this.top),this.right=Math.max(t,this.right),this.bottom=Math.min(e,this.bottom)}},{key:"intersectRect",value:function(t){this.left=Math.max(this.left,t.left),this.right=Math.min(this.right,t.right),this.bottom=Math.max(this.bottom,t.bottom),this.top=Math.min(this.top,t.top)}},{key:"intersectsRect",value:function(t){return this.right>=t.left&&t.right>=this.left&&this.top>=t.bottom&&t.top>=this.bottom}},{key:"intersectsRectByPercent",value:function(e,i){var n=t.fromIntersection(this,e);return n.isValid()&&n.area/e.area>=i}},{key:"offset",value:function(t,e){this.left+=t,this.top+=e,this.right+=t,this.bottom+=e}},{key:"inset",value:function(t,e){this.left+=t,this.top-=e,this.right-=t,this.bottom+=e}},{key:"mulScalar",value:function(t){this.left*=t,this.top*=t,this.right*=t,this.bottom*=t}},{key:"divScalar",value:function(t){this.left/=t,this.top/=t,this.right/=t,this.bottom/=t}},{key:"draw",value:function(t){this.strokeColor&&this.lineWidth&&(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeColor,t.strokeRect(this.left,this.bottom,this.width(),this.height())),this.fillColor&&(t.fillStyle=this.fillColor,t.fillRect(this.left,this.bottom,this.width(),this.height()))}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"{bottom: "+this.bottom+", left: "+this.left+", width: "+this.width()+", height: "+this.height()+", isValid: "+this.isValid()+"}"}}],[{key:"fromRect",value:function(e){return new t(e.left,e.top,e.right,e.bottom)}},{key:"fromLBRT",value:function(e,i,n,s){return new t(e,s,n,i)}},{key:"fromLRBT",value:function(e,i,n,s){return new t(e,s,i,n)}},{key:"fromTwoPoints",value:function(e,i){var n=new t(e.x,e.y,e.x,e.y);return n.unionPoint(i),n}},{key:"fromUnion",value:function(e,i,n){var s=new t(0,0,0,0);return s.setUnion(e,i,n),s}},{key:"fromIntersection",value:function(e,i){var n=t.fromRect(e);return n.intersectRect(i),n}},{key:"fromDimensions",value:function(e,i,n,s){return new t(e,i+s,e+n,i)}}]),t}(),Color=function(){function t(e,i,n){_classCallCheck(this,t),this.r=e,this.g=i,this.b=n}return _createClass(t,[{key:"setRGB",value:function(t,e,i){this.r=t,this.g=e,this.b=i}},{key:"setColor",value:function(t){this.r=t.r,this.g=t.g,this.b=t.b}},{key:"setHex",value:function(t){this.r=t>>16&255,this.g=t>>8&255,this.b=t>>0&255}},{key:"setHexString",value:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);this.r=parseInt(e[1],16),this.g=parseInt(e[2],16),this.b=parseInt(e[3],16)}},{key:"setRandom",value:function(){this.r=getRandomInt(0,255),this.g=getRandomInt(0,255),this.b=getRandomInt(0,255)}},{key:"equals",value:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}},{key:"toHex",value:function(){return this.r<<16|this.g<<8|this.b}},{key:"toHexString",value:function(){var t=(1<<24|this.toHex()).toString(16);return"#"+t.slice(1)}},{key:"toString",value:function(){return"{r: "+this.r+", g: "+this.g+", b: "+this.b+"}"}}],[{key:"fromHex",value:function(e){var i=new t;return i.setHex(e),i}},{key:"fromHexString",value:function(e){var i=new t;return i.setHexString(e),i}},{key:"random",value:function(){var e=new t;return e.setRandom(),e}}]),t}(),Matrix=function(){function t(e,i,n,s,o,r){_classCallCheck(this,t),this.m11=e,this.m12=i,this.m13=n,this.m21=s,this.m22=o,this.m23=r}return _createClass(t,[{key:"determinant",value:function(){return this.m11*this.m22-this.m12*this.m21}},{key:"inverse",value:function(){var e=1/this.determinant(),i=this.m22*e,n=-this.m12*e,s=(this.m12*this.m23-this.m13*this.m22)*e,o=-this.m21*e,r=this.m11*e,h=(this.m21*this.m13-this.m11*this.m23)*e;return new t(i,n,s,o,r,h)}},{key:"moveOrigin",value:function(t,e){this.preTranslate(-t,-e),this.postTranslate(t,e)}},{key:"postConcat",value:function(t){this.setConcat(t,this)}},{key:"preConcat",value:function(t){this.setConcat(this,t)}},{key:"postRotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.m11,s=this.m12,o=this.m13;this.m11=i*n-e*this.m21,this.m12=i*s-e*this.m22,this.m13=i*o-e*this.m23,this.m21=e*n+i*this.m21,this.m22=e*s+i*this.m22,this.m23=e*o+e*this.m23}},{key:"preRotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.m11,s=this.m21;this.m11=n*i+this.m12*e,this.m21=s*i+this.m22*e,this.m12=n*-e+this.m12*i,this.m22=s*-e+this.m22*i}},{key:"postScale",value:function(t,e){this.m11*=t,this.m12*=t,this.m13*=t,this.m21*=e,this.m22*=e,this.m23*=e}},{key:"preScale",value:function(t,e){this.m11*=t,this.m21*=t,this.m12*=e,this.m22*=e}},{key:"postStretch",value:function(t){this.postScale(t,t)}},{key:"preStretch",value:function(t){this.preScale(t,t)}},{key:"postTranslate",value:function(t,e){this.m13+=t,this.m23+=e}},{key:"preTranslate",value:function(t,e){this.m13+=this.m11*t+this.m12*e,this.m23+=this.m21*t+this.m22*e}},{key:"set",value:function(t,e,i,n,s,o){this.m11=t,this.m12=e,this.m13=i,this.m21=n,this.m22=s,this.m23=o}},{key:"setConcat",value:function(t,e){this.set(t.m11*e.m11+t.m12*e.m21,t.m11*e.m12+t.m12*e.m22,t.m11*e.m13+t.m12*e.m23+t.m13,t.m21*e.m11+t.m22*e.m21,t.m21*e.m12+t.m22*e.m22,t.m21*e.m13+t.m22*e.m23+t.m23)}},{key:"setIdentity",value:function(){this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0}},{key:"setRectToRect",value:function(t,e,i){var n=void 0,s=void 0;switch(i){case ScaleToFit.FitCenter:n=t.center(),s=e.center();break;case ScaleToFit.FitEnd:n=t.bottomRight(),s=e.bottomRight();break;default:n=t.topLeft(),s=e.topLeft()}var o=e.width()/t.width(),r=e.height()/t.height();this.setTranslate(-n.x,-n.y),i===ScaleToFit.Fill?this.postScale(o,r):this.postStretch(Math.min(o,r)),this.postTranslate(s.x,s.y)}},{key:"setRotate",value:function(t){var e=Math.sin(t),i=Math.cos(t);this.setSinCos(e,i)}},{key:"setSinCos",value:function(t,e){this.m11=e,this.m12=-t,this.m13=0,this.m21=t,this.m22=e,this.m23=0}},{key:"setScale",value:function(t,e){this.m11=t,this.m12=0,this.m13=0,this.m21=0,this.m22=e,this.m23=0}},{key:"setStretch",value:function(t){this.setScale(t,t)}},{key:"setTranslate",value:function(t,e){this.m11=1,this.m12=0,this.m13=t,this.m21=0,this.m22=1,this.m23=e}},{key:"mapPoint",value:function(t,e){e="undefined"!=typeof e?e:t;var i=this.mapX(t.x,t.y),n=this.mapY(t.x,t.y);e.x=i,e.y=n}},{key:"mapPoints",value:function(t,e,i,n,s){for(var o=0;s>o;o++){var r=t[e++],h=t[e++];i[n++]=this.mapX(r,h),i[n++]=this.mapY(r,h)}}},{key:"mapRect",value:function(t,e){e="undefined"!=typeof e?e:t;var i=t.topLeft(),n=t.bottomLeft(),s=t.bottomRight(),o=t.topRight();this.mapPoint(i),this.mapPoint(n),this.mapPoint(s),this.mapPoint(o),e.left=e.right=i.x,e.top=e.bottom=i.y,e.unionPoint(n),e.unionPoint(s),e.unionPoint(o)}},{key:"mapX",value:function(t,e){return this.m11*t+this.m12*e+this.m13}},{key:"mapY",value:function(t,e){return this.m21*t+this.m22*e+this.m23}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"m11: "+this.m11+", m12: "+this.m12+", m13: "+this.m13+", m21: "+this.m21+", m22: "+this.m22+", m23: "+this.m23}}],[{key:"identity",value:function(){return new t(1,0,0,0,1,0)}},{key:"rectToRect",value:function(e,i,n){var s=new t;return s.setRectToRect(e,i,n),s}},{key:"rotateAboutOrigin",value:function(e){var i=new t;return i.setRotate(e),i}},{key:"rotateByAngle",value:function(e,i){var n=Math.sin(i),s=Math.cos(i);return t.rotateBySinCos(e,n,s)}},{key:"rotateBySinCos",value:function(e,i,n){var s=new t;return s.setSinCos(i,n),s.moveOrigin(e.x,e.y),s}},{key:"rotateFrom",value:function(e,i,n){var s=Vec2.from(e,i),o=Vec2.from(e,n);s.normalize(),o.normalize();var r=s.cross(o),h=s.dot(o);return t.rotateBySinCos(e,r,h)}},{key:"scaleAboutOrigin",value:function(e,i){var n=new t;return n.setScale(e,i),n}},{key:"scaleByRatios",value:function(e,i,n){var s=new t;return s.setScale(i,n),s.moveOrigin(e.x,e.y),s}},{key:"scaleFrom",value:function(e,i,n){var s=(n.x-e.x)/(i.x-e.x),o=(n.y-e.y)/(i.y-e.y);return t.scaleByRatios(e,s,o)}},{key:"stretchAboutOrigin",value:function(e){var i=new t;return i.setStretch(e),i}},{key:"stretchByRatio",value:function(e,i){return t.scaleByRatios(e,i,i)}},{key:"stretchFrom",value:function(e,i,n){var s=Vec2.from(e,i).len(),o=Vec2.from(e,n).len(),r=o/s;return t.stretchByRatio(e,r)}},{key:"stretchRotateFrom",value:function(e,i,n){var s=Vec2.from(e,i),o=Vec2.from(e,n),r=s.len(),h=o.len(),a=h/r;s.mulScalar(1/r),o.mulScalar(1/h);var u=s.cross(o),l=s.dot(o),c=new t;return c.setSinCos(u,l),c.postStretch(a),c.moveOrigin(e.x,e.y),c}},{key:"translate",value:function(e,i){return new t(1,0,e,0,1,i)}},{key:"mult",value:function(e,i){var n=new t;return n.setConcat(e,i),n}}]),t}(),Path=function(){function t(e){_classCallCheck(this,t),this.data=e,this.capacity=e.length/2,this.count=0}return _createClass(t,[{key:"put",value:function(t,e){this.set(t,e,this.count++)}},{key:"putPoint",value:function(t){this.setPoint(t,this.count++)}},{key:"putPath",value:function(t){this.putData(t.data)}},{key:"putData",value:function(t){this.setData(t,this.count),this.count+=t.length/2}},{key:"set",value:function(t,e,i){var n=2*i;this.data[n]=t,this.data[n+1]=e}},{key:"setPoint",value:function(t,e){this.set(t.x,t.y,e)}},{key:"setPath",value:function(t,e){this.setData(t.data,e)}},{key:"setData",value:function(t,e){this.data.set(t,2*this.offset)}},{key:"pointAt",value:function(t){var e=2*t,i=this.data[e],n=this.data[e+1];return new Point(i,n)}},{key:"pointBetween",value:function(t,e){return Point.midpointOf(this.pointAt(t),this.pointAt(e))}},{key:"calculateBounds",value:function(){return Rect.fromUnion(this.data,0,this.count)}},{key:"calculateBoundsOfSubset",value:function(t,e){return Rect.fromUnion(this.data,2*t,e)}},{key:"containsPoint",value:function(t){return this.containsPointInSubset(t,0,this.count)}},{key:"containsPointInSubset",value:function(t,e,i){for(var n=!1,s=e,o=i-1;i>s;o=s++){var r=this.pointAt(o),h=this.pointAt(s);t.isInside(r.x,r.y,h.x,h.y)&&(n=!n)}return n}},{key:"translate",value:function(t,e){for(var i=0;i<this.data.length;)this.data[i++]+=t,this.data[i++]+=e}},{key:"transform",value:function(t){t.mapPoints(this.data,0,this.data,0,this.count)}},{key:"transformSubset",value:function(t,e,i){t.mapPoints(this.data,2*e,this.data,2*e,i)}},{key:"draw",value:function(t){t.beginPath(),t.moveTo(this.data[0],this.data[1]);for(var e=2;e<this.data.length;)t.lineTo(this.data[e++],this.data[e++]);t.closePath(),this.strokeColor&&(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeColor,t.stroke()),this.fillColor&&(t.fillStyle=this.fillColor,t.fill())}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"{capacity: "+this.capacity+", count: "+this.count+", data: "+this.data+"}"}}],[{key:"fromPath",value:function(e){var i=new Float32Array(e.data),n=new t(i);return n.count=e.count,n}},{key:"withCapacity",value:function(e){var i=2*e,n=i*Float32Array.BYTES_PER_ELEMENT,s=new ArrayBuffer(n),o=new Float32Array(s,0,i);return new t(o)}}]),t}(),Mesh=function(){function t(e,i,n){_classCallCheck(this,t),this.path=e,this.bounds=e.calculateBounds(),this.fixedPoint=i,this.controlPoint=n}return _createClass(t,[{key:"contains",value:function(t){return this.bounds.containsPoint(t)&&this.path.containsPoint(t)}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"path: "+this.path.toString()+", bounds: "+this.bounds.toString()+",\n                    fixedPoint: "+this.fixedPoint+", controlPoint: "+this.controlPoint}}],[{key:"nGon",value:function(e){var i=Path.withCapacity(e),n=new Point(0,-100);i.putPoint(n);for(var s=Matrix.rotateAboutOrigin(2*Math.PI/e);i.count<i.capacity;)s.mapPoint(n),i.putPoint(n);var o=i.pointAt(0),r=Math.floor(e/2),h=1&e?i.pointBetween(r,r+1):i.pointAt(r);return new t(i,o,h)}},{key:"nStar",value:function(e,i,n){var s=Path.withCapacity(e+e),o=2*Math.PI/e,r=new Matrix,h=new Point(0,-n);s.putPoint(h);var a=new Point(0,-i);for(r.setRotate(.5*o),r.mapPoint(a),s.putPoint(a),r.setRotate(o);s.count<s.capacity;)r.mapPoint(h),s.putPoint(h),r.mapPoint(a),s.putPoint(a);var u=s.pointAt(0),l=1&e?s.pointBetween(e-1,e+1):s.pointAt(e);return new t(s,u,l)}},{key:"bat",value:function(){var e=Path.withCapacity(20);e.put(0,3),e.put(-2,5),e.put(-3,2),e.put(-5,0),e.put(-8,3),e.put(-10,7),e.put(-17,10),e.put(-13,5),e.put(-12,-1),e.put(-3,-7),e.put(0,-10),e.put(3,-7),e.put(12,-1),e.put(13,5),e.put(17,10),e.put(10,7),e.put(8,3),e.put(5,0),e.put(3,2),e.put(2,5),e.transform(Matrix.scaleAboutOrigin(1,-1));var i=e.pointBetween(1,19),n=e.pointAt(10);return new t(e,i,n)}},{key:"heart",value:function(){var e=Path.withCapacity(10);e.put(0,12),e.put(-3,16),e.put(-5,16),e.put(-8,12),e.put(-8,8),e.put(0,0),e.put(8,8),e.put(8,12),e.put(5,16),e.put(3,16);var i=e.pointBetween(1,9),n=e.pointAt(5);return new t(e,i,n)}},{key:"flower",value:function(){var e=Path.withCapacity(20);e.put(0,-2),e.put(-1,-1),e.put(-2,-1),e.put(-2,-2),e.put(-3,-3),e.put(-1,-3),e.put(-2,-4),e.put(-2,-5),e.put(-1,-5),e.put(0,-6),e.put(0,-4),e.put(1,-5),e.put(2,-5),e.put(2,-4),e.put(3,-3),e.put(1,-3),e.put(2,-2),e.put(2,-1),e.put(1,-1),e.put(0,0);var i=e.pointAt(19),n=e.pointAt(9);return new t(e,i,n)}}]),t}(),Shape=function(){function t(e){_classCallCheck(this,t),this.mesh=e,this.matrix=Matrix.identity(),this.inverse=Matrix.identity()}return _createClass(t,[{key:"setBounds",value:function(t,e){this.matrix.setRectToRect(this.mesh.bounds,t,e),this.inverse.setRectToRect(t,this.mesh.bounds,e)}},{key:"setEndPoints",value:function(t,e){var i=Vec2.from(this.mesh.fixedPoint,t),n=Point.fromPoint(this.mesh.controlPoint);n.offset(i.x,i.y),this.matrix=Matrix.stretchRotateFrom(t,n,e),this.matrix.preTranslate(i.x,i.y),this.inverse=this.matrix.inverse()}},{key:"containsPoint",value:function(t){var e=new Point;return this.inverse.mapPoint(t,e),this.mesh.contains(e)}},{key:"draw",value:function(t){if(this.matrix){t.beginPath();var e=this.mesh.path.data,i=e[0],n=e[1];t.moveTo(this.matrix.mapX(i,n),this.matrix.mapY(i,n));for(var s=2;s<e.length;)i=e[s++],n=e[s++],t.lineTo(this.matrix.mapX(i,n),this.matrix.mapY(i,n));t.closePath(),this.strokeColor&&(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeColor,t.stroke()),this.fillColor&&(t.fillStyle=this.fillColor,t.fill())}}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"mesh: "+this.mesh.toString()+", fillColor: "+this.fillColor+", matrix: "+this.matrix}}]),t}(),DragDetector=function(){function t(e,i,n,s,o){_classCallCheck(this,t);var r=!1;e.addEventListener("mousedown",function(t){r=!0,t.preventDefault(),t.stopPropagation(),i(t)},!1),e.addEventListener("mousemove",function(t){r&&(t.preventDefault(),t.stopPropagation(),n(t))},!1),e.addEventListener("mouseup",function(t){r&&(t.preventDefault(),t.stopPropagation(),r=!1,s(t))},!1),e.addEventListener("mouseout",function(t){r&&(t.preventDefault(),t.stopPropagation(),r=!1,o(t))},!1),e.addEventListener("touchstart",function(t){r=!0,t.preventDefault(),t.stopPropagation(),i(t.touches[0])},!1),e.addEventListener("touchmove",function(t){r&&(t.preventDefault(),t.stopPropagation(),n(t.touches[0]))},!1),e.addEventListener("touchend",function(t){r&&(t.preventDefault(),t.stopPropagation(),r=!1,s(t.touches[0]))},!1),e.addEventListener("touchleave",function(t){r&&(t.preventDefault(),t.stopPropagation(),r=!1,o(t.touches[0]))},!1)}return _createClass(t,null,[{key:"getTouchPos",value:function(t,e){return this.getMousePos(t.touches[0],e)}},{key:"getMousePos",value:function(t,e){var i=e||new Point;if(t.offsetX)i.x=t.offsetX,i.y=t.offsetY;else if(t.layerX)i.x=t.layerX,i.y=t.layerY;else{var n=canvas.getBoundingClientRect();i.x=t.clientX-n.left,i.y=t.clientY-n.top}return i}}]),t}(),Cube=function(){function t(e,i,n){_classCallCheck(this,t),this.q=e,this.r=i,this.s=n||-e-i}return _createClass(t,[{key:"round",value:function(){var t=this.q,e=this.r,i=this.s;this.q=Math.round(t),this.r=Math.round(e),this.s=Math.round(i);var n=Math.abs(this.q-t),s=Math.abs(this.r-e),o=Math.abs(this.s-i);n>s&&n>o?this.q=-this.r-this.s:s>o?this.r=-this.q-this.s:this.s=-this.q-this.r}},{key:"add",value:function(t){this.q+=t.q,this.r+=t.r,this.s+=t.s}},{key:"subtract",value:function(t){this.q-=t.q,this.r-=t.r,this.s-=t.s}},{key:"distanceTo",value:function(t){return Math.max(Math.abs(this.q-t.q),Math.abs(this.r-t.r),Math.abs(this.s-t.s))}},{key:"distanceToOrigin",value:function(){return Math.max(Math.abs(this.q),Math.abs(this.r),Math.abs(this.s))}},{key:"neighbors",value:function(){for(var t=[],e=0;e<Directions.length;e++)t.push(this.neighbor(Directions[e]));return t}},{key:"neighbor",value:function(e){var i=t.fromCube(this);return i.add(e),i}},{key:"equals",value:function(t){return this.q===t.q&&this.r===t.r&&this.s===t.s}}],[{key:"fromCube",value:function(e){return new t(e.q,e.r,e.s)}}]),t}(),Directions=[new Cube(1,-1,0),new Cube(1,0,-1),new Cube(0,1,-1),new Cube(-1,1,0),new Cube(-1,0,1),new Cube(0,-1,1)],Hex=function(){function t(e,i,n){_classCallCheck(this,t),this.position=e,this.center=i,this.color=n}return _createClass(t,[{key:"equals",value:function(t){return this.color===t.color&&this.position.equals(t.position)}}]),t}(),Orientation={FlatTop:1,PointyTop:2},Grid=function(){function t(e){_classCallCheck(this,t),this.coordinates=[],this.orientation=e}return _createClass(t,[{key:"indexOf",value:function(t){for(var e=0;e<this.coordinates.length;e++)if(this.coordinates[e].equals(t))return e;return-1}},{key:"measureWidth",value:function(t,e){return 0}},{key:"measureWidth",value:function(t,e){return 0}}]),t}(),RectangleGrid=function(t){function e(t,i,n){_classCallCheck(this,e);var s=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(s.rows=i,s.cols=n,s.orientation===Orientation.FlatTop)for(var o=0;n>o;o++)for(var r=o>>1,h=-r;i-r>h;h++)s.coordinates.push(new Cube(o,h));else for(var a=0;i>a;a++)for(var u=a>>1,l=-u;n-u>l;l++)s.coordinates.push(new Cube(l,a));return s}return _inherits(e,t),_createClass(e,[{key:"indexOf",value:function(t){var e=void 0;return e=this.orientation===Orientation.FlatTop?this.rows*t.q+t.r+(t.q>>1):this.cols*t.r+t.q+(t.r>>1),e>=0&&e<this.coordinates.length&&this.coordinates[e].equals(t)?e:-1}},{key:"measureWidth",value:function(t){return this.orientation===Orientation.FlatTop?t.hexWidth*(.75*this.cols+.25):t.hexWidth*(this.cols+.5)}},{key:"measureHeight",value:function(t){return this.orientation===Orientation.FlatTop?t.hexHeight*(this.rows+.5):t.hexHeight*(.75*this.rows+.25)}}]),e}(Grid),Layout=function(){function t(e,i){_classCallCheck(this,t),this.grid=e,this.hexSize=i||1,e.orientation===Orientation.FlatTop?(this.hexWidth=2*this.hexSize,this.hexHeight=this.hexSize*Math.sqrt(3),this.hexRight=(this.hexWidth-this.hexSize)/2,this.hexUp=this.hexHeight/2):(this.hexHeight=2*this.hexSize,this.hexWidth=this.hexSize*Math.sqrt(3),this.hexRight=this.hexWidth/2,this.hexUp=(this.hexHeight-this.hexSize)/2),this.width=e.measureWidth(this),this.height=e.measureHeight(this);var n=this.width/2,s=this.height/2;this.bounds=Rect.fromLRBT(-n,n,-s,s),this.hexes=[];for(var o=0;o<e.coordinates.length;o++){var r=e.coordinates[o],h=this.findBottomLeftOfHexAt(r);h.x+=this.hexWidth/2,h.y+=this.hexHeight/2,this.hexes.push(new Hex(r,h,-1))}var a=this.hexes.length;this.vertices=this.generateVertices(a),this.indices=this.generateIndices(a),this.colors=this.generateColors(a)}return _createClass(t,[{key:"generateVertices",value:function(t){for(var e=twgl.primitives.createAugmentedTypedArray(2,VERTICES_PER_HEX*t),i=0;t>i;i++){var n=this.grid.coordinates[i];this.generateHexVertices(n,e)}return e}},{key:"generateIndices",value:function(t){for(var e=twgl.primitives.createAugmentedTypedArray(1,12*t,Uint16Array),i=0;t>i;i++){var n=i*VERTICES_PER_HEX;e.push(n,n+1,n+2,n,n+2,n+3,n,n+3,n+4,n,n+4,n+5)}return e}},{key:"generateColors",value:function(t){for(var e=twgl.primitives.createAugmentedTypedArray(3,VERTICES_PER_HEX*t,Uint8Array),i=0;t>i;i++)for(var n=0;VERTICES_PER_HEX>n;n++)e.push(235-n*n,235-n*n,235-n*n);return e}},{key:"generateHexVertices",value:function(t,e){var i=this.findBottomLeftOfHexAt(t),n=i.x,s=i.y;this.grid.orientation===Orientation.FlatTop?(e.push(n+this.hexRight+this.hexSize,s+this.hexHeight),e.push(n+this.hexRight,s+this.hexHeight),e.push(n,s+this.hexUp),e.push(n+this.hexRight,s),e.push(n+this.hexRight+this.hexSize,s),e.push(n+this.hexWidth,s+this.hexUp)):(e.push(n+this.hexRight,s+this.hexHeight),e.push(n,s+this.hexUp+this.hexSize),e.push(n,s+this.hexUp),e.push(n+this.hexRight,s),e.push(n+this.hexWidth,s+this.hexUp),e.push(n+this.hexWidth,s+this.hexUp+this.hexSize))}},{key:"findBottomLeftOfHexAt",value:function(t){var e=this.bounds.left,i=this.bounds.bottom;return this.grid.orientation===Orientation.FlatTop?(e+=t.q*this.hexWidth*.75,i+=(t.r+t.q/2)*this.hexHeight):(e+=(t.q+t.r/2)*this.hexWidth,i+=t.r*this.hexHeight*.75),new Point(e,i)}},{key:"clipToCube",value:function(t){var e=void 0,i=void 0,n=t.x-(this.hexWidth/2+this.bounds.left),s=t.y-(this.hexHeight/2+this.bounds.bottom);return this.grid.orientation===Orientation.FlatTop?(e=2*n/3/this.hexSize,i=(-n/3+Math.sqrt(3)/3*s)/this.hexSize):(e=(n*Math.sqrt(3)/3-s/3)/this.hexSize,i=2*s/3/this.hexSize),new Cube(e,i)}},{key:"indexOfHexContaining",value:function(t){var e=this.clipToCube(t);return e.round(),this.grid.indexOf(e)}},{key:"getColorIndex",value:function(t){return t*this.colors.numComponents*VERTICES_PER_HEX}},{key:"getHexagonColor",value:function(t){var e=this.hexes[t].color;return Color.fromHex(e)}},{key:"setHexagonColor",value:function(t,e,i){var n=this.hexes[t],s=n.color,o=e.toHex();if(s!==o){n.color=o,i&&i.add(t,s);for(var r=this.getColorIndex(t),h=3;6>h;h++){var a=2*h*h;this.colors[r++]=Math.min(e.r+a,255),this.colors[r++]=Math.min(e.g+a,255),this.colors[r++]=Math.min(e.b+a,255)}for(var u=3;6>u;u++){var l=2*u*u;this.colors[r++]=Math.max(e.r-l,0),this.colors[r++]=Math.max(e.g-l,0),this.colors[r++]=Math.max(e.b-l,0)}}}},{key:"addLine",value:function(t,e,i,n,s){var o=Cube.fromCube(e);o.subtract(t);for(var r=o.distanceToOrigin(),h=1/Math.max(r,1),a=0;r>=a;a++){var u=h*a,l=new Cube;l.q=t.q+o.q*u,l.r=t.r+o.r*u,l.s=t.s+o.s*u,l.round();var c=this.grid.indexOf(l);-1!==c&&this.fillRange(c,i,n,s)}}},{key:"addRect",value:function(t,e,i){for(var n=0;n<this.hexes.length;n++)t.containsPoint(this.hexes[n].center)&&this.setHexagonColor(n,e,i)}},{key:"addShape",value:function(t,e,i){for(var n=0;n<this.hexes.length;n++)t.containsPoint(this.hexes[n].center)&&this.setHexagonColor(n,e,i)}},{key:"fillRange",value:function(t,e,i,n){var s=this.hexes[t].position;this.setHexagonColor(t,i,n);for(var o=-e;e>=o;o++)for(var r=Math.max(-e,-o-e),h=Math.min(e,-o+e),a=r;h>=a;a++){var u=new Cube(o,a);u.add(s);var l=this.grid.indexOf(u);-1!==l&&this.setHexagonColor(l,i,n)}}},{key:"eraseRange",value:function(t,e){var i=this.hexes[t].position;this.eraseHexagonColor(t);for(var n=-e;e>=n;n++)for(var s=Math.max(-e,-n-e),o=Math.min(e,-n+e),r=s;o>=r;r++){var h=new Cube(n,r);h.add(i);var a=this.grid.indexOf(h);-1!==a&&this.eraseHexagonColor(a)}}},{key:"eraseHexagonColor",value:function(t){this.hexes[t].color=-1;for(var e=this.getColorIndex(t),i=0;VERTICES_PER_HEX>i;i++){var n=i*i;this.colors[e++]=235-n,this.colors[e++]=235-n,this.colors[e++]=235-n}}},{key:"floodFill",value:function(t,e){var i=this.hexes[t],n=i.color,s=e.toHex();if(n!==s){this.setHexagonColor(t,e);var o=new Set,r=[];for(r.push(i.position);r.length>0;)for(var h=r.shift(),a=h.neighbors(),u=0;u<a.length;u++){var l=a[u],c=this.grid.indexOf(l);if(-1!=c&&!o.has(c)){o.add(c);var f=this.hexes[c].color;f===n&&(this.setHexagonColor(c,e),r.push(l))}}}}},{key:"reverseChanges",value:function(t){for(;t.positions.length>0;){var e=t.positions.pop(),i=t.colors.pop();-1===i?this.eraseHexagonColor(e):this.setHexagonColor(e,Color.fromHex(i))}}}]),t}(),Changes=function(){function t(){_classCallCheck(this,t),this.positions=[],this.colors=[]}return _createClass(t,[{key:"add",value:function(t,e){this.positions.push(t),this.colors.push(e)}}]),t}(),Projection=function(){function t(){_classCallCheck(this,t),this.scale=1,this.offset=new Vec2(0,0),this["default"]=new Rect,this.region=new Rect,this.matrix=twgl.m4.identity()}return _createClass(t,[{key:"applyChanges",value:function(){this.region.set(this["default"]),this.region.divScalar(this.scale),this.region.offset(this.offset.x,this.offset.y),twgl.m4.ortho(this.region.left,this.region.right,this.region.bottom,this.region.top,.1,10,this.matrix)}}]),t}(),Renderer=function(){function t(e,i){_classCallCheck(this,t),this.gl=e,this.layout=i,this.projection=new Projection}return _createClass(t,[{key:"onSurfaceCreated",value:function(){this.gl.clearColor(0,0,0,1),this.programInfo=twgl.createProgramInfo(this.gl,["vs","fs"]),this.gl.useProgram(this.programInfo.program),this.attribs={a_position:this.layout.vertices,a_color:this.layout.colors,indices:this.layout.indices},this.bufferInfo=twgl.createBufferInfoFromArrays(this.gl,this.attribs),twgl.setBuffersAndAttributes(this.gl,this.programInfo,this.bufferInfo),this.uniforms={u_MVP:this.projection.matrix}}},{key:"onSurfaceChanged",value:function(t,e){if(this.gl.viewport(0,0,t,e),this.projection["default"].set(this.layout.bounds),e>t){var i=e/t;this.projection["default"].bottom=this.projection["default"].left*i,this.projection["default"].top=this.projection["default"].right*i}else{var n=t/e;this.projection["default"].left=this.projection["default"].bottom*n,this.projection["default"].right=this.projection["default"].top*n}this.applyProjectionChanges()}},{key:"onDrawFrame",value:function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),twgl.drawBufferInfo(this.gl,this.bufferInfo)}},{key:"applyColorChanges",value:function(){twgl.setAttribInfoBufferFromArray(this.gl,this.bufferInfo.attribs.a_color,this.attribs.a_color),this.needToRender=!0}},{key:"applyProjectionChanges",value:function(){this.projection.applyChanges(),twgl.setUniforms(this.programInfo,this.uniforms),this.needToRender=!0}}]),t}(),Surface=function(){function t(e,i){_classCallCheck(this,t),this.canvas=e,this.renderer=i;var n=this.canvas.clientWidth,s=this.canvas.clientHeight;this.renderer.onSurfaceCreated(),this.renderer.onSurfaceChanged(n,s)}return _createClass(t,[{key:"requestRender",value:function(){this.renderer.needToRender=!0}},{key:"resize",value:function(){var t=window.devicePixelRatio,e=Math.floor(this.canvas.clientWidth*t),i=Math.floor(this.canvas.clientHeight*t);return this.canvas.width!==e||this.canvas.height!==i?(this.canvas.width=e,this.canvas.height=i,this.renderer.onSurfaceChanged(e,i),!0):!1}},{key:"screenToCanvas",value:function(t,e){var i=e||new Point;if(t.offsetX)i.x=t.offsetX,i.y=t.offsetY;else if(t.layerX)i.x=t.layerX,i.y=t.layerY;else{var n=canvas.getBoundingClientRect();i.x=t.clientX-n.left,i.y=t.clientY-n.top}return i}},{key:"canvasToNdc",value:function(t,e){var i=this.canvas.clientWidth,n=this.canvas.clientHeight,s=e||new Point;return s.x=t.x/i,s.y=(n-t.y)/n,s}},{key:"ndcToClip",value:function(t,e){var i=this.renderer.projection.region,n=e||new Point;

return n.x=i.left+t.x*i.width(),n.y=i.bottom+t.y*i.height(),n}},{key:"screenToClip",value:function(t,e){var i=e||new Point;return this.screenToCanvas(t,i),this.canvasToNdc(i,i),this.ndcToClip(i,i),i}}]),t}(),_exports=_exports||{};_exports.ScaleToFit=ScaleToFit,_exports.Point=Point,_exports.Vec2=Vec2,_exports.Rect=Rect,_exports.Color=Color,_exports.Matrix=Matrix,_exports.Path=Path,_exports.Mesh=Mesh,_exports.Shape=Shape,_exports.DragDetector=DragDetector,_exports.Cube=Cube,_exports.Directions=Directions,_exports.Hex=Hex,_exports.Orientation=Orientation,_exports.Grid=Grid,_exports.RectangleGrid=RectangleGrid,_exports.Layout=Layout,_exports.Changes=Changes,_exports.Projection=Projection,_exports.Renderer=Renderer,_exports.Surface=Surface;