"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function checkRender(){(surface.resize()||renderer.needToRender)&&(renderer.needToRender=!1,renderer.onDrawFrame()),requestAnimationFrame(checkRender)}function onDown(t){switch(t.altKey&&(color.setRandom(),$(colorPicker).val(color.toHexString())),t.which){case 1:tool=Tools[$(toolPicker).val()];break;case 2:tool=panTool;break;case 3:tool=null}tool&&tool.handleDownAction(t)}function onDrag(t){tool&&tool.handleDragAction(t)}function applyColorChanges(){renderer.applyColorChanges()}function updateCout(){for(var t=ctx.getImageData(0,0,100,100),e=t.data,r=0,n=cout.width-1;n>=0;n--)for(var i=0;i<cout.height;i++){var o=4*(cout.width*n+i),a=layout.hexes[r++];if(-1===a.color)e[o]=0,e[o+1]=0,e[o+2]=0,e[o+3]=0;else{var s=ghx.Color.fromHex(a.color);e[o]=s.r,e[o+1]=s.g,e[o+2]=s.b,e[o+3]=255}}ctx.clearRect(0,0,cout.width,cout.height),ctx.putImageData(t,0,0)}function downloadCanvas(t,e,r){t.href=e.toDataURL(),t.download=r}function onUp(t){}function onOut(t){}function handleScroll(t){t.preventDefault(),t.stopPropagation();var e=t.detail<0||t.wheelDelta>0,r=e?1.5:.666666,n=renderer.projection.scale,i=n*r;MIN_SCALE>i?(r=MIN_SCALE/n,n=MIN_SCALE):i>MAX_SCALE?(r=MAX_SCALE/n,n=MAX_SCALE):n=i,renderer.projection.scale=n;var o=renderer.projection.offset,a=surface.screenToClip(t),s=ghx.Vec2.from(o,a);s.mulScalar((r-1)/r),o.add(s),constrainPointToGrid(o),renderer.applyProjectionChanges()}function constrainPointToGrid(t){var e=renderer.projection.scale,r=(e-MIN_SCALE)/e,n=layout.bounds.right*r,i=layout.bounds.top*r;t.x=constrain(t.x,-n,n),t.y=constrain(t.y,-i,i)}function constrain(t,e,r){return e>t?e:t>r?r:t}var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"function"==typeof define&&define.amd&&define([],e),"undefined"!=typeof module&&module.exports?module.exports=e():t.twgl=e()}(void 0,function(){var t,e,r;return function(n){function i(t,e){return b.call(t,e)}function o(t,e){var r,n,i,o,a,s,u,h,c,f,l,p=e&&e.split("/"),v=g.map,m=v&&v["*"]||{};if(t&&"."===t.charAt(0))if(e){for(t=t.split("/"),a=t.length-1,g.nodeIdCompat&&T.test(t[a])&&(t[a]=t[a].replace(T,"")),t=p.slice(0,p.length-1).concat(t),c=0;c<t.length;c+=1)if(l=t[c],"."===l)t.splice(c,1),c-=1;else if(".."===l){if(1===c&&(".."===t[2]||".."===t[0]))break;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||m)&&v){for(r=t.split("/"),c=r.length;c>0;c-=1){if(n=r.slice(0,c).join("/"),p)for(f=p.length;f>0;f-=1)if(i=v[p.slice(0,f).join("/")],i&&(i=i[n])){o=i,s=c;break}if(o)break;!u&&m&&m[n]&&(u=m[n],h=c)}!o&&u&&(o=u,s=h),o&&(r.splice(0,s,o),t=r.join("/"))}return t}function a(t,e){return function(){var r=E.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),p.apply(n,r.concat([t,e]))}}function s(t){return function(e){return o(e,t)}}function u(t){return function(e){d[t]=e}}function h(t){if(i(y,t)){var e=y[t];delete y[t],x[t]=!0,l.apply(n,e)}if(!i(d,t)&&!i(x,t))throw new Error("No "+t);return d[t]}function c(t){var e,r=t?t.indexOf("!"):-1;return r>-1&&(e=t.substring(0,r),t=t.substring(r+1,t.length)),[e,t]}function f(t){return function(){return g&&g.config&&g.config[t]||{}}}var l,p,v,m,d={},y={},g={},x={},b=Object.prototype.hasOwnProperty,E=[].slice,T=/\.js$/;v=function(t,e){var r,n=c(t),i=n[0];return t=n[1],i&&(i=o(i,e),r=h(i)),i?t=r&&r.normalize?r.normalize(t,s(e)):o(t,e):(t=o(t,e),n=c(t),i=n[0],t=n[1],i&&(r=h(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:r}},m={notrequirebecasebrowserifymessesup:function(t){return a(t)},exports:function(t){var e=d[t];return"undefined"!=typeof e?e:d[t]={}},module:function(t){return{id:t,uri:"",exports:d[t],config:f(t)}}},l=function(t,e,r,o){var s,c,f,l,p,g,b=[],E="undefined"==typeof r?"undefined":_typeof(r);if(o=o||t,"undefined"===E||"function"===E){for(e=!e.length&&r.length?["notrequirebecasebrowserifymessesup","exports","module"]:e,p=0;p<e.length;p+=1)if(l=v(e[p],o),c=l.f,"notrequirebecasebrowserifymessesup"===c)b[p]=m.notrequirebecasebrowserifymessesup(t);else if("exports"===c)b[p]=m.exports(t),g=!0;else if("module"===c)s=b[p]=m.module(t);else if(i(d,c)||i(y,c)||i(x,c))b[p]=h(c);else{if(!l.p)throw new Error(t+" missing "+c);l.p.load(l.n,a(o,!0),u(c),{}),b[p]=d[c]}f=r?r.apply(d[t],b):void 0,t&&(s&&s.exports!==n&&s.exports!==d[t]?d[t]=s.exports:f===n&&g||(d[t]=f))}else t&&(d[t]=r)},t=e=p=function(t,e,r,i,o){if("string"==typeof t)return m[t]?m[t](e):h(v(t,e).f);if(!t.splice){if(g=t,g.deps&&p(g.deps,g.callback),!e)return;e.splice?(t=e,e=r,r=null):t=n}return e=e||function(){},"function"==typeof r&&(r=i,i=o),i?l(n,t,e,r):setTimeout(function(){l(n,t,e,r)},4),p},p.config=function(t){return p(t)},t._defined=d,r=function(t,e,r){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(r=e,e=[]),i(d,t)||i(y,t)||(y[t]=[t,e,r])},r.amd={jQuery:!0}}(),r("node_modules/almond/almond.js",function(){}),r("twgl/typedarrays",[],function(){function t(t){if(t instanceof Int8Array)return n;if(t instanceof Uint8Array)return i;if(t instanceof Uint8ClampedArray)return i;if(t instanceof Int16Array)return o;if(t instanceof Uint16Array)return a;if(t instanceof Int32Array)return s;if(t instanceof Uint32Array)return u;if(t instanceof Float32Array)return h;throw"unsupported typed array type"}function e(t){switch(t){case n:return Int8Array;case i:return Uint8Array;case o:return Int16Array;case a:return Uint16Array;case s:return Int32Array;case u:return Uint32Array;case h:return Float32Array;default:throw"unknown gl type"}}function r(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer}var n=5120,i=5121,o=5122,a=5123,s=5124,u=5125,h=5126;return{getGLTypeForTypedArray:t,getTypedArrayTypeForGLType:e,isArrayBuffer:r}}),r("twgl/utils",[],function(){function t(t){var e={};return Object.keys(t).forEach(function(r){e[r]=t[r]}),e}function e(t,e,r){t.forEach(function(t){var n=e[t];void 0!==n&&(r[t]=n)})}function r(t,e){Object.keys(e).forEach(function(r){e.hasOwnProperty(r)&&t.hasOwnProperty(r)&&(e[r]=t[r])})}function n(t){return parseFloat(t.getParameter(t.VERSION).substr(6))}function i(t){return 0===t.getParameter(t.VERSION).indexOf("WebGL 2.0")}function o(t){var e=n(t);return 1>=e&&e>0}var a=window.console&&window.console.error&&"function"==typeof window.console.error?window.console.error.bind(window.console):function(){},s=window.console&&window.console.warn&&"function"==typeof window.console.warn?window.console.warn.bind(window.console):function(){};return{copyExistingProperties:r,copyNamedProperties:e,shallowCopy:t,isWebGL1:o,isWebGL2:i,error:a,warn:s}}),r("twgl/attributes",["./typedarrays","./utils"],function(t,e){function r(t){g.attribPrefix=t}function n(t){e.copyExistingProperties(t,g)}function i(t,e,r,n,i){t.bindBuffer(e,r),t.bufferData(e,n,i||t.STATIC_DRAW)}function o(t,e,r,n){if(e instanceof WebGLBuffer)return e;r=r||t.ARRAY_BUFFER;var o=t.createBuffer();return i(t,r,o,e,n),o}function a(t){return"indices"===t}function s(t){return t instanceof Int8Array?!0:t instanceof Uint8Array?!0:!1}function u(t){return t.length?t:t.data}function h(t,e){var r;if(r=x.test(t)?2:b.test(t)?4:3,e%r>0)throw"Can not guess numComponents for attribute '"+t+"'. Tried "+r+" but "+e+" values is not evenly divisible by "+r+". You should specify it.";return r}function c(t,e){return t.numComponents||t.size||h(e,u(t).length)}function f(e,r){if(t.isArrayBuffer(e))return e;if(t.isArrayBuffer(e.data))return e.data;Array.isArray(e)&&(e={data:e});var n=e.type;return n||(n=a(r)?Uint16Array:Float32Array),new n(e.data)}function l(e,r){var n={};return Object.keys(r).forEach(function(i){if(!a(i)){var u=r[i],h=u.attrib||u.name||u.attribName||g.attribPrefix+i,l=f(u,i);n[h]={buffer:o(e,l,void 0,u.drawType),numComponents:c(u,i),type:t.getGLTypeForTypedArray(l),normalize:void 0!==u.normalize?u.normalize:s(l),stride:u.stride||0,offset:u.offset||0,drawType:u.drawType}}}),n}function p(t,e,r,n){r=f(r),n?(t.bindBuffer(t.ARRAY_BUFFER,e.buffer),t.bufferSubData(t.ARRAY_BUFFER,n,r)):i(t,t.ARRAY_BUFFER,e.buffer,r,e.drawType)}function v(e,r){var n={attribs:l(e,r)},i=r.indices;return i?(i=f(i,"indices"),n.indices=o(e,i,e.ELEMENT_ARRAY_BUFFER),n.numElements=i.length,n.elementType=t.getGLTypeForTypedArray(i)):n.numElements=E(r),n}function m(t,e,r){var n="indices"===r?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER,i=f(e,r);return o(t,i,n)}function d(t,e){var r={};return Object.keys(e).forEach(function(n){r[n]=m(t,e[n],n)}),r}function y(t,e,r){var n=t.createVertexArray();return t.bindVertexArray(n),e.length||(e=[e]),e.forEach(function(e){twgl.setBuffersAndAttributes(t,e,r)}),t.bindVertexArray(null),{numElements:r.numElements,elementType:r.elementType,vertexArrayObject:n}}var g={attribPrefix:""},x=/coord|texture/i,b=/color|colour/i,E=function(){var t=["position","positions","a_position"];return function(e){for(var r,n=0;n<t.length&&(r=t[n],!(r in e));++n);n===t.length&&(r=Object.keys(e)[0]);var i=e[r],o=u(i).length,a=c(i,r),s=o/a;if(o%a>0)throw"numComponents "+a+" not correct for length "+o;return s}}();return{createAttribsFromArrays:l,createBuffersFromArrays:d,createBufferFromArray:m,createBufferFromTypedArray:o,createBufferInfoFromArrays:v,setAttribInfoBufferFromArray:p,createVertexArrayInfo:y,setAttributePrefix:r,setDefaults_:n,getNumComponents_:c,getArray_:u}}),r("twgl/programs",["./utils"],function(t){function e(t,e){return Nt[e].bindPoint}function r(t,e){return function(r){t.uniform1f(e,r)}}function n(t,e){return function(r){t.uniform1fv(e,r)}}function i(t,e){return function(r){t.uniform2fv(e,r)}}function o(t,e){return function(r){t.uniform3fv(e,r)}}function a(t,e){return function(r){t.uniform4fv(e,r)}}function s(t,e){return function(r){t.uniform1i(e,r)}}function u(t,e){return function(r){t.uniform1iv(e,r)}}function h(t,e){return function(r){t.uniform2iv(e,r)}}function c(t,e){return function(r){t.uniform3iv(e,r)}}function f(t,e){return function(r){t.uniform4iv(e,r)}}function l(t,e){return function(r){t.uniform1ui(e,r)}}function p(t,e){return function(r){t.uniform1uiv(e,r)}}function v(t,e){return function(r){t.uniform2uiv(e,r)}}function m(t,e){return function(r){t.uniform3uiv(e,r)}}function d(t,e){return function(r){t.uniform4uiv(e,r)}}function y(t,e){return function(r){t.uniformMatrix2fv(e,!1,r)}}function g(t,e){return function(r){t.uniformMatrix3fv(e,!1,r)}}function x(t,e){return function(r){t.uniformMatrix4fv(e,!1,r)}}function b(t,e){return function(r){t.uniformMatrix2x3fv(e,!1,r)}}function E(t,e){return function(r){t.uniformMatrix3x2fv(e,!1,r)}}function T(t,e){return function(r){t.uniformMatrix2x4fv(e,!1,r)}}function w(t,e){return function(r){t.uniformMatrix4x2fv(e,!1,r)}}function A(t,e){return function(r){t.uniformMatrix3x4fv(e,!1,r)}}function C(t,e){return function(r){t.uniformMatrix4x3fv(e,!1,r)}}function _(t,r,n,i){var o=e(t,r);return function(e){t.uniform1i(i,n),t.activeTexture(t.TEXTURE0+n),t.bindTexture(o,e)}}function R(t,r,n,i,o){for(var a=e(t,r),s=new Int32Array(o),u=0;o>u;++u)s[u]=n+u;return function(e){t.uniform1iv(i,s),e.forEach(function(e,r){t.activeTexture(t.TEXTURE0+s[r]),t.bindTexture(a,e)})}}function k(t,e){return e=e||0,++e,t.split("\n").map(function(t,r){return r+e+": "+t}).join("\n")}function P(t,e,r,n){var i=n||Y,o=t.createShader(r),a=0;Xt.test(e)&&(a=1,e=e.replace(Xt,"")),t.shaderSource(o,e),t.compileShader(o);var s=t.getShaderParameter(o,t.COMPILE_STATUS);if(!s){var u=t.getShaderInfoLog(o);return i(k(e,a)+"\n*** Error compiling shader: "+u),t.deleteShader(o),null}return o}function S(t,e,r,n,i){"function"==typeof n&&(i=n,n=void 0),"function"==typeof r&&(i=r,r=void 0);var o=i||Y,a=t.createProgram();e.forEach(function(e){t.attachShader(a,e)}),r&&r.forEach(function(e,r){t.bindAttribLocation(a,n?n[r]:r,e)}),t.linkProgram(a);var s=t.getProgramParameter(a,t.LINK_STATUS);if(!s){var u=t.getProgramInfoLog(a);return o("Error in program linking:"+u),t.deleteProgram(a),null}return a}function M(t,e,r,n){var i,o="",a=document.getElementById(e);if(!a)throw"*** Error: unknown script element"+e;if(o=a.text,!r)if("x-shader/x-vertex"===a.type)i=t.VERTEX_SHADER;else if("x-shader/x-fragment"===a.type)i=t.FRAGMENT_SHADER;else if(i!==t.VERTEX_SHADER&&i!==t.FRAGMENT_SHADER)throw"*** Error: unknown shader type";return P(t,o,r?r:i,n)}function I(t,e,r,n,i){for(var o=[],a=0;a<e.length;++a){var s=M(t,e[a],t[Vt[a]],i);if(!s)return null;o.push(s)}return S(t,o,r,n,i)}function U(t,e,r,n,i){for(var o=[],a=0;a<e.length;++a){var s=P(t,e[a],t[Vt[a]],i);if(!s)return null;o.push(s)}return S(t,o,r,n,i)}function B(t,e){function r(e,r){var i=t.getUniformLocation(e,r.name),o=r.size>1&&"[0]"===r.name.substr(-3),a=r.type,s=Nt[a];if(!s)throw"unknown type: 0x"+a.toString(16);if(s.bindPoint){var u=n;return n+=r.size,o?s.arraySetter(t,a,u,i,r.size):s.setter(t,a,u,i,r.size)}return s.arraySetter&&o?s.arraySetter(t,i):s.setter(t,i)}for(var n=0,i={},o=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),a=0;o>a;++a){var s=t.getActiveUniform(e,a);if(!s)break;var u=s.name;"[0]"===u.substr(-3)&&(u=u.substr(0,u.length-3));var h=r(e,s);i[u]=h}return i}function F(t,e){for(var r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),n=[],i=[],o=0;r>o;++o){i.push(o),n.push({});var a=t.getActiveUniform(e,o);if(!a)break;n[o].name=a.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(r){var o=r[0],a=r[1];t.getActiveUniforms(e,i,t[o]).forEach(function(t,e){n[e][a]=t})});var s={},u=t.getProgramParameter(e,t.ACTIVE_UNIFORM_BLOCKS);for(o=0;u>o;++o){var h=t.getActiveUniformBlockName(e,o),c={index:o,usedByVertexShader:t.getActiveUniformBlockParameter(e,o,t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),usedByFragmentShader:t.getActiveUniformBlockParameter(e,o,t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),size:t.getActiveUniformBlockParameter(e,o,t.UNIFORM_BLOCK_DATA_SIZE),uniformIndices:t.getActiveUniformBlockParameter(e,o,t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES)};c.used=c.usedByVertexSahder||c.usedByFragmentShader,s[h]=c}return{blockSpecs:s,uniformData:n}}function O(t,e,r,n){var i=r.blockSpecs,o=r.uniformData,a=i[n];if(!a)return q("no uniform block object named:",n),{name:n,uniforms:{}};var s=new ArrayBuffer(a.size),u=t.createBuffer(),h=a.index;t.bindBuffer(t.UNIFORM_BUFFER,u),t.uniformBlockBinding(e,a.index,h);var c=n+".";Ht.test(c)&&(c=c.replace(Ht,"."));var f={};return a.uniformIndices.forEach(function(t){var e=o[t],r=Nt[e.type],n=r.Type,i=e.size*r.size,a=e.name;a.substr(0,c.length)===c&&(a=a.substr(c.length)),f[a]=new n(s,e.offset,i/n.BYTES_PER_ELEMENT)}),{name:n,array:s,asFloat:new Float32Array(s),buffer:u,uniforms:f}}function D(t,e,r){return O(t,e.program,e.uniformBlockSpec,r)}function L(t,e,r){var n=e.uniformBlockSpec||e,i=n.blockSpecs[r.name];if(i){var o=i.index;return t.bindBufferRange(t.UNIFORM_BUFFER,o,r.buffer,r.offset||0,r.array.byteLength),!0}return!1}function N(t,e,r){L(t,e,r)&&t.bufferData(t.UNIFORM_BUFFER,r.array,t.DYNAMIC_DRAW)}function z(t,e){var r=t.uniforms;for(var n in e){var i=r[n];if(i){var o=e[n];o.length?i.set(o):i[0]=o}}}function X(t,e){for(var r=t.uniformSetters||t,n=arguments.length,i=1;n>i;++i){var o=arguments[i];if(Array.isArray(o))for(var a=o.length,s=0;a>s;++s)X(r,o[s]);else for(var u in o){var h=r[u];h&&h(o[u])}}}function V(t,e){function r(e){return function(r){t.bindBuffer(t.ARRAY_BUFFER,r.buffer),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,r.numComponents||r.size,r.type||t.FLOAT,r.normalize||!1,r.stride||0,r.offset||0)}}function n(e,r){var n=r.size,i=r.count;return function(r){t.bindBuffer(t.ARRAY_BUFFER,r.buffer);for(var o=r.size||r.numComponents||n,a=o/i,s=r.type||t.FLOAT,u=Nt[s],h=u.size*o,c=r.normalize||!1,f=r.offset||0,l=h/i,p=0;i>p;++p)t.enableVertexAttribArray(e+p),t.vertexAttribPointer(e+p,a,s,c,h,f+l*p)}}for(var i={},o=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),a=0;o>a;++a){var s=t.getActiveAttrib(e,a);if(!s)break;var u=t.getAttribLocation(e,s.name),h=zt[s.type];i[s.name]=h?n(u,h):r(u)}return i}function H(t,e){for(var r in e){var n=t[r];n&&n(e[r])}}function G(t,e,r){r.vertexArrayObject?t.bindVertexArray(r.vertexArrayObject):(H(e.attribSetters||e,r.attribs),r.indices&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r.indices))}function j(e,r){var n=B(e,r),i=V(e,r),o={program:r,uniformSetters:n,attribSetters:i};return t.isWebGL2(e)&&(o.uniformBlockSpec=F(e,r)),o}function W(t,e,r,n,i){"function"==typeof n&&(i=n,n=void 0),"function"==typeof r&&(i=r,r=void 0);var o=i||Y,a=!0;if(e=e.map(function(t){if(t.indexOf("\n")<0){var e=document.getElementById(t);e?t=e.text:(o("no element with id: "+t),a=!1)}return t}),!a)return null;var s=U(t,e,r,n,i);return s?j(t,s):null}var Y=t.error,q=t.warn,$=5126,K=35664,Z=35665,Q=35666,J=5124,tt=35667,et=35668,rt=35669,nt=35670,it=35671,ot=35672,at=35673,st=35674,ut=35675,ht=35676,ct=35678,ft=35680,lt=35679,pt=35682,vt=35685,mt=35686,dt=35687,yt=35688,gt=35689,xt=35690,bt=36289,Et=36292,Tt=36293,wt=5125,At=36294,Ct=36295,_t=36296,Rt=36298,kt=36299,Pt=36300,St=36303,Mt=36306,It=36307,Ut=36308,Bt=36311,Ft=3553,Ot=34067,Dt=32879,Lt=35866,Nt={};Nt[$]={Type:Float32Array,size:4,setter:r,arraySetter:n},Nt[K]={Type:Float32Array,size:8,setter:i},Nt[Z]={Type:Float32Array,size:12,setter:o},Nt[Q]={Type:Float32Array,size:16,setter:a},Nt[J]={Type:Int32Array,size:4,setter:s,arraySetter:u},Nt[tt]={Type:Int32Array,size:8,setter:h},Nt[et]={Type:Int32Array,size:12,setter:c},Nt[rt]={Type:Int32Array,size:16,setter:f},Nt[wt]={Type:Uint32Array,size:4,setter:l,arraySetter:p},Nt[At]={Type:Uint32Array,size:8,setter:v},Nt[Ct]={Type:Uint32Array,size:12,setter:m},Nt[_t]={Type:Uint32Array,size:16,setter:d},Nt[nt]={Type:Uint32Array,size:4,setter:s,arraySetter:u},Nt[it]={Type:Uint32Array,size:8,setter:h},Nt[ot]={Type:Uint32Array,size:12,setter:c},Nt[at]={Type:Uint32Array,size:16,setter:f},Nt[st]={Type:Float32Array,size:16,setter:y},Nt[ut]={Type:Float32Array,size:36,setter:g},Nt[ht]={Type:Float32Array,size:64,setter:x},Nt[vt]={Type:Float32Array,size:24,setter:b},Nt[mt]={Type:Float32Array,size:32,setter:T},Nt[dt]={Type:Float32Array,size:24,setter:E},Nt[yt]={Type:Float32Array,size:48,setter:A},Nt[gt]={Type:Float32Array,size:32,setter:w},Nt[xt]={Type:Float32Array,size:48,setter:C},Nt[ct]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Ft},Nt[ft]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Ot},Nt[lt]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Dt},Nt[pt]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Ft},Nt[bt]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Lt},Nt[Et]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Lt},Nt[Tt]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Ot},Nt[Rt]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Ft},Nt[kt]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Dt},Nt[Pt]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Ot},Nt[St]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Lt},Nt[Mt]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Ft},Nt[It]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Dt},Nt[Ut]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Ot},Nt[Bt]={Type:null,size:0,setter:_,arraySetter:R,bindPoint:Lt};var zt={};zt[st]={size:4,count:2},zt[ut]={size:9,count:3},zt[ht]={size:16,count:4};var Xt=/^[ \t]*\n/,Vt=["VERTEX_SHADER","FRAGMENT_SHADER"],Ht=/\[\d+\]\.$/;return{createAttributeSetters:V,createProgram:S,createProgramFromScripts:I,createProgramFromSources:U,createProgramInfo:W,createProgramInfoFromProgram:j,createUniformSetters:B,createUniformBlockSpecFromProgram:F,createUniformBlockInfoFromProgram:O,createUniformBlockInfo:D,setAttributes:H,setBuffersAndAttributes:G,setUniforms:X,setUniformBlock:N,setBlockUniforms:z,bindUniformBlock:L}}),r("twgl/draw",["./programs"],function(t){function e(t,e,r,n,i){r=void 0===r?t.TRIANGLES:r;var o=e.indices,a=e.elementType,s=void 0===n?e.numElements:n;i=void 0===i?0:i,a||o?t.drawElements(r,s,void 0===a?t.UNSIGNED_SHORT:e.elementType,i):t.drawArrays(r,i,s)}function r(r,n){var i=null,o=null;n.forEach(function(n){if(n.active!==!1){var a=n.programInfo,s=n.vertexArrayInfo||n.bufferInfo,u=!1,h=void 0===n.type?r.TRIANGLES:n.type;a!==i&&(i=a,r.useProgram(a.program),u=!0),(u||s!==o)&&(o&&o.vertexArrayObject&&!s.vertexArrayObject&&r.bindVertexArray(null),o=s,t.setBuffersAndAttributes(r,a,s)),t.setUniforms(a,n.uniforms),e(r,s,h,n.count,n.offset)}}),o.vertexArrayObject&&r.bindVertexArray(null)}return{drawBufferInfo:e,drawObjectList:r}}),r("twgl/textures",["./typedarrays","./utils"],function(t,e){function r(t){_.textureColor=new Uint8Array([255*t[0],255*t[1],255*t[2],255*t[3]])}function n(t){e.copyExistingProperties(t,_),t.textureColor&&r(t.textureColor)}function i(t,e){void 0!==e.colorspaceConversion&&(B.colorspaceConversion=t.getParameter(t.UNPACK_COLORSPACE_CONVERSION_WEBGL),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.colorspaceConversion)),void 0!==e.premultiplyAlpha&&(B.premultiplyAlpha=t.getParameter(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha)),void 0!==e.flipY&&(B.flipY=t.getParameter(t.UNPACK_FLIP_Y_WEBGL),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY))}function o(t,e){void 0!==e.colorspaceConversion&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,B.colorspaceConversion),void 0!==e.premultiplyAlpha&&t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B.premultiplyAlpha),void 0!==e.flipY&&t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,B.flipY)}function a(t,e,r){var n=r.target||t.TEXTURE_2D;t.bindTexture(n,e),r.min&&t.texParameteri(n,t.TEXTURE_MIN_FILTER,r.min),r.mag&&t.texParameteri(n,t.TEXTURE_MAG_FILTER,r.mag),r.wrap&&(t.texParameteri(n,t.TEXTURE_WRAP_S,r.wrap),t.texParameteri(n,t.TEXTURE_WRAP_T,r.wrap),n===t.TEXTURE_3D&&t.texParameteri(n,t.TEXTURE_WRAP_R,r.wrap)),r.wrapR&&t.texParameteri(n,t.TEXTURE_WRAP_R,r.wrapR),r.wrapS&&t.texParameteri(n,t.TEXTURE_WRAP_S,r.wrapS),r.wrapT&&t.texParameteri(n,t.TEXTURE_WRAP_T,r.wrapT),r.minLod&&t.texParameteri(n,t.TEXTURE_MIN_LOD,r.minLod),r.maxLod&&t.texParameteri(n,t.TEXTURE_MAX_LOD,r.maxLod),r.baseLevel&&t.texParameteri(n,t.TEXTURE_BASE_LEVEL,r.baseLevel),r.maxLevel&&t.texParameteri(n,t.TEXTURE_MAX_LEVEL,r.maxLevel)}function s(t){return t=t||_.textureColor,R(t)?t:new Uint8Array([255*t[0],255*t[1],255*t[2],255*t[3]])}function u(t){return 0===(t&t-1)}function h(t,e,r,n,i){r=r||_.textureOptions;var o=r.target||t.TEXTURE_2D;n=n||r.width,i=i||r.height,t.bindTexture(o,e),u(n)&&u(i)?t.generateMipmap(o):(t.texParameteri(o,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(o,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(o,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE))}function c(t,e){return e=e||{},e.cubeFaceOrder||[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z]}function f(t,e){var r=c(t,e),n=r.map(function(t,e){return{face:t,ndx:e}});return n.sort(function(t,e){return t.face-e.face}),n}function l(){}function p(t,r,n){function i(){s.removeEventListener("error",o),s.removeEventListener("load",a),s=null}function o(){var r="couldn't load image: "+t;e.error(r),n(r,s),i()}function a(){n(null,s),i()}n=n||l;var s=new Image;return r=void 0!==r?r:_.crossOrigin,void 0!==r&&(s.crossOrigin=r),s.addEventListener("error",o),s.addEventListener("load",a),s.src=t,s}function v(t,e,r){r=r||_.textureOptions;var n=r.target||t.TEXTURE_2D;if(t.bindTexture(n,e),r.color!==!1){var i=s(r.color);if(n===t.TEXTURE_CUBE_MAP)for(var o=0;6>o;++o)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,i);else n===t.TEXTURE_3D?t.texImage3D(n,0,t.RGBA,1,1,1,0,t.RGBA,t.UNSIGNED_BYTE,i):t.texImage2D(n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,i)}}function m(t,r,n,i){i=i||l,n=n||_.textureOptions,v(t,r,n),n=e.shallowCopy(n);var o=p(n.src,n.crossOrigin,function(e,o){e?i(e,r,o):(F(t,r,o,n),i(null,r,o))});return o}function d(t,r,n,a){function s(e){return function(s,u){--y,s?g.push(s):u.width!==u.height?g.push("cubemap face img is not a square: "+u.src):(i(t,n),t.bindTexture(m,r),5===y?c(t).forEach(function(e){t.texImage2D(e,0,h,h,f,u)}):t.texImage2D(e,0,h,h,f,u),o(t,n),t.generateMipmap(m)),0===y&&a(g.length?g:void 0,d,r)}}a=a||l;var u=n.src;if(6!==u.length)throw"there must be 6 urls for a cubemap";var h=n.format||t.RGBA,f=n.type||t.UNSIGNED_BYTE,m=n.target||t.TEXTURE_2D;if(m!==t.TEXTURE_CUBE_MAP)throw"target must be TEXTURE_CUBE_MAP";v(t,r,n),n=e.shallowCopy(n);var d,y=6,g=[],x=c(t,n);d=u.map(function(t,e){return p(t,n.crossOrigin,s(x[e]))})}function y(t){switch(t){case k:case M:return 1;case I:return 2;case P:return 3;case S:return 4;default:throw"unknown type: "+t}}function g(e,r){return R(r)?t.getGLTypeForTypedArray(r):e.UNSIGNED_BYTE}function x(t,e,r,n,i){if(i%1!==0)throw"can't guess dimensions";if(r||n){if(n){if(!r&&(r=i/n,r%1))throw"can't guess dimensions"}else if(n=i/r,n%1)throw"can't guess dimensions"}else{var o=Math.sqrt(i/(e===t.TEXTURE_CUBE_MAP?6:1));o%1===0?(r=o,n=o):(r=i,n=1)}return{width:r,height:n}}function b(e,r,n,a){a=a||_.textureOptions;var s=a.target||e.TEXTURE_2D;e.bindTexture(s,r);var u=a.width,h=a.height,c=a.depth,l=a.format||e.RGBA,p=a.internalFormat||l,v=a.type||g(e,n),m=y(l),d=n.length/m;if(d%1)throw"length wrong size for format: "+U(e,l);var b;if(s===e.TEXTURE_3D)if(u||h||c)!u||h&&c?!h||u&&c?(b=x(e,s,u,h,d/c),u=b.width,h=b.height):(b=x(e,s,u,c,d/h),u=b.width,c=b.height):(b=x(e,s,h,c,d/u),h=b.width,c=b.height);else{var E=Math.cbrt(d);if(E%1!==0)throw"can't guess cube size of array of numElements: "+d;u=E,h=E,c=E}else b=x(e,s,u,h,d),u=b.width,h=b.height;if(R(n))n instanceof Uint8ClampedArray&&(n=new Uint8Array(n.buffer));else{var T=t.getTypedArrayTypeForGLType(v);n=new T(n)}if(e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment||1),i(e,a),s===e.TEXTURE_CUBE_MAP){var w=d/6*m;f(e,a).forEach(function(t){var r=w*t.ndx,i=n.subarray(r,r+w);e.texImage2D(t.face,0,p,u,h,0,l,v,i)})}else s===e.TEXTURE_3D?e.texImage3D(s,0,p,u,h,c,0,l,v,n):e.texImage2D(s,0,p,u,h,0,l,v,n);return o(e,a),{width:u,height:h,depth:c}}function E(t,e,r){var n=r.target||t.TEXTURE_2D;t.bindTexture(n,e);var a=r.format||t.RGBA,s=r.internalFormat||a,u=r.type||t.UNSIGNED_BYTE;if(i(t,r),n===t.TEXTURE_CUBE_MAP)for(var h=0;6>h;++h)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,s,r.width,r.height,0,a,u,null);else n===t.TEXTURE_3D?t.texImage3D(n,0,s,r.width,r.height,r.depth,0,a,u,null):t.texImage2D(n,0,s,r.width,r.height,0,a,u,null);o(t,r)}function T(t,e,r){r=r||l,e=e||_.textureOptions;var n=t.createTexture(),i=e.target||t.TEXTURE_2D,o=e.width||1,s=e.height||1;t.bindTexture(i,n),i===t.TEXTURE_CUBE_MAP&&(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE));var u=e.src;if(u)if("function"==typeof u&&(u=u(t,e)),"string"==typeof u)m(t,n,e,r);else if(R(u)||Array.isArray(u)&&("number"==typeof u[0]||Array.isArray(u[0])||R(u[0]))){var c=b(t,n,u,e);o=c.width,s=c.height}else if(Array.isArray(u)&&"string"==typeof u[0])d(t,n,e,r);else{if(!(u instanceof HTMLElement))throw"unsupported src type";F(t,n,u,e),o=u.width,s=u.height}else E(t,n,e);return e.auto!==!1&&h(t,n,e,o,s),a(t,n,e),n}function w(t,e,r,n,i){n=n||r.width,i=i||r.height;var o=r.target||t.TEXTURE_2D;t.bindTexture(o,e);var a,s=r.format||t.RGBA,u=r.src;if(a=u&&(R(u)||Array.isArray(u)&&"number"==typeof u[0])?r.type||g(t,u):r.type||t.UNSIGNED_BYTE,o===t.TEXTURE_CUBE_MAP)for(var h=0;6>h;++h)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,s,n,i,0,s,a,null);else t.texImage2D(o,0,s,n,i,0,s,a,null)}function A(t){return"string"==typeof t||Array.isArray(t)&&"string"==typeof t[0]}function C(t,e,r){function n(){0===i&&setTimeout(function(){r(o.length?o:void 0,a,s)},0)}r=r||l;var i=0,o=[],a={},s={};return Object.keys(e).forEach(function(r){var u,h=e[r];A(h.src)&&(u=function(t,e,a){s[r]=a,--i,t&&o.push(t),n()},++i),a[r]=T(t,h,u)}),n(),a}var _={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},R=t.isArrayBuffer,k=6406,P=6407,S=6408,M=6409,I=6410,U=function(){function t(t){e||(e={},Object.keys(t).forEach(function(r){"number"==typeof t[r]&&(e[t[r]]=r)}))}var e;return function(r,n){return t(),e[n]||"0x"+n.toString(16)}}(),B={},F=function(){var t=document.createElement("canvas").getContext("2d");return function(e,r,n,s){s=s||_.textureOptions;var u=s.target||e.TEXTURE_2D,c=n.width,l=n.height,p=s.format||e.RGBA,v=s.internalFormat||p,m=s.type||e.UNSIGNED_BYTE;if(i(e,s),e.bindTexture(u,r),u===e.TEXTURE_CUBE_MAP){var d,y,g=n.width,x=n.height;if(g/6===x)d=x,y=[0,0,1,0,2,0,3,0,4,0,5,0];else if(x/6===g)d=g,y=[0,0,0,1,0,2,0,3,0,4,0,5];else if(g/3===x/2)d=g/3,y=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(g/2!==x/3)throw"can't figure out cube map from element: "+(n.src?n.src:n.nodeName);d=g/2,y=[0,0,1,0,0,1,1,1,0,2,1,2]}t.canvas.width=d,t.canvas.height=d,c=d,l=d,f(e,s).forEach(function(r){var i=y[2*r.ndx+0]*d,o=y[2*r.ndx+1]*d;t.drawImage(n,i,o,d,d,0,0,d,d),e.texImage2D(r.face,0,v,p,m,t.canvas)}),t.canvas.width=1,t.canvas.height=1}else if(u===e.TEXTURE_3D){var b=Math.min(n.width,n.height),E=Math.max(n.width,n.height),T=E/b;if(T%1!==0)throw"can not compute 3D dimensions of element";var w=n.width===E?1:0,A=n.height===E?1:0;e.texImage3D(u,0,v,b,b,b,0,p,m,null),t.canvas.width=b,t.canvas.height=b;for(var C=0;T>C;++C){var R=C*b*w,k=C*b*A,P=b,S=b,M=0,I=0,U=b,B=b;t.drawImage(n,R,k,P,S,M,I,U,B),e.texSubImage3D(u,0,0,0,C,p,m,t.canvas)}t.canvas.width=0,t.canvas.height=0}else e.texImage2D(u,0,v,p,m,n);o(e,s),s.auto!==!1&&h(e,r,s,c,l),a(e,r,s)}}();return{setDefaults_:n,createTexture:T,setEmptyTexture:E,setTextureFromArray:b,loadTextureFromUrl:m,setTextureFromElement:F,setTextureFilteringForSize:h,setTextureParameters:a,setDefaultTextureColor:r,createTextures:C,resizeTexture:w,getNumComponentsForFormat:y}}),r("twgl/framebuffers",["./textures","./utils"],function(t,e){function r(t){return A[t]}function n(t){return C[t]}function i(i,o,a,s){var u=i.FRAMEBUFFER,h=i.createFramebuffer();i.bindFramebuffer(u,h),a=a||i.drawingBufferWidth,s=s||i.drawingBufferHeight,o=o||w;var c=0,f={framebuffer:h,attachments:[],width:a,height:s};return o.forEach(function(o){var h=o.attachment,l=o.format,p=r(l);if(p||(p=y+c++),!h)if(n(l))h=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,h),i.renderbufferStorage(i.RENDERBUFFER,l,a,s);else{var v=e.shallowCopy(o);v.width=a,v.height=s,void 0===v.auto&&(v.auto=!1,v.min=v.min||i.LINEAR,v.mag=v.mag||i.LINEAR,v.wrapS=v.wrapS||v.wrap||i.CLAMP_TO_EDGE,v.wrapT=v.wrapT||v.wrap||i.CLAMP_TO_EDGE),h=t.createTexture(i,v)}if(h instanceof WebGLRenderbuffer)i.framebufferRenderbuffer(u,p,i.RENDERBUFFER,h);else{if(!(h instanceof WebGLTexture))throw"unknown attachment type";i.framebufferTexture2D(u,p,o.texTarget||i.TEXTURE_2D,h,o.level||0)}f.attachments.push(h)}),f}function o(e,r,n,i,o){i=i||e.drawingBufferWidth,o=o||e.drawingBufferHeight,r.width=i,r.height=o,n=n||w,n.forEach(function(n,a){var s=r.attachments[a],u=n.format;if(s instanceof WebGLRenderbuffer)e.bindRenderbuffer(e.RENDERBUFFER,s),e.renderbufferStorage(e.RENDERBUFFER,u,i,o);else{if(!(s instanceof WebGLTexture))throw"unknown attachment type";
t.resizeTexture(e,s,n,i,o)}})}function a(t,e,r){r=r||t.FRAMEBUFFER,e?(t.bindFramebuffer(r,e.framebuffer),t.viewport(0,0,e.width,e.height)):(t.bindFramebuffer(r,null),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight))}var s=5121,u=6402,h=6408,c=32854,f=32855,l=36194,p=33189,v=6401,m=36168,d=34041,y=36064,g=36096,x=36128,b=33306,E=33071,T=9729,w=[{format:h,type:s,min:T,wrap:E},{format:d}],A={};A[d]=b,A[v]=x,A[m]=x,A[u]=g,A[p]=g;var C={};return C[c]=!0,C[f]=!0,C[l]=!0,C[d]=!0,C[p]=!0,C[v]=!0,C[m]=!0,{bindFramebufferInfo:a,createFramebufferInfo:i,resizeFramebufferInfo:o}}),r("twgl/twgl",["./attributes","./draw","./framebuffers","./programs","./textures","./typedarrays","./utils"],function(t,e,r,n,i,o,a){function s(e){a.copyExistingProperties(e,d),t.setDefaults_(e),i.setDefaults_(e)}function u(t){if(t&&d.enableVertexArrayObjects&&a.isWebGL1(t)){var e=t.getExtension("OES_vertex_array_object");e&&(t.createVertexArray=function(){return e.createVertexArrayOES()},t.deleteVertexArray=function(t){e.deleteVertexArrayOES(t)},t.isVertexArray=function(t){return e.isVertexArrayOES(t)},t.bindVertexArray=function(t){e.bindVertexArrayOES(t)},t.VERTEX_ARRAY_BINDING=e.VERTEX_ARRAY_BINDING_OES)}}function h(t,e){for(var r=["webgl","experimental-webgl"],n=null,i=0;i<r.length;++i){try{n=t.getContext(r[i],e)}catch(o){}if(n)break}return n}function c(t,e){var r=h(t,e);return u(r),r}function f(t,e){for(var r=["webgl2","experimental-webgl2","webgl","experimental-webgl"],n=null,i=0;i<r.length;++i){try{n=t.getContext(r[i],e)}catch(o){}if(n)break}return n}function l(t,e){var r=f(t,e);return u(r),r}function p(t,e){e=e||1,e=Math.max(1,e);var r=t.clientWidth*e|0,n=t.clientHeight*e|0;return t.width!==r||t.height!==n?(t.width=r,t.height=n,!0):!1}function v(t){return"_"!==t[t.length-1]}function m(t,e){return Object.keys(t).filter(v).forEach(function(r){e[r]=t[r]}),e}var d={enableVertexArrayObjects:!0},y={getContext:l,getWebGLContext:c,isWebGL1:a.isWebGL1,isWebGL2:a.isWebGL2,resizeCanvasToDisplaySize:p,setDefaults:s},g={attributes:t,draw:e,framebuffers:r,programs:n,textures:i,typedArrays:o};return Object.keys(g).forEach(function(t){var e=g[t];m(e,y),y[t]=m(e,{})}),y}),r("twgl/v3",[],function(){function t(t){var e=d;return d=t,e}function e(t,e,r){var n=new d(3);return t&&(n[0]=t),e&&(n[1]=e),r&&(n[2]=r),n}function r(t,e,r){return r=r||new d(3),r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function n(t,e,r){return r=r||new d(3),r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function i(t,e,r,n){return n=n||new d(3),n[0]=(1-r)*t[0]+r*e[0],n[1]=(1-r)*t[1]+r*e[1],n[2]=(1-r)*t[2]+r*e[2],n}function o(t,e,r){return r=r||new d(3),r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}function a(t,e,r){return r=r||new d(3),r[0]=t[0]/e,r[1]=t[1]/e,r[2]=t[2]/e,r}function s(t,e,r){return r=r||new d(3),r[0]=t[1]*e[2]-t[2]*e[1],r[1]=t[2]*e[0]-t[0]*e[2],r[2]=t[0]*e[1]-t[1]*e[0],r}function u(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function h(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}function c(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function f(t,e){e=e||new d(3);var r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=Math.sqrt(r);return n>1e-5?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=0,e[1]=0,e[2]=0),e}function l(t,e){return e=e||new d(3),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function p(t,e){return e=e||new d(3),e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function v(t,e,r){return r=r||new d(3),r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r}function m(t,e,r){return r=r||new d(3),r[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r}var d=Float32Array;return{add:r,copy:p,create:e,cross:s,divide:m,divScalar:a,dot:u,lerp:i,length:h,lengthSq:c,mulScalar:o,multiply:v,negate:l,normalize:f,setDefaultType:t,subtract:n}}),r("twgl/m4",["./v3"],function(t){function e(t){var e=M;return M=t,e}function r(t,e){return e=e||new M(16),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e[11]=-t[11],e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=-t[15],e}function n(t,e){return e=e||new M(16),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function i(t){return t=t||new M(16),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o(t,e){if(e=e||new M(16),e===t){var r;return r=t[1],t[1]=t[4],t[4]=r,r=t[2],t[2]=t[8],t[8]=r,r=t[3],t[3]=t[12],t[12]=r,r=t[6],t[6]=t[9],t[9]=r,r=t[7],t[7]=t[13],t[13]=r,r=t[11],t[11]=t[14],t[14]=r,e}var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],h=t[6],c=t[7],f=t[8],l=t[9],p=t[10],v=t[11],m=t[12],d=t[13],y=t[14],g=t[15];return e[0]=n,e[1]=s,e[2]=f,e[3]=m,e[4]=i,e[5]=u,e[6]=l,e[7]=d,e[8]=o,e[9]=h,e[10]=p,e[11]=y,e[12]=a,e[13]=c,e[14]=v,e[15]=g,e}function a(t,e){e=e||new M(16);var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],h=t[7],c=t[8],f=t[9],l=t[10],p=t[11],v=t[12],m=t[13],d=t[14],y=t[15],g=l*y,x=d*p,b=u*y,E=d*h,T=u*p,w=l*h,A=i*y,C=d*o,_=i*p,R=l*o,k=i*h,P=u*o,S=c*m,I=v*f,U=a*m,B=v*s,F=a*f,O=c*s,D=r*m,L=v*n,N=r*f,z=c*n,X=r*s,V=a*n,H=g*s+E*f+T*m-(x*s+b*f+w*m),G=x*n+A*f+R*m-(g*n+C*f+_*m),j=b*n+C*s+k*m-(E*n+A*s+P*m),W=w*n+_*s+P*f-(T*n+R*s+k*f),Y=1/(r*H+a*G+c*j+v*W);return e[0]=Y*H,e[1]=Y*G,e[2]=Y*j,e[3]=Y*W,e[4]=Y*(x*a+b*c+w*v-(g*a+E*c+T*v)),e[5]=Y*(g*r+C*c+_*v-(x*r+A*c+R*v)),e[6]=Y*(E*r+A*a+P*v-(b*r+C*a+k*v)),e[7]=Y*(T*r+R*a+k*c-(w*r+_*a+P*c)),e[8]=Y*(S*h+B*p+F*y-(I*h+U*p+O*y)),e[9]=Y*(I*o+D*p+z*y-(S*o+L*p+N*y)),e[10]=Y*(U*o+L*h+X*y-(B*o+D*h+V*y)),e[11]=Y*(O*o+N*h+V*p-(F*o+z*h+X*p)),e[12]=Y*(U*l+O*d+I*u-(F*d+S*u+B*l)),e[13]=Y*(N*d+S*i+L*l-(D*l+z*d+I*i)),e[14]=Y*(D*u+V*d+B*i-(X*d+U*i+L*u)),e[15]=Y*(X*l+F*i+z*u-(N*u+V*l+O*i)),e}function s(t,e,r){r=r||new M(16);var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],h=t[6],c=t[7],f=t[8],l=t[9],p=t[10],v=t[11],m=t[12],d=t[13],y=t[14],g=t[15],x=e[0],b=e[1],E=e[2],T=e[3],w=e[4],A=e[5],C=e[6],_=e[7],R=e[8],k=e[9],P=e[10],S=e[11],I=e[12],U=e[13],B=e[14],F=e[15];return r[0]=n*x+s*b+f*E+m*T,r[1]=i*x+u*b+l*E+d*T,r[2]=o*x+h*b+p*E+y*T,r[3]=a*x+c*b+v*E+g*T,r[4]=n*w+s*A+f*C+m*_,r[5]=i*w+u*A+l*C+d*_,r[6]=o*w+h*A+p*C+y*_,r[7]=a*w+c*A+v*C+g*_,r[8]=n*R+s*k+f*P+m*S,r[9]=i*R+u*k+l*P+d*S,r[10]=o*R+h*k+p*P+y*S,r[11]=a*R+c*k+v*P+g*S,r[12]=n*I+s*U+f*B+m*F,r[13]=i*I+u*U+l*B+d*F,r[14]=o*I+h*U+p*B+y*F,r[15]=a*I+c*U+v*B+g*F,r}function u(t,e,r){return r=r||i(),t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11]),r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function h(e,r){return r=r||t.create(),r[0]=e[12],r[1]=e[13],r[2]=e[14],r}function c(e,r,n){n=n||t.create();var i=4*r;return n[0]=e[i+0],n[1]=e[i+1],n[2]=e[i+2],n}function f(t,e,r,i){i!==t&&(i=n(t,i));var o=4*r;return i[o+0]=e[0],i[o+1]=e[1],i[o+2]=e[2],i}function l(t,e,r,n,i){i=i||new M(16);var o=Math.tan(.5*Math.PI-.5*t),a=1/(r-n);return i[0]=o/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(r+n)*a,i[11]=-1,i[12]=0,i[13]=0,i[14]=r*n*a*2,i[15]=0,i}function p(t,e,r,n,i,o,a){return a=a||new M(16),a[0]=2/(e-t),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(n-r),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-1/(o-i),a[11]=0,a[12]=(e+t)/(t-e),a[13]=(n+r)/(r-n),a[14]=-i/(i-o),a[15]=1,a}function v(t,e,r,n,i,o,a){a=a||new M(16);var s=e-t,u=n-r,h=i-o;return a[0]=2*i/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*i/u,a[6]=0,a[7]=0,a[8]=(t+e)/s,a[9]=(n+r)/u,a[10]=o/h,a[11]=-1,a[12]=0,a[13]=0,a[14]=i*o/h,a[15]=0,a}function m(e,r,n,i){i=i||new M(16);var o=I,a=U,s=B;return t.normalize(t.subtract(e,r,s),s),t.normalize(t.cross(n,s,o),o),t.normalize(t.cross(s,o,a),a),i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=0,i[4]=a[0],i[5]=a[1],i[6]=a[2],i[7]=0,i[8]=s[0],i[9]=s[1],i[10]=s[2],i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function d(t,e){return e=e||new M(16),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function y(t,e,r){r=r||new M(16);var n=e[0],i=e[1],o=e[2],a=t[0],s=t[1],u=t[2],h=t[3],c=t[4],f=t[5],l=t[6],p=t[7],v=t[8],m=t[9],d=t[10],y=t[11],g=t[12],x=t[13],b=t[14],E=t[15];return t!==r&&(r[0]=a,r[1]=s,r[2]=u,r[3]=h,r[4]=c,r[5]=f,r[6]=l,r[7]=p,r[8]=v,r[9]=m,r[10]=d,r[11]=y),r[12]=a*n+c*i+v*o+g,r[13]=s*n+f*i+m*o+x,r[14]=u*n+l*i+d*o+b,r[15]=h*n+p*i+y*o+E,r}function g(t,e){e=e||new M(16);var r=Math.cos(t),n=Math.sin(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(t,e,r){r=r||new M(16);var n=t[4],i=t[5],o=t[6],a=t[7],s=t[8],u=t[9],h=t[10],c=t[11],f=Math.cos(e),l=Math.sin(e);return r[4]=f*n+l*s,r[5]=f*i+l*u,r[6]=f*o+l*h,r[7]=f*a+l*c,r[8]=f*s-l*n,r[9]=f*u-l*i,r[10]=f*h-l*o,r[11]=f*c-l*a,t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}function b(t,e){e=e||new M(16);var r=Math.cos(t),n=Math.sin(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function E(t,e,r){r=r||new M(16);var n=t[0],i=t[1],o=t[2],a=t[3],s=t[8],u=t[9],h=t[10],c=t[11],f=Math.cos(e),l=Math.sin(e);return r[0]=f*n-l*s,r[1]=f*i-l*u,r[2]=f*o-l*h,r[3]=f*a-l*c,r[8]=f*s+l*n,r[9]=f*u+l*i,r[10]=f*h+l*o,r[11]=f*c+l*a,t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}function T(t,e){e=e||new M(16);var r=Math.cos(t),n=Math.sin(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function w(t,e,r){r=r||new M(16);var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],h=t[6],c=t[7],f=Math.cos(e),l=Math.sin(e);return r[0]=f*n+l*s,r[1]=f*i+l*u,r[2]=f*o+l*h,r[3]=f*a+l*c,r[4]=f*s-l*n,r[5]=f*u-l*i,r[6]=f*h-l*o,r[7]=f*c-l*a,t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}function A(t,e,r){r=r||new M(16);var n=t[0],i=t[1],o=t[2],a=Math.sqrt(n*n+i*i+o*o);n/=a,i/=a,o/=a;var s=n*n,u=i*i,h=o*o,c=Math.cos(e),f=Math.sin(e),l=1-c;return r[0]=s+(1-s)*c,r[1]=n*i*l+o*f,r[2]=n*o*l-i*f,r[3]=0,r[4]=n*i*l-o*f,r[5]=u+(1-u)*c,r[6]=i*o*l+n*f,r[7]=0,r[8]=n*o*l+i*f,r[9]=i*o*l-n*f,r[10]=h+(1-h)*c,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function C(t,e,r,n){n=n||new M(16);var i=e[0],o=e[1],a=e[2],s=Math.sqrt(i*i+o*o+a*a);i/=s,o/=s,a/=s;var u=i*i,h=o*o,c=a*a,f=Math.cos(r),l=Math.sin(r),p=1-f,v=u+(1-u)*f,m=i*o*p+a*l,d=i*a*p-o*l,y=i*o*p-a*l,g=h+(1-h)*f,x=o*a*p+i*l,b=i*a*p+o*l,E=o*a*p-i*l,T=c+(1-c)*f,w=t[0],A=t[1],C=t[2],_=t[3],R=t[4],k=t[5],P=t[6],S=t[7],I=t[8],U=t[9],B=t[10],F=t[11];return n[0]=v*w+m*R+d*I,n[1]=v*A+m*k+d*U,n[2]=v*C+m*P+d*B,n[3]=v*_+m*S+d*F,n[4]=y*w+g*R+x*I,n[5]=y*A+g*k+x*U,n[6]=y*C+g*P+x*B,n[7]=y*_+g*S+x*F,n[8]=b*w+E*R+T*I,n[9]=b*A+E*k+T*U,n[10]=b*C+E*P+T*B,n[11]=b*_+E*S+T*F,t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n}function _(t,e){return e=e||new M(16),e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function R(t,e,r){r=r||new M(16);var n=e[0],i=e[1],o=e[2];return r[0]=n*t[0],r[1]=n*t[1],r[2]=n*t[2],r[3]=n*t[3],r[4]=i*t[4],r[5]=i*t[5],r[6]=i*t[6],r[7]=i*t[7],r[8]=o*t[8],r[9]=o*t[9],r[10]=o*t[10],r[11]=o*t[11],t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r}function k(e,r,n){n=n||t.create();var i=r[0],o=r[1],a=r[2],s=i*e[3]+o*e[7]+a*e[11]+e[15];return n[0]=(i*e[0]+o*e[4]+a*e[8]+e[12])/s,n[1]=(i*e[1]+o*e[5]+a*e[9]+e[13])/s,n[2]=(i*e[2]+o*e[6]+a*e[10]+e[14])/s,n}function P(e,r,n){n=n||t.create();var i=r[0],o=r[1],a=r[2];return n[0]=i*e[0]+o*e[4]+a*e[8],n[1]=i*e[1]+o*e[5]+a*e[9],n[2]=i*e[2]+o*e[6]+a*e[10],n}function S(e,r,n){n=n||t.create();var i=a(e),o=r[0],s=r[1],u=r[2];return n[0]=o*i[0]+s*i[1]+u*i[2],n[1]=o*i[4]+s*i[5]+u*i[6],n[2]=o*i[8]+s*i[9]+u*i[10],n}var M=Float32Array,I=t.create(),U=t.create(),B=t.create();return{axisRotate:C,axisRotation:A,create:i,copy:n,frustum:v,getAxis:c,getTranslation:h,identity:i,inverse:a,lookAt:m,multiply:s,negate:r,ortho:p,perspective:l,rotateX:x,rotateY:E,rotateZ:w,rotateAxis:C,rotationX:g,rotationY:b,rotationZ:T,scale:R,scaling:_,setAxis:f,setDefaultType:e,setTranslation:u,transformDirection:P,transformNormal:S,transformPoint:k,translate:y,translation:d,transpose:o}}),r("twgl/primitives",["./attributes","./twgl","./utils","./m4","./v3"],function(t,e,r,n,i){function o(t,e){var r=0;return t.push=function(){for(var e=0;e<arguments.length;++e){var n=arguments[e];if(n instanceof Array||n.buffer&&n.buffer instanceof ArrayBuffer)for(var i=0;i<n.length;++i)t[r++]=n[i];else t[r++]=n}},t.reset=function(t){r=t||0},t.numComponents=e,Object.defineProperty(t,"numElements",{get:function(){return this.length/this.numComponents|0}}),t}function a(t,e,r){var n=r||Float32Array;return o(new n(t*e),t)}function s(t){return"indices"!==t}function u(t){function e(e){for(var o=t[e],s=o.numComponents,u=a(s,i,o.constructor),h=0;i>h;++h)for(var c=r[h],f=c*s,l=0;s>l;++l)u.push(o[f+l]);n[e]=u}var r=t.indices,n={},i=r.length;return Object.keys(t).filter(s).forEach(e),n}function h(t){if(t.indices)throw"can't flatten normals of indexed vertices. deindex them first";for(var e=t.normal,r=e.length,n=0;r>n;n+=9){var i=e[n+0],o=e[n+1],a=e[n+2],s=e[n+3],u=e[n+4],h=e[n+5],c=e[n+6],f=e[n+7],l=e[n+8],p=i+s+c,v=o+u+f,m=a+h+l,d=Math.sqrt(p*p+v*v+m*m);p/=d,v/=d,m/=d,e[n+0]=p,e[n+1]=v,e[n+2]=m,e[n+3]=p,e[n+4]=v,e[n+5]=m,e[n+6]=p,e[n+7]=v,e[n+8]=m}return t}function c(t,e,r){for(var n=t.length,i=new Float32Array(3),o=0;n>o;o+=3)r(e,[t[o],t[o+1],t[o+2]],i),t[o]=i[0],t[o+1]=i[1],t[o+2]=i[2]}function f(t,e,r){r=r||i.create();var n=e[0],o=e[1],a=e[2];return r[0]=n*t[0]+o*t[1]+a*t[2],r[1]=n*t[4]+o*t[5]+a*t[6],r[2]=n*t[8]+o*t[9]+a*t[10],r}function l(t,e){return c(t,e,n.transformDirection),t}function p(t,e){return c(t,n.inverse(e),f),t}function v(t,e){return c(t,e,n.transformPoint),t}function m(t,e){return Object.keys(t).forEach(function(r){var n=t[r];r.indexOf("pos")>=0?v(n,e):r.indexOf("tan")>=0||r.indexOf("binorm")>=0?l(n,e):r.indexOf("norm")>=0&&p(n,e)}),t}function d(t,e,r){return t=t||2,e=e||0,r=r||0,t*=.5,{position:{numComponents:2,data:[e+-1*t,r+-1*t,e+1*t,r+-1*t,e+-1*t,r+1*t,e+1*t,r+1*t]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function y(t,e,r,i,o){t=t||1,e=e||1,r=r||1,i=i||1,o=o||n.identity();for(var s=(r+1)*(i+1),u=a(3,s),h=a(3,s),c=a(2,s),f=0;i>=f;f++)for(var l=0;r>=l;l++){var p=l/r,v=f/i;u.push(t*p-.5*t,0,e*v-.5*e),h.push(0,1,0),c.push(p,v)}for(var d=r+1,y=a(3,r*i*2,Uint16Array),f=0;i>f;f++)for(var l=0;r>l;l++)y.push((f+0)*d+l,(f+1)*d+l,(f+0)*d+l+1),y.push((f+1)*d+l,(f+1)*d+l+1,(f+0)*d+l+1);var g=m({position:u,normal:h,texcoord:c,indices:y},o);return g}function g(t,e,r,n,i,o,s){if(0>=e||0>=r)throw Error("subdivisionAxis and subdivisionHeight must be > 0");n=n||0,i=i||Math.PI,o=o||0,s=s||2*Math.PI;for(var u=i-n,h=s-o,c=(e+1)*(r+1),f=a(3,c),l=a(3,c),p=a(2,c),v=0;r>=v;v++)for(var m=0;e>=m;m++){var d=m/e,y=v/r,g=h*d,x=u*y,b=Math.sin(g),E=Math.cos(g),T=Math.sin(x),w=Math.cos(x),A=E*T,C=w,_=b*T;f.push(t*A,t*C,t*_),l.push(A,C,_),p.push(1-d,y)}for(var R=e+1,k=a(3,e*r*2,Uint16Array),m=0;e>m;m++)for(var v=0;r>v;v++)k.push((v+0)*R+m,(v+0)*R+m+1,(v+1)*R+m),k.push((v+1)*R+m,(v+0)*R+m+1,(v+1)*R+m+1);return{position:f,normal:l,texcoord:p,indices:k}}function x(t){t=t||1;for(var e=t/2,r=[[-e,-e,-e],[+e,-e,-e],[-e,+e,-e],[+e,+e,-e],[-e,-e,+e],[+e,-e,+e],[-e,+e,+e],[+e,+e,+e]],n=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=[[1,0],[0,0],[0,1],[1,1]],o=24,s=a(3,o),u=a(3,o),h=a(2,o),c=a(3,12,Uint16Array),f=0;6>f;++f){for(var l=D[f],p=0;4>p;++p){var v=r[l[p]],m=n[f],d=i[p];s.push(v),u.push(m),h.push(d)}var y=4*f;c.push(y+0,y+1,y+2),c.push(y+0,y+2,y+3)}return{position:s,normal:u,texcoord:h,indices:c}}function b(t,e,r,n,i,o,s){if(3>n)throw Error("radialSubdivisions must be 3 or greater");if(1>i)throw Error("verticalSubdivisions must be 1 or greater");for(var u=void 0===o?!0:o,h=void 0===s?!0:s,c=(u?2:0)+(h?2:0),f=(n+1)*(i+1+c),l=a(3,f),p=a(3,f),v=a(2,f),m=a(3,n*(i+c)*2,Uint16Array),d=n+1,y=Math.atan2(t-e,r),g=Math.cos(y),x=Math.sin(y),b=u?-2:0,E=i+(h?2:0),T=b;E>=T;++T){var w,A=T/i,C=r*A;0>T?(C=0,A=1,w=t):T>i?(C=r,A=1,w=e):w=t+(e-t)*(T/i),(-2===T||T===i+2)&&(w=0,A=0),C-=r/2;for(var _=0;d>_;++_){var R=Math.sin(_*Math.PI*2/n),k=Math.cos(_*Math.PI*2/n);l.push(R*w,C,k*w),p.push(0>T||T>i?0:R*g,0>T?-1:T>i?1:x,0>T||T>i?0:k*g),v.push(_/n,1-A)}}for(var T=0;i+c>T;++T)for(var _=0;n>_;++_)m.push(d*(T+0)+0+_,d*(T+0)+1+_,d*(T+1)+1+_),m.push(d*(T+0)+0+_,d*(T+1)+1+_,d*(T+1)+0+_);return{position:l,normal:p,texcoord:v,indices:m}}function E(t,e){e=e||[];for(var r=[],n=0;n<t.length;n+=4){var i=t[n],o=t.slice(n+1,n+4);o.push.apply(o,e);for(var a=0;i>a;++a)r.push.apply(r,o)}return r}function T(){var t=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],e=[.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0],r=E([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),n=E([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),i=t.length/3,o={position:a(3,i),texcoord:a(2,i),normal:a(3,i),color:a(4,i,Uint8Array),indices:a(3,i/3,Uint16Array)};o.position.push(t),o.texcoord.push(e),o.normal.push(r),o.color.push(n);for(var s=0;i>s;++s)o.indices.push(s);return o}function w(t,e,r,n,o,s,u){function h(t,e,r){return t+(e-t)*r}function c(e,r,a,u,c,f){for(var v=0;o>=v;v++){var g=r/(l-1),x=v/o,b=2*(g-.5),E=(s+x*p)*Math.PI,T=Math.sin(E),w=Math.cos(E),A=h(t,e,T),C=b*n,_=w*t,R=T*A;m.push(C,_,R);var k=i.add(i.multiply([0,T,w],a),u);d.push(k),y.push(g*c+f,x)}}function f(t,e){for(var r=0;o>r;++r)b.push(t+r+0,t+r+1,e+r+0),b.push(t+r+1,e+r+1,e+r+0)}if(0>=o)throw Error("subdivisionDown must be > 0");s=s||0,u=u||1;for(var l=2,p=u-s,v=2*(o+1)*(2+l),m=a(3,v),d=a(3,v),y=a(2,v),g=0;l>g;g++){var x=2*(g/(l-1)-.5);c(e,g,[1,1,1],[0,0,0],1,0),c(e,g,[0,0,0],[x,0,0],0,0),c(r,g,[1,1,1],[0,0,0],1,0),c(r,g,[0,0,0],[x,0,0],0,1)}var b=a(3,2*o*(2+l),Uint16Array),E=o+1;return f(0*E,4*E),f(5*E,7*E),f(6*E,2*E),f(3*E,1*E),{position:m,normal:d,texcoord:y,indices:b}}function A(t,e,r,n,i,o){return b(t,t,e,r,n,i,o)}function C(t,e,r,n,i,o){if(3>r)throw Error("radialSubdivisions must be 3 or greater");if(3>n)throw Error("verticalSubdivisions must be 3 or greater");i=i||0,o=o||2*Math.PI,range=o-i;for(var s=r+1,u=n+1,h=s*u,c=a(3,h),f=a(3,h),l=a(2,h),p=a(3,r*n*2,Uint16Array),v=0;u>v;++v)for(var m=v/n,d=m*Math.PI*2,y=Math.sin(d),g=t+y*e,x=Math.cos(d),b=x*e,E=0;s>E;++E){var T=E/r,w=i+T*range,A=Math.sin(w),C=Math.cos(w),_=A*g,R=C*g,k=A*y,P=C*y;c.push(_,b,R),f.push(k,x,P),l.push(T,1-m)}for(var v=0;n>v;++v)for(var E=0;r>E;++E){var S=1+E,M=1+v;p.push(s*v+E,s*M+E,s*v+S),p.push(s*M+E,s*M+S,s*v+S)}return{position:c,normal:f,texcoord:l,indices:p}}function _(t,e,r,n,i){if(3>e)throw Error("divisions must be at least 3");r=r?r:1,i=i?i:1,n=n?n:0;for(var o=(e+1)*(r+1),s=a(3,o),u=a(3,o),h=a(2,o),c=a(3,r*e*2,Uint16Array),f=0,l=t-n,p=e+1,v=0;r>=v;++v){for(var m=n+l*Math.pow(v/r,i),d=0;e>=d;++d){var y=2*Math.PI*d/e,g=m*Math.cos(y),x=m*Math.sin(y);if(s.push(g,0,x),u.push(0,1,0),h.push(1-d/e,v/r),v>0&&d!==e){var b=f+(d+1),E=f+d,T=f+d-p,w=f+(d+1)-p;c.push(b,E,T),c.push(b,T,w)}}f+=e+1}return{position:s,normal:u,texcoord:h,indices:c}}function R(t){return Math.random()*t|0}function k(t,e){e=e||{};var r=t.position.numElements,n=a(4,r,Uint8Array),i=e.rand||function(t,e){return 3>e?R(256):255};if(t.color=n,t.indices)for(var o=0;r>o;++o)n.push(i(o,0),i(o,1),i(o,2),i(o,3));else for(var s=e.vertsPerColor||3,u=r/s,o=0;u>o;++o)for(var h=[i(o,0),i(o,1),i(o,2),i(o,3)],c=0;s>c;++c)n.push(h);return t}function P(t){return function(r){var n=t.apply(this,Array.prototype.slice.call(arguments,1));return e.createBuffersFromArrays(r,n)}}function S(t){return function(r){var n=t.apply(null,Array.prototype.slice.call(arguments,1));return e.createBufferInfoFromArrays(r,n)}}function M(t,e,r,n){n=n||0;for(var i=t.length,o=0;i>o;++o)e[r+o]=t[o]+n}function I(t,e){var n=F(t),i=new n.constructor(e),a=i;return n.numComponents&&n.numElements&&o(i,n.numComponents),t.data&&(a={data:i},r.copyNamedProperties(L,t,a)),a}function U(t){function e(e){for(var r,n=0,i=0;i<t.length;++i){var o=t[i],a=o[e],s=F(a);n+=s.length,(!r||a.data)&&(r=a)}return{length:n,spec:r}}function r(e,r,n){for(var i=0,o=0,a=0;a<t.length;++a){var s=t[a],u=s[e],h=F(u);"indices"===e?(M(h,n,o,i),i+=r[a]):M(h,n,o),o+=h.length}}for(var n,i={},o=0;o<t.length;++o){var a=t[o];Object.keys(a).forEach(function(t){i[t]||(i[t]=[]),n||"indices"===t||(n=t);var e=a[t],r=O(e,t),o=F(e),s=o.length/r;i[t].push(s)})}var s=i[n],u={};return Object.keys(i).forEach(function(t){var n=e(t),i=I(n.spec,n.length);r(t,s,F(i)),u[t]=i}),u}function B(t){var e={};return Object.keys(t).forEach(function(r){var n=t[r],i=F(n),o=I(n,i.length);M(i,F(o),0),e[r]=o}),e}var F=t.getArray_,O=t.getNumComponents_,D=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]],L=["numComponents","size","type","normalize","stride","offset","attrib","name","attribName"];return{create3DFBufferInfo:S(T),create3DFBuffers:P(T),create3DFVertices:T,createAugmentedTypedArray:a,createCubeBufferInfo:S(x),createCubeBuffers:P(x),createCubeVertices:x,createPlaneBufferInfo:S(y),createPlaneBuffers:P(y),createPlaneVertices:y,createSphereBufferInfo:S(g),createSphereBuffers:P(g),createSphereVertices:g,createTruncatedConeBufferInfo:S(b),createTruncatedConeBuffers:P(b),createTruncatedConeVertices:b,createXYQuadBufferInfo:S(d),createXYQuadBuffers:P(d),createXYQuadVertices:d,createCresentBufferInfo:S(w),createCresentBuffers:P(w),createCresentVertices:w,createCylinderBufferInfo:S(A),createCylinderBuffers:P(A),createCylinderVertices:A,createTorusBufferInfo:S(C),createTorusBuffers:P(C),createTorusVertices:C,createDiscBufferInfo:S(_),createDiscBuffers:P(_),createDiscVertices:_,deindexVertices:u,flattenNormals:h,makeRandomVertexColors:k,reorientDirections:l,reorientNormals:p,reorientPositions:v,reorientVertices:m,concatVertices:U,duplicateVertices:B}}),r("main",["twgl/twgl","twgl/m4","twgl/v3","twgl/primitives"],function(t,e,r,n){return t.m4=e,t.v3=r,t.primitives=n,t}),e(["main"],function(t){return t},void 0,!0),r("build/js/twgl-includer-full",function(){}),e("main")});var VERTICES_PER_HEX=6,ScaleToFit={FitCenter:0,Fill:1,FitEnd:2,FitStart:3},Point=function(){function t(e,r){_classCallCheck(this,t),this.x=e,this.y=r}return _createClass(t,[{key:"isInside",value:function(t,e,r,n){return e>this.y!=n>this.y&&this.x<(r-t)*(this.y-e)/(n-e)+t}},{key:"offset",value:function(t,e){this.x+=t,this.y+=e}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"{x: "+this.x+", y: "+this.y+"}"}}],[{key:"fromPoint",value:function(e){return new t(e.x,e.y)}},{key:"midpointOf",value:function(e,r){var n=.5*(e.x+r.x),i=.5*(e.y+r.y);return new t(n,i)}}]),t}(),Vec2=function(){function t(e,r){_classCallCheck(this,t),this.x=e,this.y=r}return _createClass(t,[{key:"len",value:function(){return Math.sqrt(this.len2())}},{key:"len2",value:function(){return this.x*this.x+this.y*this.y}},{key:"normalize",value:function(){this.divScalar(this.len())}},{key:"mulScalar",value:function(t){this.x*=t,this.y*=t}},{key:"divScalar",value:function(t){this.x/=t,this.y/=t}},{key:"add",value:function(t){this.x+=t.x,this.y+=t.y}},{key:"subtract",value:function(t){this.x-=t.x,this.y-=t.y}},{key:"multiply",value:function(t){this.x*=t.x,this.y*=t.y}},{key:"divide",value:function(t){this.x/=t.x,this.y/=t.y}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"invert",value:function(){this.x=-this.x,this.y=-this.y}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"{x: "+this.x+", y: "+this.y+" len: "+this.len()+"}"}}],[{key:"from",value:function(e,r){return new t(r.x-e.x,r.y-e.y)}}]),t}(),Rect=function(){function t(e,r,n,i){_classCallCheck(this,t),this.left=e,this.top=r,this.right=n,this.bottom=i}return _createClass(t,[{key:"set",value:function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom}},{key:"setLTRB",value:function(t,e,r,n){this.left=t,this.top=e,this.right=r,this.bottom=n}},{key:"setLBRT",value:function(t,e,r,n){this.left=t,this.top=n,this.right=r,this.bottom=e}},{key:"setLRBT",value:function(t,e,r,n){this.left=t,this.top=n,this.right=e,this.bottom=r}},{key:"setEmpty",value:function(){this.left=0,this.top=0,this.right=0,this.bottom=0}},{key:"setUnion",value:function(t,e,r){this.left=this.right=t[e++],this.top=this.bottom=t[e++],this.unionPoints(t,e,r-1)}},{key:"sort",value:function(){if(this.bottom>this.top){var t=this.top;this.top=this.bottom,this.bottom=t}if(this.left>this.right){var e=this.right;this.right=this.left,this.left=e}}},{key:"isEmpty",value:function(){this.left>=this.right||this.bottom>=this.top}},{key:"isValid",value:function(){return this.right>=this.left&&this.top>=this.bottom}},{key:"width",value:function(){return this.right-this.left}},{key:"height",value:function(){return this.top-this.bottom}},{key:"area",value:function(){return width()*height()}},{key:"topLeft",value:function(){return new Point(this.left,this.top)}},{key:"bottomLeft",value:function(){return new Point(this.left,this.bottom)}},{key:"bottomRight",value:function(){return new Point(this.right,this.bottom)}},{key:"topRight",value:function(){return new Point(this.right,this.top)}},{key:"center",value:function(){return new Point(this.centerX(),this.centerY())}},{key:"centerX",value:function(){return.5*(this.left+this.right)}},{key:"centerY",value:function(){return.5*(this.bottom+this.top)}},{key:"containsRect",value:function(t){return this.left<=t.left&&t.right<=this.right&&this.bottom<=t.bottom&&t.top<=this.top}},{key:"containsPoint",value:function(t){return this.contains(t.x,t.y)}},{key:"contains",value:function(t,e){return this.left<=t&&t<=this.right&&this.bottom<=e&&e<=this.top}},{key:"unionRect",value:function(t){this.left=Math.min(this.left,t.left),this.right=Math.max(this.right,t.right),this.bottom=Math.min(this.bottom,t.bottom),this.top=Math.max(this.top,t.top)}},{key:"unionPoints",value:function(t,e,r){for(var n=0;r>n;n++)this.union(t[e++],t[e++])}},{key:"unionPoint",value:function(t){this.union(t.x,t.y)}},{key:"union",value:function(t,e){this.left=Math.min(t,this.left),this.top=Math.max(e,this.top),this.right=Math.max(t,this.right),this.bottom=Math.min(e,this.bottom)}},{key:"intersectRect",value:function(t){this.left=Math.max(this.left,t.left),this.right=Math.min(this.right,t.right),this.bottom=Math.max(this.bottom,t.bottom),this.top=Math.min(this.top,t.top)}},{key:"intersectsRect",value:function(t){return this.right>=t.left&&t.right>=this.left&&this.top>=t.bottom&&t.top>=this.bottom}},{key:"intersectsRectByPercent",value:function(e,r){var n=t.fromIntersection(this,e);return n.isValid()&&n.area/e.area>=r}},{key:"offset",value:function(t,e){this.left+=t,this.top+=e,this.right+=t,this.bottom+=e}},{key:"inset",value:function(t,e){this.left+=t,this.top-=e,this.right-=t,this.bottom+=e}},{key:"mulScalar",value:function(t){this.left*=t,this.top*=t,this.right*=t,this.bottom*=t}},{key:"divScalar",value:function(t){this.left/=t,this.top/=t,this.right/=t,this.bottom/=t}},{key:"draw",value:function(t){this.strokeColor&&this.lineWidth&&(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeColor,t.strokeRect(this.left,this.bottom,this.width(),this.height())),this.fillColor&&(t.fillStyle=this.fillColor,t.fillRect(this.left,this.bottom,this.width(),this.height()))}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"{bottom: "+this.bottom+", left: "+this.left+", width: "+this.width()+", height: "+this.height()+", isValid: "+this.isValid()+"}"}}],[{key:"fromRect",value:function(e){return new t(e.left,e.top,e.right,e.bottom)}},{key:"fromLBRT",value:function(e,r,n,i){return new t(e,i,n,r)}},{key:"fromLRBT",value:function(e,r,n,i){return new t(e,i,r,n)}},{key:"fromTwoPoints",value:function(e,r){var n=new t(e.x,e.y,e.x,e.y);return n.unionPoint(r),n}},{key:"fromUnion",value:function(e,r,n){var i=new t(0,0,0,0);return i.setUnion(e,r,n),i}},{key:"fromIntersection",value:function(e,r){var n=t.fromRect(e);return n.intersectRect(r),n}},{key:"fromDimensions",value:function(e,r,n,i){return new t(e,r+i,e+n,r)}}]),t}(),Color=function(){function t(e,r,n){_classCallCheck(this,t),this.r=e,this.g=r,this.b=n}return _createClass(t,[{key:"setRGB",value:function(t,e,r){this.r=t,this.g=e,this.b=r}},{key:"setColor",value:function(t){this.r=t.r,this.g=t.g,this.b=t.b}},{key:"setHex",value:function(t){this.r=t>>16&255,this.g=t>>8&255,this.b=t>>0&255}},{key:"setHexString",value:function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);this.r=parseInt(e[1],16),this.g=parseInt(e[2],16),this.b=parseInt(e[3],16)}},{key:"setRandom",value:function(){this.r=getRandomInt(0,255),this.g=getRandomInt(0,255),this.b=getRandomInt(0,255)}},{key:"equals",value:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b}},{key:"toHex",value:function(){return this.r<<16|this.g<<8|this.b}},{key:"toHexString",value:function(){var t=(1<<24|this.toHex()).toString(16);return"#"+t.slice(1)}},{key:"toString",value:function(){return"{r: "+this.r+", g: "+this.g+", b: "+this.b+"}"}}],[{key:"fromHex",value:function(e){var r=new t;return r.setHex(e),r}},{key:"fromHexString",value:function(e){var r=new t;return r.setHexString(e),r}},{key:"random",value:function(){var e=new t;return e.setRandom(),e}}]),t}(),Matrix=function(){function t(e,r,n,i,o,a){_classCallCheck(this,t),this.m11=e,this.m12=r,this.m13=n,this.m21=i,this.m22=o,this.m23=a}return _createClass(t,[{key:"determinant",value:function(){return this.m11*this.m22-this.m12*this.m21}},{key:"inverse",value:function(){var e=1/this.determinant(),r=this.m22*e,n=-this.m12*e,i=(this.m12*this.m23-this.m13*this.m22)*e,o=-this.m21*e,a=this.m11*e,s=(this.m21*this.m13-this.m11*this.m23)*e;return new t(r,n,i,o,a,s)}},{key:"moveOrigin",value:function(t,e){this.preTranslate(-t,-e),this.postTranslate(t,e)}},{key:"postConcat",value:function(t){this.setConcat(t,this)}},{key:"preConcat",value:function(t){this.setConcat(this,t)}},{key:"postRotate",value:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.m11,i=this.m12,o=this.m13;this.m11=r*n-e*this.m21,this.m12=r*i-e*this.m22,this.m13=r*o-e*this.m23,this.m21=e*n+r*this.m21,this.m22=e*i+r*this.m22,this.m23=e*o+e*this.m23}},{key:"preRotate",value:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.m11,i=this.m21;this.m11=n*r+this.m12*e,this.m21=i*r+this.m22*e,this.m12=n*-e+this.m12*r,this.m22=i*-e+this.m22*r}},{key:"postScale",value:function(t,e){this.m11*=t,this.m12*=t,this.m13*=t,this.m21*=e,this.m22*=e,this.m23*=e}},{key:"preScale",value:function(t,e){this.m11*=t,this.m21*=t,this.m12*=e,this.m22*=e;

}},{key:"postStretch",value:function(t){this.postScale(t,t)}},{key:"preStretch",value:function(t){this.preScale(t,t)}},{key:"postTranslate",value:function(t,e){this.m13+=t,this.m23+=e}},{key:"preTranslate",value:function(t,e){this.m13+=this.m11*t+this.m12*e,this.m23+=this.m21*t+this.m22*e}},{key:"set",value:function(t,e,r,n,i,o){this.m11=t,this.m12=e,this.m13=r,this.m21=n,this.m22=i,this.m23=o}},{key:"setConcat",value:function(t,e){this.set(t.m11*e.m11+t.m12*e.m21,t.m11*e.m12+t.m12*e.m22,t.m11*e.m13+t.m12*e.m23+t.m13,t.m21*e.m11+t.m22*e.m21,t.m21*e.m12+t.m22*e.m22,t.m21*e.m13+t.m22*e.m23+t.m23)}},{key:"setIdentity",value:function(){this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0}},{key:"setRectToRect",value:function(t,e,r){var n=void 0,i=void 0;switch(r){case ScaleToFit.FitCenter:n=t.center(),i=e.center();break;case ScaleToFit.FitEnd:n=t.bottomRight(),i=e.bottomRight();break;default:n=t.topLeft(),i=e.topLeft()}var o=e.width()/t.width(),a=e.height()/t.height();this.setTranslate(-n.x,-n.y),r===ScaleToFit.Fill?this.postScale(o,a):this.postStretch(Math.min(o,a)),this.postTranslate(i.x,i.y)}},{key:"setRotate",value:function(t){var e=Math.sin(t),r=Math.cos(t);this.setSinCos(e,r)}},{key:"setSinCos",value:function(t,e){this.m11=e,this.m12=-t,this.m13=0,this.m21=t,this.m22=e,this.m23=0}},{key:"setScale",value:function(t,e){this.m11=t,this.m12=0,this.m13=0,this.m21=0,this.m22=e,this.m23=0}},{key:"setStretch",value:function(t){this.setScale(t,t)}},{key:"setTranslate",value:function(t,e){this.m11=1,this.m12=0,this.m13=t,this.m21=0,this.m22=1,this.m23=e}},{key:"mapPoint",value:function(t,e){e="undefined"!=typeof e?e:t;var r=this.mapX(t.x,t.y),n=this.mapY(t.x,t.y);e.x=r,e.y=n}},{key:"mapPoints",value:function(t,e,r,n,i){for(var o=0;i>o;o++){var a=t[e++],s=t[e++];r[n++]=this.mapX(a,s),r[n++]=this.mapY(a,s)}}},{key:"mapRect",value:function(t,e){e="undefined"!=typeof e?e:t;var r=t.topLeft(),n=t.bottomLeft(),i=t.bottomRight(),o=t.topRight();this.mapPoint(r),this.mapPoint(n),this.mapPoint(i),this.mapPoint(o),e.left=e.right=r.x,e.top=e.bottom=r.y,e.unionPoint(n),e.unionPoint(i),e.unionPoint(o)}},{key:"mapX",value:function(t,e){return this.m11*t+this.m12*e+this.m13}},{key:"mapY",value:function(t,e){return this.m21*t+this.m22*e+this.m23}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"m11: "+this.m11+", m12: "+this.m12+", m13: "+this.m13+", m21: "+this.m21+", m22: "+this.m22+", m23: "+this.m23}}],[{key:"identity",value:function(){return new t(1,0,0,0,1,0)}},{key:"rectToRect",value:function(e,r,n){var i=new t;return i.setRectToRect(e,r,n),i}},{key:"rotateAboutOrigin",value:function(e){var r=new t;return r.setRotate(e),r}},{key:"rotateByAngle",value:function(e,r){var n=Math.sin(r),i=Math.cos(r);return t.rotateBySinCos(e,n,i)}},{key:"rotateBySinCos",value:function(e,r,n){var i=new t;return i.setSinCos(r,n),i.moveOrigin(e.x,e.y),i}},{key:"rotateFrom",value:function(e,r,n){var i=Vec2.from(e,r),o=Vec2.from(e,n);i.normalize(),o.normalize();var a=i.cross(o),s=i.dot(o);return t.rotateBySinCos(e,a,s)}},{key:"scaleAboutOrigin",value:function(e,r){var n=new t;return n.setScale(e,r),n}},{key:"scaleByRatios",value:function(e,r,n){var i=new t;return i.setScale(r,n),i.moveOrigin(e.x,e.y),i}},{key:"scaleFrom",value:function(e,r,n){var i=(n.x-e.x)/(r.x-e.x),o=(n.y-e.y)/(r.y-e.y);return t.scaleByRatios(e,i,o)}},{key:"stretchAboutOrigin",value:function(e){var r=new t;return r.setStretch(e),r}},{key:"stretchByRatio",value:function(e,r){return t.scaleByRatios(e,r,r)}},{key:"stretchFrom",value:function(e,r,n){var i=Vec2.from(e,r).len(),o=Vec2.from(e,n).len(),a=o/i;return t.stretchByRatio(e,a)}},{key:"stretchRotateFrom",value:function(e,r,n){var i=Vec2.from(e,r),o=Vec2.from(e,n),a=i.len(),s=o.len(),u=s/a;i.mulScalar(1/a),o.mulScalar(1/s);var h=i.cross(o),c=i.dot(o),f=new t;return f.setSinCos(h,c),f.postStretch(u),f.moveOrigin(e.x,e.y),f}},{key:"translate",value:function(e,r){return new t(1,0,e,0,1,r)}},{key:"mult",value:function(e,r){var n=new t;return n.setConcat(e,r),n}}]),t}(),Path=function(){function t(e){_classCallCheck(this,t),this.data=e,this.capacity=e.length/2,this.count=0}return _createClass(t,[{key:"put",value:function(t,e){this.set(t,e,this.count++)}},{key:"putPoint",value:function(t){this.setPoint(t,this.count++)}},{key:"putPath",value:function(t){this.putData(t.data)}},{key:"putData",value:function(t){this.setData(t,this.count),this.count+=t.length/2}},{key:"set",value:function(t,e,r){var n=2*r;this.data[n]=t,this.data[n+1]=e}},{key:"setPoint",value:function(t,e){this.set(t.x,t.y,e)}},{key:"setPath",value:function(t,e){this.setData(t.data,e)}},{key:"setData",value:function(t,e){this.data.set(t,2*this.offset)}},{key:"pointAt",value:function(t){var e=2*t,r=this.data[e],n=this.data[e+1];return new Point(r,n)}},{key:"pointBetween",value:function(t,e){return Point.midpointOf(this.pointAt(t),this.pointAt(e))}},{key:"calculateBounds",value:function(){return Rect.fromUnion(this.data,0,this.count)}},{key:"calculateBoundsOfSubset",value:function(t,e){return Rect.fromUnion(this.data,2*t,e)}},{key:"containsPoint",value:function(t){return this.containsPointInSubset(t,0,this.count)}},{key:"containsPointInSubset",value:function(t,e,r){for(var n=!1,i=e,o=r-1;r>i;o=i++){var a=this.pointAt(o),s=this.pointAt(i);t.isInside(a.x,a.y,s.x,s.y)&&(n=!n)}return n}},{key:"translate",value:function(t,e){for(var r=0;r<this.data.length;)this.data[r++]+=t,this.data[r++]+=e}},{key:"transform",value:function(t){t.mapPoints(this.data,0,this.data,0,this.count)}},{key:"transformSubset",value:function(t,e,r){t.mapPoints(this.data,2*e,this.data,2*e,r)}},{key:"draw",value:function(t){t.beginPath(),t.moveTo(this.data[0],this.data[1]);for(var e=2;e<this.data.length;)t.lineTo(this.data[e++],this.data[e++]);t.closePath(),this.strokeColor&&(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeColor,t.stroke()),this.fillColor&&(t.fillStyle=this.fillColor,t.fill())}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"{capacity: "+this.capacity+", count: "+this.count+", data: "+this.data+"}"}}],[{key:"fromPath",value:function(e){var r=new Float32Array(e.data),n=new t(r);return n.count=e.count,n}},{key:"withCapacity",value:function(e){var r=2*e,n=r*Float32Array.BYTES_PER_ELEMENT,i=new ArrayBuffer(n),o=new Float32Array(i,0,r);return new t(o)}}]),t}(),Mesh=function(){function t(e,r,n){_classCallCheck(this,t),this.path=e,this.bounds=e.calculateBounds(),this.fixedPoint=r,this.controlPoint=n}return _createClass(t,[{key:"contains",value:function(t){return this.bounds.containsPoint(t)&&this.path.containsPoint(t)}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"path: "+this.path.toString()+", bounds: "+this.bounds.toString()+",\n                    fixedPoint: "+this.fixedPoint+", controlPoint: "+this.controlPoint}}],[{key:"nGon",value:function(e){var r=Path.withCapacity(e),n=new Point(0,-100);r.putPoint(n);for(var i=Matrix.rotateAboutOrigin(2*Math.PI/e);r.count<r.capacity;)i.mapPoint(n),r.putPoint(n);var o=r.pointAt(0),a=Math.floor(e/2),s=1&e?r.pointBetween(a,a+1):r.pointAt(a);return new t(r,o,s)}},{key:"nStar",value:function(e,r,n){var i=Path.withCapacity(e+e),o=2*Math.PI/e,a=new Matrix,s=new Point(0,-n);i.putPoint(s);var u=new Point(0,-r);for(a.setRotate(.5*o),a.mapPoint(u),i.putPoint(u),a.setRotate(o);i.count<i.capacity;)a.mapPoint(s),i.putPoint(s),a.mapPoint(u),i.putPoint(u);var h=i.pointAt(0),c=1&e?i.pointBetween(e-1,e+1):i.pointAt(e);return new t(i,h,c)}},{key:"bat",value:function(){var e=Path.withCapacity(20);e.put(0,3),e.put(-2,5),e.put(-3,2),e.put(-5,0),e.put(-8,3),e.put(-10,7),e.put(-17,10),e.put(-13,5),e.put(-12,-1),e.put(-3,-7),e.put(0,-10),e.put(3,-7),e.put(12,-1),e.put(13,5),e.put(17,10),e.put(10,7),e.put(8,3),e.put(5,0),e.put(3,2),e.put(2,5),e.transform(Matrix.scaleAboutOrigin(1,-1));var r=e.pointBetween(1,19),n=e.pointAt(10);return new t(e,r,n)}},{key:"heart",value:function(){var e=Path.withCapacity(10);e.put(0,12),e.put(-3,16),e.put(-5,16),e.put(-8,12),e.put(-8,8),e.put(0,0),e.put(8,8),e.put(8,12),e.put(5,16),e.put(3,16);var r=e.pointBetween(1,9),n=e.pointAt(5);return new t(e,r,n)}},{key:"flower",value:function(){var e=Path.withCapacity(20);e.put(0,-2),e.put(-1,-1),e.put(-2,-1),e.put(-2,-2),e.put(-3,-3),e.put(-1,-3),e.put(-2,-4),e.put(-2,-5),e.put(-1,-5),e.put(0,-6),e.put(0,-4),e.put(1,-5),e.put(2,-5),e.put(2,-4),e.put(3,-3),e.put(1,-3),e.put(2,-2),e.put(2,-1),e.put(1,-1),e.put(0,0);var r=e.pointAt(19),n=e.pointAt(9);return new t(e,r,n)}}]),t}(),Shape=function(){function t(e){_classCallCheck(this,t),this.mesh=e,this.matrix=Matrix.identity(),this.inverse=Matrix.identity()}return _createClass(t,[{key:"setBounds",value:function(t,e){this.matrix.setRectToRect(this.mesh.bounds,t,e),this.inverse.setRectToRect(t,this.mesh.bounds,e)}},{key:"setEndPoints",value:function(t,e){var r=Vec2.from(this.mesh.fixedPoint,t),n=Point.fromPoint(this.mesh.controlPoint);n.offset(r.x,r.y),this.matrix=Matrix.stretchRotateFrom(t,n,e),this.matrix.preTranslate(r.x,r.y),this.inverse=this.matrix.inverse()}},{key:"containsPoint",value:function(t){var e=new Point;return this.inverse.mapPoint(t,e),this.mesh.contains(e)}},{key:"draw",value:function(t){if(this.matrix){t.beginPath();var e=this.mesh.path.data,r=e[0],n=e[1];t.moveTo(this.matrix.mapX(r,n),this.matrix.mapY(r,n));for(var i=2;i<e.length;)r=e[i++],n=e[i++],t.lineTo(this.matrix.mapX(r,n),this.matrix.mapY(r,n));t.closePath(),this.strokeColor&&(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeColor,t.stroke()),this.fillColor&&(t.fillStyle=this.fillColor,t.fill())}}},{key:"log",value:function(){console.log(this.toString())}},{key:"toString",value:function(){return"mesh: "+this.mesh.toString()+", fillColor: "+this.fillColor+", matrix: "+this.matrix}}]),t}(),DragDetector=function(){function t(e,r,n,i,o){_classCallCheck(this,t);var a=!1;e.addEventListener("mousedown",function(t){a=!0,t.preventDefault(),t.stopPropagation(),r(t)},!1),e.addEventListener("mousemove",function(t){a&&(t.preventDefault(),t.stopPropagation(),n(t))},!1),e.addEventListener("mouseup",function(t){a&&(t.preventDefault(),t.stopPropagation(),a=!1,i(t))},!1),e.addEventListener("mouseout",function(t){a&&(t.preventDefault(),t.stopPropagation(),a=!1,o(t))},!1),e.addEventListener("touchstart",function(t){a=!0,t.preventDefault(),t.stopPropagation(),r(t.touches[0])},!1),e.addEventListener("touchmove",function(t){a&&(t.preventDefault(),t.stopPropagation(),n(t.touches[0]))},!1),e.addEventListener("touchend",function(t){a&&(t.preventDefault(),t.stopPropagation(),a=!1,i(t.touches[0]))},!1),e.addEventListener("touchleave",function(t){a&&(t.preventDefault(),t.stopPropagation(),a=!1,o(t.touches[0]))},!1)}return _createClass(t,null,[{key:"getTouchPos",value:function(t,e){return this.getMousePos(t.touches[0],e)}},{key:"getMousePos",value:function(t,e){var r=e||new Point;if(t.offsetX)r.x=t.offsetX,r.y=t.offsetY;else if(t.layerX)r.x=t.layerX,r.y=t.layerY;else{var n=canvas.getBoundingClientRect();r.x=t.clientX-n.left,r.y=t.clientY-n.top}return r}}]),t}(),Cube=function(){function t(e,r,n){_classCallCheck(this,t),this.q=e,this.r=r,this.s=n||-e-r}return _createClass(t,[{key:"round",value:function(){var t=this.q,e=this.r,r=this.s;this.q=Math.round(t),this.r=Math.round(e),this.s=Math.round(r);var n=Math.abs(this.q-t),i=Math.abs(this.r-e),o=Math.abs(this.s-r);n>i&&n>o?this.q=-this.r-this.s:i>o?this.r=-this.q-this.s:this.s=-this.q-this.r}},{key:"add",value:function(t){this.q+=t.q,this.r+=t.r,this.s+=t.s}},{key:"subtract",value:function(t){this.q-=t.q,this.r-=t.r,this.s-=t.s}},{key:"distanceTo",value:function(t){return Math.max(Math.abs(this.q-t.q),Math.abs(this.r-t.r),Math.abs(this.s-t.s))}},{key:"distanceToOrigin",value:function(){return Math.max(Math.abs(this.q),Math.abs(this.r),Math.abs(this.s))}},{key:"neighbors",value:function(){for(var t=[],e=0;e<Directions.length;e++)t.push(this.neighbor(Directions[e]));return t}},{key:"neighbor",value:function(e){var r=t.fromCube(this);return r.add(e),r}},{key:"equals",value:function(t){return this.q===t.q&&this.r===t.r&&this.s===t.s}}],[{key:"fromCube",value:function(e){return new t(e.q,e.r,e.s)}}]),t}(),Directions=[new Cube(1,-1,0),new Cube(1,0,-1),new Cube(0,1,-1),new Cube(-1,1,0),new Cube(-1,0,1),new Cube(0,-1,1)],Hex=function(){function t(e,r,n){_classCallCheck(this,t),this.position=e,this.center=r,this.color=n}return _createClass(t,[{key:"equals",value:function(t){return this.color===t.color&&this.position.equals(t.position)}}]),t}(),Orientation={FlatTop:1,PointyTop:2},Grid=function(){function t(e){_classCallCheck(this,t),this.coordinates=[],this.orientation=e}return _createClass(t,[{key:"indexOf",value:function(t){for(var e=0;e<this.coordinates.length;e++)if(this.coordinates[e].equals(t))return e;return-1}},{key:"measureWidth",value:function(t,e){return 0}},{key:"measureWidth",value:function(t,e){return 0}}]),t}(),RectangleGrid=function(t){function e(t,r,n){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));if(i.rows=r,i.cols=n,i.orientation===Orientation.FlatTop)for(var o=0;n>o;o++)for(var a=o>>1,s=-a;r-a>s;s++)i.coordinates.push(new Cube(o,s));else for(var u=0;r>u;u++)for(var h=u>>1,c=-h;n-h>c;c++)i.coordinates.push(new Cube(c,u));return i}return _inherits(e,t),_createClass(e,[{key:"indexOf",value:function(t){var e=void 0;return e=this.orientation===Orientation.FlatTop?this.rows*t.q+t.r+(t.q>>1):this.cols*t.r+t.q+(t.r>>1),e>=0&&e<this.coordinates.length&&this.coordinates[e].equals(t)?e:-1}},{key:"measureWidth",value:function(t){return this.orientation===Orientation.FlatTop?t.hexWidth*(.75*this.cols+.25):t.hexWidth*(this.cols+.5)}},{key:"measureHeight",value:function(t){return this.orientation===Orientation.FlatTop?t.hexHeight*(this.rows+.5):t.hexHeight*(.75*this.rows+.25)}}]),e}(Grid),Layout=function(){function t(e,r){_classCallCheck(this,t),this.grid=e,this.hexSize=r||1,e.orientation===Orientation.FlatTop?(this.hexWidth=2*this.hexSize,this.hexHeight=this.hexSize*Math.sqrt(3),this.hexRight=(this.hexWidth-this.hexSize)/2,this.hexUp=this.hexHeight/2):(this.hexHeight=2*this.hexSize,this.hexWidth=this.hexSize*Math.sqrt(3),this.hexRight=this.hexWidth/2,this.hexUp=(this.hexHeight-this.hexSize)/2),this.width=e.measureWidth(this),this.height=e.measureHeight(this);var n=this.width/2,i=this.height/2;this.bounds=Rect.fromLRBT(-n,n,-i,i),this.hexes=[];for(var o=0;o<e.coordinates.length;o++){var a=e.coordinates[o],s=this.findBottomLeftOfHexAt(a);s.x+=this.hexWidth/2,s.y+=this.hexHeight/2,this.hexes.push(new Hex(a,s,-1))}var u=this.hexes.length;this.vertices=this.generateVertices(u),this.indices=this.generateIndices(u),this.colors=this.generateColors(u)}return _createClass(t,[{key:"generateVertices",value:function(t){for(var e=twgl.primitives.createAugmentedTypedArray(2,VERTICES_PER_HEX*t),r=0;t>r;r++){var n=this.grid.coordinates[r];this.generateHexVertices(n,e)}return e}},{key:"generateIndices",value:function(t){for(var e=twgl.primitives.createAugmentedTypedArray(1,12*t,Uint16Array),r=0;t>r;r++){var n=r*VERTICES_PER_HEX;e.push(n,n+1,n+2,n,n+2,n+3,n,n+3,n+4,n,n+4,n+5)}return e}},{key:"generateColors",value:function(t){for(var e=twgl.primitives.createAugmentedTypedArray(3,VERTICES_PER_HEX*t,Uint8Array),r=0;t>r;r++)for(var n=0;VERTICES_PER_HEX>n;n++)e.push(235-n*n,235-n*n,235-n*n);return e}},{key:"generateHexVertices",value:function(t,e){var r=this.findBottomLeftOfHexAt(t),n=r.x,i=r.y;this.grid.orientation===Orientation.FlatTop?(e.push(n+this.hexRight+this.hexSize,i+this.hexHeight),e.push(n+this.hexRight,i+this.hexHeight),e.push(n,i+this.hexUp),e.push(n+this.hexRight,i),e.push(n+this.hexRight+this.hexSize,i),e.push(n+this.hexWidth,i+this.hexUp)):(e.push(n+this.hexRight,i+this.hexHeight),e.push(n,i+this.hexUp+this.hexSize),e.push(n,i+this.hexUp),e.push(n+this.hexRight,i),e.push(n+this.hexWidth,i+this.hexUp),e.push(n+this.hexWidth,i+this.hexUp+this.hexSize))}},{key:"findBottomLeftOfHexAt",value:function(t){var e=this.bounds.left,r=this.bounds.bottom;return this.grid.orientation===Orientation.FlatTop?(e+=t.q*this.hexWidth*.75,r+=(t.r+t.q/2)*this.hexHeight):(e+=(t.q+t.r/2)*this.hexWidth,r+=t.r*this.hexHeight*.75),new Point(e,r)}},{key:"clipToCube",value:function(t){var e=void 0,r=void 0,n=t.x-(this.hexWidth/2+this.bounds.left),i=t.y-(this.hexHeight/2+this.bounds.bottom);return this.grid.orientation===Orientation.FlatTop?(e=2*n/3/this.hexSize,r=(-n/3+Math.sqrt(3)/3*i)/this.hexSize):(e=(n*Math.sqrt(3)/3-i/3)/this.hexSize,r=2*i/3/this.hexSize),new Cube(e,r)}},{key:"indexOfHexContaining",value:function(t){var e=this.clipToCube(t);return e.round(),this.grid.indexOf(e)}},{key:"getColorIndex",value:function(t){return t*this.colors.numComponents*VERTICES_PER_HEX}},{key:"getHexagonColor",value:function(t){var e=this.hexes[t].color;return Color.fromHex(e)}},{key:"setHexagonColor",value:function(t,e,r){var n=this.hexes[t],i=n.color,o=e.toHex();if(i!==o){n.color=o,r&&r.add(t,i);for(var a=this.getColorIndex(t),s=3;6>s;s++){var u=2*s*s;this.colors[a++]=Math.min(e.r+u,255),this.colors[a++]=Math.min(e.g+u,255),this.colors[a++]=Math.min(e.b+u,255)}for(var h=3;6>h;h++){var c=2*h*h;this.colors[a++]=Math.max(e.r-c,0),this.colors[a++]=Math.max(e.g-c,0),this.colors[a++]=Math.max(e.b-c,0)}}}},{key:"addLine",value:function(t,e,r,n,i){var o=Cube.fromCube(e);o.subtract(t);for(var a=o.distanceToOrigin(),s=1/Math.max(a,1),u=0;a>=u;u++){var h=s*u,c=new Cube;c.q=t.q+o.q*h,c.r=t.r+o.r*h,c.s=t.s+o.s*h,c.round();var f=this.grid.indexOf(c);-1!==f&&this.fillRange(f,r,n,i)}}},{key:"addRect",value:function(t,e,r){for(var n=0;n<this.hexes.length;n++)t.containsPoint(this.hexes[n].center)&&this.setHexagonColor(n,e,r)}},{key:"addShape",value:function(t,e,r){for(var n=0;n<this.hexes.length;n++)t.containsPoint(this.hexes[n].center)&&this.setHexagonColor(n,e,r)}},{key:"fillRange",value:function(t,e,r,n){var i=this.hexes[t].position;this.setHexagonColor(t,r,n);for(var o=-e;e>=o;o++)for(var a=Math.max(-e,-o-e),s=Math.min(e,-o+e),u=a;s>=u;u++){var h=new Cube(o,u);h.add(i);var c=this.grid.indexOf(h);-1!==c&&this.setHexagonColor(c,r,n)}}},{key:"eraseRange",value:function(t,e){var r=this.hexes[t].position;this.eraseHexagonColor(t);for(var n=-e;e>=n;n++)for(var i=Math.max(-e,-n-e),o=Math.min(e,-n+e),a=i;o>=a;a++){var s=new Cube(n,a);s.add(r);var u=this.grid.indexOf(s);-1!==u&&this.eraseHexagonColor(u)}}},{key:"eraseHexagonColor",value:function(t){this.hexes[t].color=-1;for(var e=this.getColorIndex(t),r=0;VERTICES_PER_HEX>r;r++){var n=r*r;this.colors[e++]=235-n,this.colors[e++]=235-n,this.colors[e++]=235-n}}},{key:"floodFill",value:function(t,e){var r=this.hexes[t],n=r.color,i=e.toHex();if(n!==i){this.setHexagonColor(t,e);var o=new Set,a=[];for(a.push(r.position);a.length>0;)for(var s=a.shift(),u=s.neighbors(),h=0;h<u.length;h++){var c=u[h],f=this.grid.indexOf(c);if(-1!=f&&!o.has(f)){o.add(f);var l=this.hexes[f].color;l===n&&(this.setHexagonColor(f,e),a.push(c))}}}}},{key:"reverseChanges",value:function(t){for(;t.positions.length>0;){var e=t.positions.pop(),r=t.colors.pop();-1===r?this.eraseHexagonColor(e):this.setHexagonColor(e,Color.fromHex(r))}}}]),t}(),Changes=function(){function t(){_classCallCheck(this,t),this.positions=[],this.colors=[]}return _createClass(t,[{key:"add",value:function(t,e){this.positions.push(t),this.colors.push(e)}}]),t}(),Projection=function(){function t(){_classCallCheck(this,t),this.scale=1,this.offset=new Vec2(0,0),this["default"]=new Rect,this.region=new Rect,this.matrix=twgl.m4.identity()}return _createClass(t,[{key:"applyChanges",value:function(){this.region.set(this["default"]),this.region.divScalar(this.scale),this.region.offset(this.offset.x,this.offset.y),twgl.m4.ortho(this.region.left,this.region.right,this.region.bottom,this.region.top,.1,10,this.matrix)}}]),t}(),Renderer=function(){function t(e,r){_classCallCheck(this,t),this.gl=e,this.layout=r,this.projection=new Projection}return _createClass(t,[{key:"onSurfaceCreated",value:function(){this.gl.clearColor(0,0,0,1),this.programInfo=twgl.createProgramInfo(this.gl,["vs","fs"]),this.gl.useProgram(this.programInfo.program),this.attribs={a_position:this.layout.vertices,a_color:this.layout.colors,indices:this.layout.indices},this.bufferInfo=twgl.createBufferInfoFromArrays(this.gl,this.attribs),twgl.setBuffersAndAttributes(this.gl,this.programInfo,this.bufferInfo),this.uniforms={u_MVP:this.projection.matrix}}},{key:"onSurfaceChanged",value:function(t,e){if(this.gl.viewport(0,0,t,e),this.projection["default"].set(this.layout.bounds),e>t){var r=e/t;this.projection["default"].bottom=this.projection["default"].left*r,this.projection["default"].top=this.projection["default"].right*r}else{var n=t/e;this.projection["default"].left=this.projection["default"].bottom*n,this.projection["default"].right=this.projection["default"].top*n}this.applyProjectionChanges()}},{key:"onDrawFrame",value:function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),twgl.drawBufferInfo(this.gl,this.bufferInfo)}},{key:"applyColorChanges",value:function(){twgl.setAttribInfoBufferFromArray(this.gl,this.bufferInfo.attribs.a_color,this.attribs.a_color),this.needToRender=!0}},{key:"applyProjectionChanges",value:function(){this.projection.applyChanges(),twgl.setUniforms(this.programInfo,this.uniforms),this.needToRender=!0}}]),t}(),Surface=function(){function t(e,r){_classCallCheck(this,t),this.canvas=e,this.renderer=r;var n=this.canvas.clientWidth,i=this.canvas.clientHeight;this.renderer.onSurfaceCreated(),this.renderer.onSurfaceChanged(n,i)}return _createClass(t,[{key:"requestRender",value:function(){this.renderer.needToRender=!0}},{key:"resize",value:function(){var t=window.devicePixelRatio,e=Math.floor(this.canvas.clientWidth*t),r=Math.floor(this.canvas.clientHeight*t);return this.canvas.width!==e||this.canvas.height!==r?(this.canvas.width=e,this.canvas.height=r,this.renderer.onSurfaceChanged(e,r),!0):!1}},{key:"screenToCanvas",value:function(t,e){var r=e||new Point;if(t.offsetX)r.x=t.offsetX,r.y=t.offsetY;else if(t.layerX)r.x=t.layerX,r.y=t.layerY;else{var n=canvas.getBoundingClientRect();r.x=t.clientX-n.left,r.y=t.clientY-n.top}return r}},{key:"canvasToNdc",value:function(t,e){var r=this.canvas.clientWidth,n=this.canvas.clientHeight,i=e||new Point;return i.x=t.x/r,i.y=(n-t.y)/n,i}},{key:"ndcToClip",value:function(t,e){var r=this.renderer.projection.region,n=e||new Point;return n.x=r.left+t.x*r.width(),n.y=r.bottom+t.y*r.height(),n}},{key:"screenToClip",value:function(t,e){var r=e||new Point;return this.screenToCanvas(t,r),this.canvasToNdc(r,r),this.ndcToClip(r,r),r}}]),t}(),_exports=_exports||{};_exports.ScaleToFit=ScaleToFit,_exports.Point=Point,_exports.Vec2=Vec2,_exports.Rect=Rect,_exports.Color=Color,_exports.Matrix=Matrix,_exports.Path=Path,_exports.Mesh=Mesh,_exports.Shape=Shape,_exports.DragDetector=DragDetector,_exports.Cube=Cube,_exports.Directions=Directions,_exports.Hex=Hex,_exports.Orientation=Orientation,_exports.Grid=Grid,_exports.RectangleGrid=RectangleGrid,_exports.Layout=Layout,_exports.Changes=Changes,_exports.Projection=Projection,_exports.Renderer=Renderer,_exports.Surface=Surface;var ghx=_exports,cout=document.getElementById("cout"),ctx=cout.getContext("2d"),canvas=document.getElementById("c"),gl=twgl.getWebGLContext(canvas),grid=new ghx.RectangleGrid(ghx.Orientation.PointyTop,100,100),layout=new ghx.Layout(grid),renderer=new ghx.Renderer(gl,layout),surface=new ghx.Surface(canvas,renderer);checkRender();var colorPicker=$("#color-picker"),color=ghx.Color.fromHexString($(colorPicker).val());$(colorPicker).change(function(){color.setHexString($(this).val())});var Tool=function t(e,r){_classCallCheck(this,t),this.handleDownAction=e,this.handleDragAction=r},panTool=new Tool;panTool.handleDownAction=function(t){this.previous=surface.screenToClip(t),console.log(this.previous)},panTool.handleDragAction=function(t){var e=surface.screenToClip(t),r=ghx.Vec2.from(e,this.previous),n=renderer.projection.offset;n.add(r),constrainPointToGrid(n),renderer.applyProjectionChanges(),this.previous.x=e.x+r.x,this.previous.y=e.y+r.y};var brush=new Tool;brush.handleDownAction=function(t){},brush.handleDragAction=function(t){var e=surface.screenToClip(t),r=layout.indexOfHexContaining(e);-1!==r&&(layout.fillRange(r,brushSize,color),applyColorChanges())};var eraser=new Tool;eraser.handleDownAction=function(t){},eraser.handleDragAction=function(t){var e=surface.screenToClip(t),r=layout.indexOfHexContaining(e);-1!==r&&(layout.eraseRange(r,brushSize),applyColorChanges())};var paintBucket=new Tool;paintBucket.handleDownAction=function(t){var e=surface.screenToClip(t),r=layout.indexOfHexContaining(e);-1!==r&&(layout.floodFill(r,color),applyColorChanges())},paintBucket.handleDragAction=function(t){};var eyedropper=new Tool;eyedropper.handleDownAction=function(t){var e=surface.screenToClip(t),r=layout.indexOfHexContaining(e);-1!=r&&(color.setColor(layout.getHexagonColor(r)),$(colorPicker).val(color.toHexString()))},eyedropper.handleDragAction=function(t){};var lineTool=new Tool;lineTool.handleDownAction=function(t){var e=surface.screenToClip(t);this.start=layout.clipToCube(e),this.changes=new ghx.Changes},lineTool.handleDragAction=function(t){layout.reverseChanges(this.changes);var e=surface.screenToClip(t),r=layout.clipToCube(e);layout.addLine(this.start,r,brushSize,color,this.changes),applyColorChanges()};var rectangleTool=new Tool;rectangleTool.handleDownAction=function(t){this.start=surface.screenToClip(t),this.changes=new ghx.Changes},rectangleTool.handleDragAction=function(t){layout.reverseChanges(this.changes);var e=surface.screenToClip(t),r=ghx.Rect.fromTwoPoints(this.start,e);layout.addRect(r,color,this.changes),applyColorChanges()};var Meshes=[ghx.Mesh.nGon(3),ghx.Mesh.nStar(2,.5,1),ghx.Mesh.nGon(5),ghx.Mesh.nGon(6),ghx.Mesh.nGon(40),ghx.Mesh.nStar(5,.4,1),ghx.Mesh.heart(),ghx.Mesh.flower(),ghx.Mesh.bat()],shapePicker=$("#shape-picker"),mesh=Meshes[$(shapePicker).val()];$(shapePicker).change(function(){mesh=Meshes[$(this).val()]});var shapeTool=new Tool;shapeTool.handleDownAction=function(t){this.changes=new ghx.Changes,this.start=surface.screenToClip(t),this.shape=new ghx.Shape(mesh)},shapeTool.handleDragAction=function(t){layout.reverseChanges(this.changes);var e=surface.screenToClip(t);this.shape.setEndPoints(this.start,e),layout.addShape(this.shape,color,this.changes),applyColorChanges()};var Tools=[brush,eraser,paintBucket,eyedropper,lineTool,rectangleTool,shapeTool],toolPicker=$("#tool-picker"),tool=Tools[$(toolPicker).val()];$(toolPicker).change(function(){tool=Tools[$(this).val()]});var brushSizePicker=$("#brush-size-picker"),brushSize=$(brushSizePicker).val()-1;$(brushSizePicker).change(function(){brushSize=$(brushSizePicker).val()-1}),$("#download").click(function(){updateCout(),downloadCanvas(this,cout,"hexel-art.png")});var detector=new ghx.DragDetector(canvas,onDown,onDrag,onUp,onOut),MIN_SCALE=1,MAX_SCALE=Math.max(grid.rows,grid.cols);canvas.addEventListener("DOMMouseScroll",handleScroll,!1),canvas.addEventListener("mousewheel",handleScroll,!1),$("#image-picker").change(function(t){var e=new FileReader;e.onload=function(t){var e=new Image;e.onload=function(){var t=cout.width/e.width,r=cout.height/e.height,n=Math.min(t,r),i=(cout.width-e.width*n)/2,o=(cout.height-e.height*n)/2;ctx.clearRect(0,0,cout.width,cout.height),ctx.drawImage(e,0,0,e.width,e.height,i,o,e.width*n,e.height*n);for(var a=ctx.getImageData(0,0,100,100).data,s=0,u=cout.width-1;u>=0;u--)for(var h=0;h<cout.height;h++){var c=4*(cout.width*u+h);if(0!==a[c+3]){var f=new ghx.Color(a[c],a[c+1],a[c+2]);layout.setHexagonColor(s,f)}s++}applyColorChanges()},e.src=t.target.result},e.readAsDataURL(t.target.files[0])});
