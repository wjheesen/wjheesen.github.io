"use strict";var _createClass=function(){function a(e,c){for(var b=0;b<c.length;b++){var d=c[b];d.enumerable=d.enumerable||false;d.configurable=true;if("value" in d){d.writable=true}Object.defineProperty(e,d.key,d)}}return function(d,b,c){if(b){a(d.prototype,b)}if(c){a(d,c)}return d}}();function _classCallCheck(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var ScaleToFit={FitCenter:0,Fill:1,FitEnd:2,FitStart:3};var Point=function(){function d(h,i){_classCallCheck(this,d);this.x=h;this.y=i}_createClass(d,[{key:"isInside",value:function f(i,k,h,j){return k>this.y!==j>this.y&&this.x<(h-i)*(this.y-k)/(j-k)+i}},{key:"offset",value:function g(h,i){this.x+=h;this.y+=i}},{key:"log",value:function c(){console.log(this.toString())}},{key:"toString",value:function e(){return"{x: "+this.x+", y: "+this.y+"}"}}],[{key:"fromPoint",value:function b(h){return new d(h.x,h.y)}},{key:"midpointOf",value:function a(k,j){var i=0.5*(k.x+j.x);var h=0.5*(k.y+j.y);return new d(i,h)}}]);return d}();var Vec2=function(){function m(n,o){_classCallCheck(this,m);this.x=n;this.y=o}_createClass(m,[{key:"normalize",value:function h(){this.scale(1/this.len())}},{key:"len",value:function j(){return Math.sqrt(this.len2())}},{key:"len2",value:function f(){return this.x*this.x+this.y*this.y}},{key:"scale",value:function d(n){this.x*=n;this.y*=n}},{key:"plus",value:function i(n){this.x+=n.x;this.y+=n.y}},{key:"minus",value:function e(n){this.x-=n.x;this.y-=n.y}},{key:"dot",value:function a(n){return this.x*n.x+this.y*n.y}},{key:"cross",value:function k(n){return this.x*n.y-this.y*n.x}},{key:"invert",value:function b(){this.x=-this.x;this.y=-this.y}},{key:"log",value:function g(){console.log(this.toString())}},{key:"toString",value:function c(){return"{x: "+this.x+", y: "+this.y+" len: "+this.len()}}],[{key:"from",value:function l(o,n){return new m(n.x-o.x,n.y-o.y)}}]);return m}();var Rect=function(){function p(O,N,M,L){_classCallCheck(this,p);this.left=O;this.top=N;this.right=M;this.bottom=L}_createClass(p,[{key:"set",value:function t(L){this.left=L.left;this.top=L.top;this.right=L.right;this.bottom=L.bottom}},{key:"setEmpty",value:function E(){this.left=0;this.top=0;this.right=0;this.bottom=0}},{key:"setUnion",value:function s(L,N,M){this.left=this.right=L[N++];this.top=this.bottom=L[N++];this.unionPoints(L,N,M-1)}},{key:"sort",value:function I(){if(this.bottom>this.top){var M=this.top;this.top=this.bottom;this.bottom=M}if(this.left>this.right){var L=this.right;this.right=this.left;this.left=L}}},{key:"isEmpty",value:function o(){this.left>=this.right||this.bottom>=this.top}},{key:"isValid",value:function e(){return this.right>=this.left&&this.top>=this.bottom}},{key:"width",value:function a(){return this.right-this.left}},{key:"height",value:function d(){return this.top-this.bottom}},{key:"area",value:function x(){return a()*d()}},{key:"topLeft",value:function H(){return new Point(this.left,this.top)}},{key:"bottomLeft",value:function r(){return new Point(this.left,this.bottom)}},{key:"bottomRight",value:function q(){return new Point(this.right,this.bottom)}},{key:"topRight",value:function A(){return new Point(this.right,this.top)}},{key:"center",value:function b(){return new Point(this.centerX(),this.centerY())}},{key:"centerX",value:function h(){return 0.5*(this.left+this.right)}},{key:"centerY",value:function f(){return 0.5*(this.bottom+this.top)}},{key:"containsRect",value:function z(L){return this.left<=L.left&&L.right<=this.right&&this.bottom<=L.bottom&&L.top<=this.top}},{key:"containsPoint",value:function G(L){return this.contains(L.x,L.y)}},{key:"contains",value:function v(L,M){return this.left<=L&&L<=this.right&&this.bottom<=M&&M<=this.top}},{key:"unionRect",value:function n(L){this.left=Math.min(this.left,L.left);this.right=Math.max(this.right,L.right);this.bottom=Math.min(this.bottom,L.bottom);this.top=Math.max(this.top,L.top)}},{key:"unionPoints",value:function D(M,O,N){for(var L=0;L<N;L++){this.union(M[O++],M[O++])}}},{key:"unionPoint",value:function C(L){this.union(L.x,L.y)}},{key:"union",value:function w(L,M){this.left=Math.min(L,this.left);this.top=Math.max(M,this.top);this.right=Math.max(L,this.right);this.bottom=Math.min(M,this.bottom)}},{key:"intersectRect",value:function i(L){this.left=Math.max(this.left,L.left);this.right=Math.min(this.right,L.right);this.bottom=Math.max(this.bottom,L.bottom);this.top=Math.min(this.top,L.top)}},{key:"intersectsRect",value:function J(L){return this.right>=L.left&&L.right>=this.left&&this.top>=L.bottom&&L.top>=this.bottom}},{key:"intersectsRectByPercent",value:function c(L,M){var N=p.fromIntersection(this,L);return N.isValid()&&N.area/L.area>=M}},{key:"translate",value:function g(L,M){this.left+=dx;this.top+=dy;this.right+=dx;this.bottom+=dy}},{key:"draw",value:function K(L){if(this.strokeColor&&this.lineWidth){L.lineWidth=this.lineWidth;L.strokeStyle=this.strokeColor;L.strokeRect(this.left,this.bottom,this.width(),this.height())}if(this.fillColor){L.fillStyle=this.fillColor;L.fillRect(this.left,this.bottom,this.width(),this.height())}}},{key:"log",value:function l(){console.log(this.toString())}},{key:"toString",value:function j(){return"{bottom: "+this.bottom+", left: "+this.left+", width: "+this.width()+", height: "+this.height()+", isValid: "+this.isValid()+"}"}}],[{key:"fromRect",value:function k(L){return new p(L.left,L.top,L.right,L.bottom)}},{key:"fromLBRT",value:function y(O,L,M,N){return new p(O,N,M,L)}},{key:"fromTwoPoints",value:function u(N,M){var L=new p(N.x,N.y,N.x,N.y);L.unionPoint(M);return L}},{key:"fromUnion",value:function m(L,O,N){var M=new p(0,0,0,0);M.setUnion(L,O,N);return M}},{key:"fromIntersection",value:function F(M,L){var N=p.fromRect(M);N.intersectRect(L);return N}},{key:"fromDimensions",value:function B(O,M,N,L){return new p(O,M+L,O+N,M)}}]);return p}();var Matrix=function(){function f(W,U,T,Y,X,V){_classCallCheck(this,f);this.m11=W;this.m12=U;this.m13=T;this.m21=Y;this.m22=X;this.m23=V}_createClass(f,[{key:"determinant",value:function C(){return this.m11*this.m22-this.m12*this.m21}},{key:"inverse",value:function s(){var T=1/this.determinant();var X=this.m22*T;var V=-this.m12*T;var U=(this.m12*this.m23-this.m13*this.m22)*T;var Z=-this.m21*T;var Y=this.m11*T;var W=(this.m21*this.m13-this.m11*this.m23)*T;return new f(X,V,U,Z,Y,W)}},{key:"moveOrigin",value:function J(U,T){this.preTranslate(-U,-T);this.postTranslate(U,T)}},{key:"postConcat",value:function M(T){this.setConcat(T,this)}},{key:"preConcat",value:function O(T){this.setConcat(this,T)}},{key:"postRotate",value:function o(Y){var T=Math.cos(Y);var X=Math.sin(Y);var W=this.m11;var V=this.m12;var U=this.m13;this.m11=X*W-T*this.m21;this.m12=X*V-T*this.m22;this.m13=X*U-T*this.m23;this.m21=T*W+X*this.m21;this.m22=T*V+X*this.m22;this.m23=T*U+T*this.m23}},{key:"preRotate",value:function r(X){var U=Math.cos(X);var W=Math.sin(X);var V=this.m11;var T=this.m21;this.m11=V*W+this.m12*U;this.m21=T*W+this.m22*U;this.m12=V*-U+this.m12*W;this.m22=T*-U+this.m22*W}},{key:"postScale",value:function Q(U,T){this.m11*=U;this.m12*=U;this.m13*=U;this.m21*=T;this.m22*=T;this.m23*=T}},{key:"preScale",value:function A(U,T){this.m11*=U;this.m21*=U;this.m12*=T;this.m22*=T}},{key:"postStretch",value:function z(T){this.postScale(T,T)}},{key:"preStretch",value:function m(T){this.preScale(T,T)}},{key:"postTranslate",value:function d(T,U){this.m13+=T;this.m23+=U}},{key:"preTranslate",value:function y(T,U){this.m13+=this.m11*T+this.m12*U;this.m23+=this.m21*T+this.m22*U}},{key:"set",value:function v(W,U,T,Y,X,V){this.m11=W;this.m12=U;this.m13=T;this.m21=Y;this.m22=X;this.m23=V}},{key:"setConcat",value:function l(U,T){this.set(U.m11*T.m11+U.m12*T.m21,U.m11*T.m12+U.m12*T.m22,U.m11*T.m13+U.m12*T.m23+U.m13,U.m21*T.m11+U.m22*T.m21,U.m21*T.m12+U.m22*T.m22,U.m21*T.m13+U.m22*T.m23+U.m23)}},{key:"setIdentity",value:function P(){this.m11=1;this.m12=0;this.m13=0;this.m21=0;this.m22=1;this.m23=0}},{key:"setRectToRect",value:function k(X,Z,Y){var T=void 0,V=void 0;switch(Y){case ScaleToFit.FitCenter:T=X.center();V=Z.center();break;case ScaleToFit.FitEnd:T=X.bottomRight();V=Z.bottomRight();break;default:T=X.topLeft();V=Z.topLeft();break}var W=Z.width()/X.width();var U=Z.height()/X.height();this.setTranslate(-T.x,-T.y);if(Y===ScaleToFit.Fill){this.postScale(W,U)}else{this.postStretch(Math.min(W,U))}this.postTranslate(V.x,V.y)}},{key:"setRotate",value:function E(V){var T=Math.sin(V);var U=Math.cos(V);this.setSinCos(T,U)}},{key:"setSinCos",value:function q(T,U){this.m11=U;this.m12=-T;this.m13=0;this.m21=T;this.m22=U;this.m23=0}},{key:"setScale",value:function w(U,T){this.m11=U;this.m12=0;this.m13=0;this.m21=0;this.m22=T;this.m23=0}},{key:"setStretch",value:function u(T){this.setScale(T,T)}},{key:"setTranslate",value:function D(U,T){this.m11=1;this.m12=0;this.m13=U;this.m21=0;this.m22=1;this.m23=T}},{key:"mapPoint",value:function S(V,W){W=typeof W!=="undefined"?W:V;var U=this.mapX(V.x,V.y);var T=this.mapY(V.x,V.y);W.x=U;W.y=T}},{key:"mapPoints",value:function x(Y,U,aa,W,X){for(var V=0;V<X;V++){var T=Y[U++];var Z=Y[U++];aa[W++]=this.mapX(T,Z);aa[W++]=this.mapY(T,Z)}}},{key:"mapRect",value:function h(X,Y){Y=typeof Y!=="undefined"?Y:X;var V=X.topLeft();var T=X.bottomLeft();var W=X.bottomRight();var U=X.topRight();this.mapPoint(V);this.mapPoint(T);this.mapPoint(W);this.mapPoint(U);Y.left=Y.right=V.x;Y.top=Y.bottom=V.y;Y.unionPoint(T);Y.unionPoint(W);Y.unionPoint(U)}},{key:"mapX",value:function c(T,U){return this.m11*T+this.m12*U+this.m13}},{key:"mapY",value:function b(T,U){return this.m21*T+this.m22*U+this.m23}},{key:"log",value:function j(){console.log(this.toString())}},{key:"toString",value:function g(){return"m11: "+this.m11+", m12: "+this.m12+", m13: "+this.m13+", m21: "+this.m21+", m22: "+this.m22+", m23: "+this.m23}}],[{key:"identity",value:function L(){return new f(1,0,0,0,1,0)}},{key:"rectToRect",value:function i(U,W,V){var T=new f();T.setRectToRect(U,W,V);return T}},{key:"rotateAboutOrigin",value:function K(U){var T=new f();T.setRotate(U);return T}},{key:"rotateByAngle",value:function B(T,W){var U=Math.sin(W);var V=Math.cos(W);return f.rotateBySinCos(T,U,V)}},{key:"rotateBySinCos",value:function t(T,V,W){var U=new f();U.setSinCos(V,W);U.moveOrigin(T.x,T.y);return U}},{key:"rotateFrom",value:function G(T,Z,U){var X=Vec2.from(T,Z);var W=Vec2.from(T,U);X.normalize();W.normalize();var V=X.cross(W);var Y=X.dot(W);return f.rotateBySinCos(T,V,Y)}},{key:"scaleAboutOrigin",value:function H(V,U){var T=new f();T.setScale(V,U);return T}},{key:"scaleByRatios",value:function a(T,W,V){var U=new f();U.setScale(W,V);U.moveOrigin(T.x,T.y);return U}},{key:"scaleFrom",value:function p(T,X,U){var W=(U.x-T.x)/(X.x-T.x);var V=(U.y-T.y)/(X.y-T.y);return f.scaleByRatios(T,W,V)}},{key:"stretchAboutOrigin",value:function R(U){var T=new f();T.setStretch(U);return T}},{key:"stretchByRatio",value:function n(T,U){return f.scaleByRatios(T,U,U)}},{key:"stretchFrom",value:function N(U,Y,V){var X=Vec2.from(U,Y).len();var T=Vec2.from(U,V).len();var W=T/X;return f.stretchByRatio(U,W)}},{key:"stretchRotateFrom",value:function F(T,U,V){var X=Vec2.from(T,U);var Z=Vec2.from(T,V);var W=X.len();var Y=Z.len();var aa=Y/W;X.scale(1/W);Z.scale(1/Y);var ab=X.cross(Z);var ad=X.dot(Z);var ac=new f();ac.setSinCos(ab,ad);ac.postStretch(aa);ac.moveOrigin(T.x,T.y);return ac}},{key:"translate",value:function e(U,T){return new f(1,0,U,0,1,T)}},{key:"mult",value:function I(V,U){var T=new f();T.setConcat(V,U);return T}}]);return f}();var Path=function(){function t(x){_classCallCheck(this,t);this.data=x;this.capacity=x.length/2;this.count=0}_createClass(t,[{key:"put",value:function g(z,A){this.set(z,A,this.count++)}},{key:"putPoint",value:function c(x){this.setPoint(x,this.count++)}},{key:"putPath",value:function p(x){this.putData(x.data)}},{key:"putData",value:function v(x){this.setData(x,this.count);this.count+=x.length/2}},{key:"set",value:function n(z,C,B){var A=2*B;this.data[A]=z;this.data[A+1]=C}},{key:"setPoint",value:function d(x,y){this.set(x.x,x.y,y)}},{key:"setPath",value:function u(x,y){this.setData(x.data,y)}},{key:"setData",value:function e(x,y){this.data.set(x,this.offset*2)}},{key:"pointAt",value:function j(A){var B=A*2;var z=this.data[B];var C=this.data[B+1];return new Point(z,C)}},{key:"pointBetween",value:function b(y,x){return Point.midpointOf(this.pointAt(y),this.pointAt(x))}},{key:"calculateBounds",value:function o(){return Rect.fromUnion(this.data,0,this.count)}},{key:"calculateBoundsOfSubset",value:function s(y,x){return Rect.fromUnion(this.data,y*2,x)}},{key:"containsPoint",value:function r(x){return this.containsPointInSubset(x,0,this.count)}},{key:"containsPointInSubset",value:function i(C,E,z){var x=false;for(var B=E,y=z-1;B<z;y=B++){var D=this.pointAt(y);var A=this.pointAt(B);if(C.isInside(D.x,D.y,A.x,A.y)){x=!x}}return x}},{key:"translate",value:function l(z,B){for(var A=0;A<this.data.length;){this.data[A++]+=z;this.data[A++]+=B}}},{key:"transform",value:function m(x){x.mapPoints(this.data,0,this.data,0,this.count)}},{key:"transformSubset",value:function w(x,z,y){x.mapPoints(this.data,z*2,this.data,z*2,y)}},{key:"draw",value:function k(x){x.beginPath();x.moveTo(this.data[0],this.data[1]);for(var y=2;y<this.data.length;){x.lineTo(this.data[y++],this.data[y++])}x.closePath();if(this.strokeColor){x.lineWidth=this.lineWidth;x.strokeStyle=this.strokeColor;x.stroke()}if(this.fillColor){x.fillStyle=this.fillColor;x.fill()}}},{key:"log",value:function h(){console.log(this.toString())}},{key:"toString",value:function q(){return"{capacity: "+this.capacity+", count: "+this.count+", data: "+this.data+"}"}}],[{key:"fromPath",value:function f(z){var y=new Float32Array(z.data);var x=new t(y);x.count=z.count;return x}},{key:"withCapacity",value:function a(y){var x=y*2;var A=x*Float32Array.BYTES_PER_ELEMENT;var z=new ArrayBuffer(A);var B=new Float32Array(z,0,x);return new t(B)}}]);return t}();var Mesh=function(){function f(j,i,h){_classCallCheck(this,f);this.path=j;this.bounds=j.calculateBounds();this.fixedPoint=i;this.controlPoint=h}_createClass(f,[{key:"contains",value:function d(h){return this.bounds.containsPoint(h)&&this.path.containsPoint(h)}},{key:"log",value:function e(){console.log(this.toString())}},{key:"toString",value:function g(){return"path: "+this.path.toString()+", bounds: "+this.bounds.toString()+",\n                    fixedPoint: "+this.fixedPoint+", controlPoint: "+this.controlPoint}}],[{key:"nGon",value:function a(o){var m=Path.withCapacity(o);var h=new Point(0,-100);m.putPoint(h);var k=Matrix.rotateAboutOrigin(2*Math.PI/o);while(m.count<m.capacity){k.mapPoint(h);m.putPoint(h)}var l=m.pointAt(0);var j=Math.floor(o/2);var i=o&1?m.pointBetween(j,j+1):m.pointAt(j);return new f(m,l,i)}},{key:"nStar",value:function c(h,m,k){var r=Path.withCapacity(h+h);var i=2*Math.PI/h;var q=new Matrix();var o=new Point(0,-k);r.putPoint(o);var l=new Point(0,-m);q.setRotate(0.5*i);q.mapPoint(l);r.putPoint(l);q.setRotate(i);while(r.count<r.capacity){q.mapPoint(o);r.putPoint(o);q.mapPoint(l);r.putPoint(l)}var p=r.pointAt(0);var j=h&1?r.pointBetween(h-1,h+1):r.pointAt(h);return new f(r,p,j)}},{key:"bat",value:function b(){var j=Path.withCapacity(20);j.put(0,3);j.put(-2,5);j.put(-3,2);j.put(-5,0);j.put(-8,3);j.put(-10,7);j.put(-17,10);j.put(-13,5);j.put(-12,-1);j.put(-3,-7);j.put(0,-10);j.put(3,-7);j.put(12,-1);j.put(13,5);j.put(17,10);j.put(10,7);j.put(8,3);j.put(5,0);j.put(3,2);j.put(2,5);j.transform(Matrix.scaleAboutOrigin(1,-1));var i=j.pointBetween(1,19);var h=j.pointAt(10);return new f(j,i,h)}}]);return f}();var Shape=function(){function g(j,i,h){_classCallCheck(this,g);this.mesh=j;this.fillColor=i;this.matrix=h}_createClass(g,[{key:"setBounds",value:function e(h,i){this.matrix=Matrix.rectToRect(this.mesh.bounds,h,i)}},{key:"setEndPoints",value:function c(k,h){var j=Vec2.from(this.mesh.fixedPoint,k);var i=Point.fromPoint(this.mesh.controlPoint);i.offset(j.x,j.y);this.matrix=Matrix.stretchRotateFrom(k,i,h);this.matrix.preTranslate(j.x,j.y)}},{key:"containsPoint",value:function b(h){var i=this.matrix.inverse();var j=new Point();i.mapPoint(h,j);return this.mesh.contains(j)}},{key:"draw",value:function a(j){if(!this.matrix){return}j.beginPath();var l=this.mesh.path.data;var h=l[0];var m=l[1];j.moveTo(this.matrix.mapX(h,m),this.matrix.mapY(h,m));for(var k=2;k<l.length;){h=l[k++];m=l[k++];j.lineTo(this.matrix.mapX(h,m),this.matrix.mapY(h,m))}j.closePath();if(this.strokeColor){j.lineWidth=this.lineWidth;j.strokeStyle=this.strokeColor;j.stroke()}if(this.fillColor){j.fillStyle=this.fillColor;j.fill()}}},{key:"log",value:function d(){console.log(this.toString())}},{key:"toString",value:function f(){return"mesh: "+this.mesh.toString()+", fillColor: "+this.fillColor+", matrix: "+this.matrix}}]);return g}();var DragDetector=function DragDetector(c,g,b,h,e){_classCallCheck(this,DragDetector);var d=false;function f(k){var j=c.getBoundingClientRect();var i=k.clientX-j.left;var l=k.clientY-j.top;return new Point(i,l)}c.addEventListener("mousedown",function(i){d=true;i.preventDefault();i.stopPropagation();g(f(i))},false);c.addEventListener("mousemove",function(i){if(!d){return}i.preventDefault();i.stopPropagation();b(f(i))},false);c.addEventListener("mouseup",function(i){if(!d){return}i.preventDefault();i.stopPropagation();d=false;h(f(i))},false);c.addEventListener("mouseout",function(i){if(!d){return}i.preventDefault();i.stopPropagation();d=false;e(f(i))},false);c.addEventListener("touchstart",function(i){$(document.body).css("background","red");var k=i.touches[0];var j=new MouseEvent("mousedown",{clientX:k.clientX,clientY:k.clientY});c.dispatchEvent(j)},false);c.addEventListener("touchmove",function(i){var k=i.touches[0];var j=new MouseEvent("mousemove",{clientX:k.clientX,clientY:k.clientY});c.dispatchEvent(j)},false);c.addEventListener("touchend",function(i){var j=new MouseEvent("mouseup",{clientX:touch.clientX,clientY:touch.clientY});c.dispatchEvent(j)},false);c.addEventListener("touchcancel",function(i){var j=new MouseEvent("mouseout",{clientX:touch.clientX,clientY:touch.clientY});c.dispatchEvent(j)},false);function a(i){if(i.target==c){i.preventDefault()}}document.body.addEventListener("touchstart",a,false);document.body.addEventListener("touchmove",a,false);document.body.addEventListener("touchend",a,false);document.body.addEventListener("touchcancel",a,false)};