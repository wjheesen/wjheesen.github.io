!function t(i,e,o){function n(s,h){if(!e[s]){if(!i[s]){var a="function"==typeof require&&require;if(!h&&a)return a(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var p=e[s]={exports:{}};i[s][0].call(p.exports,function(t){var e=i[s][1][t];return n(e?e:t)},p,p.exports,t,i,e,o)}return e[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)n(o[s]);return n}({1:[function(t,i,e){"use strict";function o(t,i){function e(t){s=!0,t.preventDefault(),t.stopPropagation(),i(t,0)}function o(t){s&&(t.preventDefault(),t.stopPropagation(),i(t,1))}function n(t){s&&(t.preventDefault(),t.stopPropagation(),s=!1,i(t,3))}function r(t){s&&(t.preventDefault(),t.stopPropagation(),s=!1,i(t,2))}var s=!1;t.addEventListener("mousedown",e,!1),t.addEventListener("mousemove",o,!1),t.addEventListener("mouseout",n,!1),t.addEventListener("mouseup",r,!1),t.addEventListener("touchstart",e,!1),t.addEventListener("touchmove",o,!1),t.addEventListener("touchleave",n,!1),t.addEventListener("touchend",r,!1)}function n(t,i,e){return void 0===e&&(e=new d),i instanceof MouseEvent?r(t,i,e):i instanceof TouchEvent?r(t,i,e):e}function r(t,i,e){if(void 0===e&&(e=new d),i.offsetX)e.x=i.offsetX,e.y=i.offsetY;else if(i.layerX)e.x=i.layerX,e.y=i.layerY;else{var o=t.getBoundingClientRect();e.x=i.clientX-o.left,e.y=i.clientY-o.top}return e}function s(t,i){return Math.floor(Math.random()*(i-t+1))+t}function h(t){void 0===t&&(t=255);var i=s(0,255)<<24,e=s(0,255)<<16,o=s(0,255)<<8;return(i|e|o|t)>>>0}function a(t){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),e=parseInt(i[2],16)<<24,o=parseInt(i[3],16)<<16,n=parseInt(i[4],16)<<8,r=parseInt(i[1],16);return(e|o|n|r)>>>0}function c(t){var i=p((t>>24&255).toString(16)),e=p((t>>16&255).toString(16)),o=p((t>>8&255).toString(16)),n=p((255&t).toString(16));return"#"+n+i+e+o}function p(t){return 1==t.length?"0"+t:t}function u(t){var i=t>>24&255,e=t>>16&255,o=t>>8&255,n=t>>0&255;console.log("{r: "+i+", g: "+e+", b: "+o+", a: "+n+"}")}function l(t,i){var e=t>>24&255,o=t>>16&255,n=t>>8&255,r=t>>0&255,s=i>>24&255,h=i>>16&255,a=i>>8&255,c=r+1,p=256-r,u=c*e+p*s>>8,l=c*o+p*h>>8,f=c*n+p*a>>8;return(u<<24|l<<16|f<<8|255)>>>0}function f(t,i,e){return t>e?t:e>i?i:e}var d=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i}return t.fromPoint=function(i){return new t(i.x,i.y)},t.between=function(i,e){var o=.5*(i.x+e.x),n=.5*(i.y+e.y);return new t(o,n)},t.prototype.distanceToOrigin=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.distanceToPoint=function(t){var i=this.x-t.x,e=this.y-t.y,o=i*i+e*e;return Math.sqrt(o)},t.prototype.set=function(t,i){this.x=t,this.y=i},t.prototype.setPoint=function(t){this.x=t.x,this.y=t.y},t.prototype.offset=function(t,i){this.x+=t,this.y+=i},t.prototype.log=function(){console.log(this.toString())},t.prototype.toString=function(){return"{x: "+this.x+", y: "+this.y+"}"},t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},t}();e.Point=d;var m=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i}return t.fromVec2=function(i){return new t(i.x,i.y)},t.fromPointToPoint=function(i,e){return new t(e.x-i.x,e.y-i.y)},t.prototype.isZero=function(){return 0==this.x&&0==this.y},t.prototype.length=function(){return Math.sqrt(this.length2())},t.prototype.length2=function(){return this.x*this.x+this.y*this.y},t.prototype.set=function(t,i){this.x=t,this.y=i},t.prototype.setVec2=function(t){this.x=t.x,this.y=t.y},t.prototype.normalize=function(){this.divScalar(this.length())},t.prototype.rotateLeft=function(){t=[-this.y,this.x],this.x=t[0],this.y=t[1];var t},t.prototype.rotateRight=function(){t=[this.y,-this.x],this.x=t[0],this.y=t[1];var t},t.prototype.mulScalar=function(t){this.x*=t,this.y*=t},t.prototype.divScalar=function(t){this.x/=t,this.y/=t},t.prototype.add=function(t){this.x+=t.x,this.y+=t.y},t.prototype.subtract=function(t){this.x-=t.x,this.y-=t.y},t.prototype.multiply=function(t){this.x*=t.x,this.y*=t.y},t.prototype.divide=function(t){this.x/=t.x,this.y/=t.y},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.cross=function(t){return this.x*t.y-this.y*t.x},t.prototype.negate=function(){this.x=-this.x,this.y=-this.y},t.prototype.log=function(){console.log(this.toString())},t.prototype.toString=function(){return"{x: "+this.x+", y: "+this.y+" len: "+this.length()+"}"},t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},t}();e.Vec2=m;var g=function(){function t(t,i,e,o){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=0),void 0===o&&(o=0),this.left=t,this.top=i,this.right=e,this.bottom=o}return t.fromRect=function(i){return new t(i.left,i.top,i.right,i.bottom)},t.fromLBRT=function(i,e,o,n){return new t(i,n,o,e)},t.fromLRBT=function(i,e,o,n){return new t(i,n,e,o)},t.fromPointToPoint=function(i,e){var o=new t(i.x,i.y,i.x,i.y);return o.unionPoint(e),o},t.fromUnion=function(i,e,o){var n=new t(0,0,0,0);return n.setUnion(i,e,o),n},t.fromIntersection=function(i,e){var o=t.fromRect(i);return o.intersectRect(e),o},t.fromDimensions=function(i,e,o,n){return new t(i,e+n,i+o,e)},t.prototype.isEmpty=function(){this.left>=this.right||this.bottom>=this.top},t.prototype.isValid=function(){return this.right>=this.left&&this.top>=this.bottom},t.prototype.width=function(){return this.right-this.left},t.prototype.height=function(){return this.top-this.bottom},t.prototype.area=function(){return this.width()*this.height()},t.prototype.center=function(){return new d(this.centerX(),this.centerY())},t.prototype.centerX=function(){return.5*(this.left+this.right)},t.prototype.centerY=function(){return.5*(this.bottom+this.top)},t.prototype.bottomLeft=function(){return new d(this.left,this.bottom)},t.prototype.bottomRight=function(){return new d(this.right,this.bottom)},t.prototype.topLeft=function(){return new d(this.left,this.top)},t.prototype.topRight=function(){return new d(this.right,this.top)},t.prototype.pointAt=function(t,i,e){return void 0===e&&(e=new d),e.x=this.left+t*this.width(),e.y=this.bottom+i*this.height(),e},t.prototype.vertices=function(){var t=new Float32Array(8);return t[0]=this.left,t[1]=this.top,t[2]=this.left,t[3]=this.bottom,t[4]=this.right,t[5]=this.bottom,t[6]=this.right,t[7]=this.top,t},t.prototype.setRect=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},t.prototype.setLTRB=function(t,i,e,o){this.left=t,this.top=i,this.right=e,this.bottom=o},t.prototype.setLBRT=function(t,i,e,o){this.left=t,this.top=o,this.right=e,this.bottom=i},t.prototype.setLRBT=function(t,i,e,o){this.left=t,this.top=o,this.right=i,this.bottom=e},t.prototype.setEmpty=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},t.prototype.setUnion=function(t,i,e){this.left=this.right=t[i++],this.top=this.bottom=t[i++],this.unionPoints(t,i,e-1)},t.prototype.contains=function(t,i){return this.left<=t&&t<=this.right&&this.bottom<=i&&i<=this.top},t.prototype.containsPoint=function(t){return this.contains(t.x,t.y)},t.prototype.containsRect=function(t){return this.left<=t.left&&t.right<=this.right&&this.bottom<=t.bottom&&t.top<=this.top},t.prototype.intersectRect=function(t){this.left=Math.max(this.left,t.left),this.right=Math.min(this.right,t.right),this.bottom=Math.max(this.bottom,t.bottom),this.top=Math.min(this.top,t.top)},t.prototype.intersectsRect=function(t){return this.right>=t.left&&t.right>=this.left&&this.top>=t.bottom&&t.top>=this.bottom},t.prototype.intersectsRectByPercent=function(i,e){var o=t.fromIntersection(this,i);return o.isValid()&&o.area()/i.area()>=e},t.prototype.union=function(t,i){this.left=Math.min(t,this.left),this.top=Math.max(i,this.top),this.right=Math.max(t,this.right),this.bottom=Math.min(i,this.bottom)},t.prototype.unionPoint=function(t){this.union(t.x,t.y)},t.prototype.unionPoints=function(t,i,e){for(var o=0;e>o;o++)this.union(t[i++],t[i++])},t.prototype.unionRect=function(t){this.left=Math.min(this.left,t.left),this.right=Math.max(this.right,t.right),this.bottom=Math.min(this.bottom,t.bottom),this.top=Math.max(this.top,t.top)},t.prototype.inset=function(t,i){this.left+=t,this.top-=i,this.right-=t,this.bottom+=i},t.prototype.offset=function(t,i){this.left+=t,this.top+=i,this.right+=t,this.bottom+=i},t.prototype.mulScalar=function(t){this.left*=t,this.top*=t,this.right*=t,this.bottom*=t},t.prototype.divScalar=function(t){this.left/=t,this.top/=t,this.right/=t,this.bottom/=t},t.prototype.scale=function(t,i){var e=this.centerX(),o=this.centerY();this.offset(-e,-o),this.left*=t,this.right*=t,this.bottom*=i,this.top*=i,this.offset(e,o)},t.prototype.stretch=function(t){this.scale(t,t)},t.prototype.shrinkToSquare=function(){var t=this.width(),i=this.height();i>t?this.scale(1,t/i):t>i&&this.scale(i/t,1)},t.prototype.expandToSquare=function(){var t=this.width(),i=this.height();i>t?this.scale(i/t,1):t>i&&this.scale(1,t/i)},t.prototype.sort=function(){if(this.bottom>this.top){var t=this.top;this.top=this.bottom,this.bottom=t}if(this.left>this.right){var i=this.right;this.right=this.left,this.left=i}},t.prototype.log=function(){console.log(this.toString())},t.prototype.toString=function(){return"{bottom: "+this.bottom+", left: "+this.left+", width: "+this.width()+", height: "+this.height()+", isValid: "+this.isValid()+"}"},t.prototype.equals=function(t){return this.left==t.left&&this.top==t.top&&this.right==t.right&&this.bottom==t.bottom},t}();e.Rect=g;var y=function(){function t(t,i,e,o){void 0===t&&(t=1),void 0===i&&(i=1),void 0===e&&(e=0),void 0===o&&(o=0),this.rx=t,this.ry=i,this.cx=e,this.cy=o}return t.fromRect=function(i){var e=i.width()/2,o=i.height()/2,n=i.centerX(),r=i.centerY();return new t(e,o,n,r)},t.fromEllipse=function(i){return new t(i.rx,i.ry,i.cx,i.cy)},t.prototype.contains=function(t,i){var e=this.cx-t,o=this.cy-i,n=e/this.rx,r=o/this.ry;return 1>=n*n+r*r},t.prototype.containsPoint=function(t){return this.contains(t.x,t.y)},t}();e.Ellipse=y;var v=function(){function t(t,i,e,o){this.x1=t,this.y1=i,this.x2=e,this.y2=o}return t.fromLine=function(i){return new t(i.x1,i.y1,i.x2,i.y2)},t.fromPointToPoint=function(i,e){return new t(i.x,i.y,e.x,e.y)},t.prototype.contains=function(t,i,e){var o=new d(this.x1,this.y1),n=new m(this.x2-this.x1,this.y2-this.y1),r=-1,s=new m(t-o.x,i-o.y),h=n.dot(s),a=n.length2();if(0!=a&&(r=h/a),0>r||r>1)return!1;var c=o.x+r*n.x,p=o.y+r*n.y,u=t-c,l=i-p,f=u*u+l*l;return e*e/4>f},t.prototype.containsPoint=function(t,i){return this.contains(t.x,t.y,i)},t}();e.Line=v;var w=function(){function t(t,i,e,o,n,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=0),void 0===o&&(o=0),void 0===n&&(n=0),void 0===r&&(r=0),this.m11=t,this.m12=i,this.m13=e,this.m21=o,this.m22=n,this.m23=r}return t.test=function(){console.log("Matrix test");var i=new d(50,50),e=new d(100,0),o=new d(0,100),n=t.stretchRotateFromPointToPoint(e,o,i.x,i.y),r=new d;n.mapPoint(e,r),console.log("end:"+o),console.log("end?"+r),n.invert(),n.mapPoint(o,r),console.log("start:"+e),console.log("start?"+r),console.log("End test")},t.fromMatrix=function(i){return new t(i.m11,i.m12,i.m13,i.m21,i.m22,i.m23)},t.from2x2=function(i,e,o,n){return new t(i,e,0,o,n,0)},t.identity=function(){return new t(1,0,0,0,1,0)},t.rectToRect=function(i,e,o){var n=new t;return n.setRectToRect(i,e,o),n},t.rotateByAngle=function(i,e,o){void 0===e&&(e=0),void 0===o&&(o=0);var n=Math.sin(i),r=Math.cos(i);return t.rotateBySinCos(n,r,e,o)},t.rotateBySinCos=function(i,e,o,n){void 0===o&&(o=0),void 0===n&&(n=0);var r=new t;return r.setSinCos(i,e),r.preTranslate(-o,-n),r.postTranslate(o,n),r},t.rotateFromPointToPoint=function(i,e,o,n){void 0===o&&(o=0),void 0===n&&(n=0);var r=new d(o,n),s=m.fromPointToPoint(r,i),h=m.fromPointToPoint(r,e);s.normalize(),h.normalize();var a=s.cross(h),c=s.dot(h);return t.rotateBySinCos(a,c,o,n)},t.scale=function(i,e,o,n){void 0===o&&(o=0),void 0===n&&(n=0);var r=new t;return r.setScale(i,e),r.preTranslate(-o,-n),r.postTranslate(o,n),r},t.scaleFromPointToPoint=function(i,e,o,n){void 0===o&&(o=0),void 0===n&&(n=0);var r=(e.x-o)/(i.x-o),s=(e.y-n)/(i.y-n);return t.scale(r,s,o,n)},t.stretch=function(i,e,o){return t.scale(i,i,e,o)},t.stretchFromPointToPoint=function(i,e,o,n){void 0===o&&(o=0),void 0===n&&(n=0);var r=new d(o,n),s=m.fromPointToPoint(r,i).length(),h=m.fromPointToPoint(r,e).length(),a=h/s;return t.stretch(a,o,n)},t.stretchRotateFromPointToPoint=function(i,e,o,n){void 0===o&&(o=0),void 0===n&&(n=0);var r=new d(o,n),s=m.fromPointToPoint(r,i),h=m.fromPointToPoint(r,e),a=s.length(),c=h.length(),p=c/a;s.mulScalar(1/a),h.mulScalar(1/c);var u=s.cross(h),l=s.dot(h),f=new t;return f.setSinCos(u,l),f.postStretch(p),f.preTranslate(-o,-n),f.postTranslate(o,n),f},t.translate=function(i,e){return new t(1,0,i,0,1,e)},t.translateFromPointToPoint=function(i,e){return t.translate(e.x-i.x,e.y-i.y)},t.concat=function(i,e){var o=new t;return o.setConcat(i,e),o},t.prototype.determinant=function(){return this.m11*this.m22-this.m12*this.m21},t.prototype.inverse=function(){var i=new t;return i.setInverse(this),i},t.prototype.invert=function(){this.setInverse(this)},t.prototype.postConcat=function(t){this.setConcat(t,this)},t.prototype.preConcat=function(t){this.setConcat(this,t)},t.prototype.postRotate=function(t){var i=Math.cos(t),e=Math.sin(t),o=this.m11,n=this.m12,r=this.m13;this.m11=e*o-i*this.m21,this.m12=e*n-i*this.m22,this.m13=e*r-i*this.m23,this.m21=i*o+e*this.m21,this.m22=i*n+e*this.m22,this.m23=i*r+i*this.m23},t.prototype.preRotate=function(t){var i=Math.cos(t),e=Math.sin(t),o=this.m11,n=this.m21;this.m11=o*e+this.m12*i,this.m21=n*e+this.m22*i,this.m12=o*-i+this.m12*e,this.m22=n*-i+this.m22*e},t.prototype.postScale=function(t,i){this.m11*=t,this.m12*=t,this.m13*=t,this.m21*=i,this.m22*=i,this.m23*=i},t.prototype.preScale=function(t,i){this.m11*=t,this.m21*=t,this.m12*=i,this.m22*=i},t.prototype.postStretch=function(t){this.postScale(t,t)},t.prototype.preStretch=function(t){this.preScale(t,t)},t.prototype.postTranslate=function(t,i){this.m13+=t,this.m23+=i},t.prototype.preTranslate=function(t,i){this.m13+=this.m11*t+this.m12*i,this.m23+=this.m21*t+this.m22*i},t.prototype.set=function(t,i,e,o,n,r){this.m11=t,this.m12=i,this.m13=e,this.m21=o,this.m22=n,this.m23=r},t.prototype.setMatrix=function(t){this.m11=t.m11,this.m12=t.m12,this.m13=t.m13,this.m21=t.m21,this.m22=t.m22,this.m23=t.m23},t.prototype.setConcat=function(t,i){this.set(t.m11*i.m11+t.m12*i.m21,t.m11*i.m12+t.m12*i.m22,t.m11*i.m13+t.m12*i.m23+t.m13,t.m21*i.m11+t.m22*i.m21,t.m21*i.m12+t.m22*i.m22,t.m21*i.m13+t.m22*i.m23+t.m23)},t.prototype.setIdentity=function(){this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0},t.prototype.setInverse=function(t){var i=1/t.determinant(),e=t.m22*i,o=-t.m12*i,n=(t.m12*t.m23-t.m13*t.m22)*i,r=-t.m21*i,s=t.m11*i,h=(t.m21*t.m13-t.m11*t.m23)*i;this.set(e,o,n,r,s,h)},t.prototype.setRectToRect=function(t,i,e){var o,n;switch(e){case 0:o=t.center(),n=i.center();break;case 1:o=t.bottomRight(),n=i.bottomRight();break;default:o=t.topLeft(),n=i.topLeft()}var r=i.width()/t.width(),s=i.height()/t.height();this.setTranslate(-o.x,-o.y),2===e?this.postScale(r,s):this.postStretch(Math.min(r,s)),this.postTranslate(n.x,n.y)},t.prototype.setRotate=function(t){var i=Math.sin(t),e=Math.cos(t);this.setSinCos(i,e)},t.prototype.setSinCos=function(t,i){this.m11=i,this.m12=-t,this.m13=0,this.m21=t,this.m22=i,this.m23=0},t.prototype.setScale=function(t,i){this.m11=t,this.m12=0,this.m13=0,this.m21=0,this.m22=i,this.m23=0},t.prototype.setStretch=function(t){this.setScale(t,t)},t.prototype.setTranslate=function(t,i){this.m11=1,this.m12=0,this.m13=t,this.m21=0,this.m22=1,this.m23=i},t.prototype.mapX=function(t,i){return this.m11*t+this.m12*i+this.m13},t.prototype.mapY=function(t,i){return this.m21*t+this.m22*i+this.m23},t.prototype.map=function(t,i,e){return void 0===e&&(e=new d),e.x=this.mapX(t,i),e.y=this.mapY(t,i),e},t.prototype.mapPoint=function(t,i){return void 0===i&&(i=new d),this.map(t.x,t.y,i)},t.prototype.mapPoints=function(t,i,e,o,n){void 0===o&&(o=t),void 0===n&&(n=i);for(var r=0;e>r;r++){var s=t[i++],h=t[i++];o[n++]=this.mapX(s,h),o[n++]=this.mapY(s,h)}},t.prototype.mapRect=function(t,i){void 0===i&&(i=new g);var e=t.topLeft(),o=t.bottomLeft(),n=t.bottomRight(),r=t.topRight();return this.mapPoint(e,e),this.mapPoint(o,o),this.mapPoint(n,n),this.mapPoint(r,r),i.left=i.right=e.x,i.top=i.bottom=e.y,i.unionPoint(o),i.unionPoint(n),i.unionPoint(r),i},t.prototype.log=function(){console.log(this.toString())},t.prototype.toString=function(){return"m11: "+this.m11+", m12: "+this.m12+", m13: "+this.m13+", m21: "+this.m21+", m22: "+this.m22+", m23: "+this.m23},t.prototype.equals=function(t){this.m11==t.m11&&this.m12==t.m12&&this.m13==t.m13&&this.m21==t.m21&&this.m22==t.m22&&this.m23==t.m23},t}();e.Matrix=w;var x=function(){function t(t,i){void 0===i&&(i=0),this._data=t,this._size=i,this._capacity=t.length/2}return t.fromPath=function(i){return new t(new Float32Array(i._data),i._size)},t.withCapacity=function(i){return new t(new Float32Array(2*i))},Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),t.prototype.pointAt=function(t){var i=2*t,e=this._data[i],o=this._data[i+1];return new d(e,o)},t.prototype.xAt=function(t){return this._data[2*t]},t.prototype.yAt=function(t){return this._data[2*t+1]},t.prototype.pointBetween=function(t,i){return d.between(this.pointAt(t),this.pointAt(i))},t.prototype.forEach=function(t,i,e){void 0===i&&(i=0),void 0===e&&(e=this._size);for(var o=2*i,n=0;e>n;n++)t(this._data[o++],this._data[o++],i++)},t.prototype.forEachEdge=function(t,i,e){void 0===i&&(i=0),void 0===e&&(e=this._size);for(var o=this._data,n=2*i,r=2*(i+e),s=o[r-2],h=o[r-1],a=0,c=0;r>n;)a=o[n++],c=o[n++],t(s,h,a,c),s=a,h=c},t.prototype.put=function(t,i){this.set(this._size++,t,i)},t.prototype.putPoint=function(t){this.setPoint(this._size++,t)},t.prototype.putPath=function(t){this.putData(t._data,0,t._size)},t.prototype.putData=function(t,i,e){this.setData(this._size,t,i,e),this._size+=e},t.prototype.set=function(t,i,e){var o=2*t;this._data[o]=i,this._data[o+1]=e},t.prototype.setPoint=function(t,i){this.set(t,i.x,i.y)},t.prototype.setPath=function(t,i){this.setData(t,i._data,0,i._size)},t.prototype.setData=function(t,i,e,o){for(var n=2*t,r=0;o>r;r++)this._data[n++]=i[e++],this._data[n++]=i[e++]},t.prototype.calculateBounds=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=this._size),g.fromUnion(this._data,2*t,i)},t.prototype.contains=function(t,i,e,o){void 0===e&&(e=0),void 0===o&&(o=this._size);var n=!1;return this.forEachEdge(function(e,o,r,s){o>i!=s>i&&(r-e)*(i-o)/(s-o)+e>t&&(n=!n)},e,o),n},t.prototype.containsPoint=function(t,i,e){return void 0===i&&(i=0),void 0===e&&(e=this._size),this.contains(t.x,t.y,i,e)},t.prototype.offset=function(t,i,e,o){void 0===e&&(e=0),void 0===o&&(o=this.size);for(var n=2*e,r=0;o>=r;r++)this._data[n++]+=t,this._data[n++]+=i},t.prototype.transform=function(t,i,e){void 0===i&&(i=0),void 0===e&&(e=this.size),t.mapPoints(this._data,2*i,e,this._data,2*i)},t.prototype.log=function(){console.log(this.toString())},t.prototype.toString=function(){return"{capacity: "+this._capacity+", count: "+this._size+", data: "+this._data+"}"},t.prototype.logData=function(){var t="";this.forEach(function(i,e){t+=i+", "+e+" "}),console.log(t)},t}();e.Path=x;var b=function(){function t(t,i,e,o){this.vertices=t,this.indices=i,this.bounds=t.calculateBounds(),this.fixedPoint=e,this.controlPoint=o}return t.polygon=function(i){var e=t.generatePolygonVertices(i),o=t.generatePolygonIndices(i),n=e.pointAt(0),r=i>>1,s=1&i?e.pointBetween(r,r+1):e.pointAt(r);return new t(e,o,n,s)},t.generatePolygonVertices=function(t){var i=x.withCapacity(t),e=new d(0,100);i.putPoint(e);for(var o=w.rotateByAngle(2*Math.PI/t);i.size<i.capacity;)o.mapPoint(e,e),i.putPoint(e);return i},t.generatePolygonIndices=function(t){for(var i=new Uint16Array(3*(t-2)),e=0,o=1,n=2;e<i.length;o=n++)i[e++]=0,i[e++]=o,i[e++]=n;return i},t.star=function(i,e,o){var n=t.generateStarVertices(i,e,o),r=t.generateStarIndices(i),s=n.pointAt(0),h=1&i?n.pointBetween(i-1,i+1):n.pointAt(i);return new t(n,r,s,h)},t.generateStarVertices=function(t,i,e){var o=x.withCapacity(t+t),n=2*Math.PI/t,r=new w,s=new d(0,100*e);o.putPoint(s);var h=new d(0,100*i);for(r.setRotate(.5*n),r.mapPoint(h,h),o.putPoint(h),r.setRotate(n);o.size<o.capacity;)r.mapPoint(s,s),r.mapPoint(h,h),o.putPoint(s),o.putPoint(h);return o},t.generateStarIndices=function(t){for(var i=3*(t-2),e=3*t,o=new Uint16Array(i+e),n=0,r=3,s=5;i>n;r=s++,s++)o[n++]=1,o[n++]=r,o[n++]=s;for(var h=2*t-1,r=0,s=1;n<o.length;h=s++,r=s++)o[n++]=h,o[n++]=r,o[n++]=s;return o},t.diamond=function(){return t.star(2,.5,1)},t.square=function(){var i=x.withCapacity(10);i.put(-100,100),i.put(-100,-100),i.put(100,-100),i.put(100,100);var e=t.generatePolygonIndices(4),o=new d(0,100),n=new d(0,-100);return new t(i,e,o,n)},t.star5=function(){return t.star(5,.4,1)},t.bat=function(){var i=x.withCapacity(20);i.put(0,3),i.put(-2,5),i.put(-3,2),i.put(-5,0),i.put(-8,3),i.put(-10,7),i.put(-17,10),i.put(-13,5),i.put(-12,-1),i.put(-3,-7),i.put(0,-10),i.put(3,-7),i.put(12,-1),i.put(13,5),i.put(17,10),i.put(10,7),i.put(8,3),i.put(5,0),i.put(3,2),i.put(2,5);var e=new Uint16Array([0,1,2,0,2,3,0,3,9,0,9,10,0,10,11,0,11,17,0,17,18,0,18,19,4,5,6,4,6,7,4,7,8,4,8,9,4,9,3,16,14,15,16,13,14,16,12,13,16,11,12,16,17,11]),o=i.pointBetween(1,19),n=i.pointAt(10);return new t(i,e,o,n)},t.heart=function(){var i=x.withCapacity(10);i.put(0,12),i.put(-3,16),i.put(-5,16),i.put(-8,12),i.put(-8,8),i.put(0,0),i.put(8,8),i.put(8,12),i.put(5,16),i.put(3,16);var e=t.generatePolygonIndices(10),o=i.pointBetween(1,9),n=i.pointAt(5);return new t(i,e,o,n)},t.flower=function(){var i=x.withCapacity(20);i.put(0,-2),i.put(-1,-1),i.put(-2,-1),i.put(-2,-2),i.put(-3,-3),i.put(-1,-3),i.put(-2,-4),i.put(-2,-5),i.put(-1,-5),i.put(0,-6),i.put(0,-4),i.put(1,-5),i.put(2,-5),i.put(2,-4),i.put(3,-3),i.put(1,-3),i.put(2,-2),i.put(2,-1),i.put(1,-1),i.put(0,0);var e=new Uint16Array([5,0,1,5,1,2,5,2,3,5,3,4,5,6,7,5,7,8,5,8,9,5,9,10,5,10,0,15,0,10,15,10,11,15,11,12,15,12,13,15,13,14,15,16,17,15,17,18,15,18,19,15,19,0]),o=i.pointAt(19),n=i.pointAt(9);return new t(i,e,o,n)},t.prototype.contains=function(t,i){return this.bounds.contains(t,i)&&this.vertices.contains(t,i)},t.prototype.containsPoint=function(t){return this.contains(t.x,t.y)},t.prototype.log=function(){console.log(this.toString())},t.prototype.toString=function(){return"vertices: "+this.vertices+", bounds: "+this.bounds+",\n                    fixedPoint: "+this.fixedPoint+", controlPoint: "+this.controlPoint},t}();e.Mesh=b;var C=function(){function t(t,i,e,o){this.meshes=t,this.vertices=i,this.indices=e,this.offsets=o}return t.fromMeshes=function(i){for(var e=0,o=0,n=0;n<i.length;n++)e+=i[n].vertices.size,o+=i[n].indices.length;for(var r=x.withCapacity(e),s=new Uint16Array(o),h=new Uint16Array(i.length),a=0,n=0;n<i.length;n++){var c=r.size;h[n]=a,r.putPath(i[n].vertices);for(var p=i[n].indices,u=0;u<p.length;u++)s[a++]=p[u]+c}return new t(i,r.data,s,h)},t}();e.PackedMeshInfo=C;var P=function(){function t(t){this.mesh=t,this.matrix=w.identity(),this.inverse=w.identity()}return t.test=function(){console.log("Shape test");var i=b.diamond(),e=new t(i),o=new d(0,100),n=new d(0,0),r=new d,s=g.fromLRBT(0,100,0,100),h=new g;e.stretchAcrossLine(o,n),e.matrix.mapPoint(i.fixedPoint,r),console.log("start:"+o),console.log("start?"+r),e.matrix.mapPoint(i.controlPoint,r),console.log("end:"+n),console.log("end?"+r),e.fitInRect(s,2),i.vertices.transform(e.matrix),h=i.vertices.calculateBounds(),console.log("rect:"+s),console.log("rect?:"+h),console.log("End test")},t.prototype.contains=function(t,i){var e=this.inverse.map(t,i);return this.mesh.containsPoint(e)},t.prototype.containsPoint=function(t){return this.contains(t.x,t.y)},t.prototype.offset=function(t,i){this.matrix.postTranslate(t,i),this.inverse.postTranslate(-t,-i)},t.prototype.transform=function(t){this.matrix.postConcat(t),this.inverse.setInverse(this.matrix)},t.prototype.fitInRect=function(t,i){this.matrix.setRectToRect(this.mesh.bounds,t,i),this.inverse.setRectToRect(t,this.mesh.bounds,i)},t.prototype.stretchAcrossLine=function(t,i){var e=m.fromPointToPoint(this.mesh.fixedPoint,t),o=t.x,n=t.y;t=d.fromPoint(this.mesh.controlPoint),t.offset(e.x,e.y),this.matrix=w.stretchRotateFromPointToPoint(t,i,o,n),this.matrix.preTranslate(e.x,e.y),this.inverse.setInverse(this.matrix)},t.prototype.log=function(){console.log(this.toString())},t.prototype.toString=function(){return"mesh: "+this.mesh.toString()+", matrix: "+this.matrix+", inverse: "+this.inverse},t}();e.Shape=P,e.addDragListener=o,e.getEventPosition=n,e.randomInt=s,e.randomRgba=h,e.stringToRgba=a,e.rgbaToString=c,e.logRgba=u,e.blend=l,e.clamp=f},{}],2:[function(t,i,e){"use strict";function o(t,i,e){for(var o=-i;i>=o;o++)for(var n=Math.max(-i,-o-i),r=Math.min(i,-o+i),s=n;r>=s;s++)e(new u(o+t.q,s+t.r))}function n(t,i,e,n){var r=u.fromCube(i);r.subtract(t);for(var s=r.distanceToOrigin(),h=1/Math.max(s,1),a=0;s>=a;a++){var c=h*a,p=u.fromCube(t);p.q+=r.q*c,p.r+=r.r*c,p.s+=r.s*c,p.round(),o(p,e,n)}}var r=t("./graphics2d"),s=Math.sqrt(3),h=6,a=!1,c=twgl.primitives.createAugmentedTypedArray,p=function(){function t(t,i,e,o,n,r){void 0===i&&(i=t.inverse()),this.matrix=t,this.inverse=i,this.width=e,this.height=o,this.right=n,this.up=r}return t}();p.FlatTop=new p(r.Matrix.from2x2(1.5,0,s/2,s),r.Matrix.from2x2(2/3,0,-1/3,s/3),2,s,.5,s/2),p.PointyTop=new p(r.Matrix.from2x2(s,s/2,0,1.5),r.Matrix.from2x2(s/3,-1/3,0,2/3),s,2,s/2,.5),e.Orientation=p;var u=function(){function t(t,i,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=-t-i),this.q=t,this.r=i,this.s=e}return t.fromCube=function(i){return new t(i.q,i.r,i.s)},t.prototype.set=function(t,i,e){void 0===e&&(e=-t-i),this.q=t,this.r=i,this.s=e},t.prototype.distanceToCube=function(t){return Math.max(Math.abs(this.q-t.q),Math.abs(this.r-t.r),Math.abs(this.s-t.s))},t.prototype.distanceToOrigin=function(){return Math.max(Math.abs(this.q),Math.abs(this.r),Math.abs(this.s))},t.prototype.neighbors=function(){for(var t=[],i=0;i<e.Directions.length;i++)t.push(this.neighbor(e.Directions[i]));return t},t.prototype.neighbor=function(i){var e=t.fromCube(this);return e.add(i),e},t.prototype.forEachNeighbor=function(t){for(var i=0;i<e.Directions.length;i++)t(this.neighbor(e.Directions[i]))},t.prototype.add=function(t){this.q+=t.q,this.r+=t.r,this.s+=t.s},t.prototype.subtract=function(t){this.q-=t.q,this.r-=t.r,this.s-=t.s},t.prototype.round=function(){var t=this.q,i=this.r,e=this.s;this.q=Math.round(t),this.r=Math.round(i),this.s=Math.round(e);var o=Math.abs(this.q-t),n=Math.abs(this.r-i),r=Math.abs(this.s-e);o>n&&o>r?this.q=-this.r-this.s:n>r?this.r=-this.q-this.s:this.s=-this.q-this.r},t.prototype.equals=function(t){return this.q===t.q&&this.r===t.r&&this.s===t.s},t.prototype.log=function(){console.log(this.toString())},t.prototype.toString=function(){return"{q: "+this.q+", r: "+this.r+" s: "+this.s+"}"},t}();e.Cube=u,e.Directions=[new u(1,-1,0),new u(1,0,-1),new u(0,1,-1),new u(-1,1,0),new u(-1,0,1),new u(0,-1,1)];var l=function(){function t(t,i,e){void 0===e&&(e=p.PointyTop),this.rows=i,this.cols=t,this.size=i*t,this.orientation=e}return t.prototype.width=function(){return this.orientation===p.FlatTop?this.orientation.width*(.75*this.cols+.25):this.orientation.width*(this.cols+.5)},t.prototype.height=function(){return this.orientation===p.FlatTop?this.orientation.height*(this.rows+.5):this.orientation.height*(.75*this.rows+.25)},t.prototype.forEachCube=function(t){if(this.orientation===p.FlatTop)for(var i=0;i<this.cols;i++)for(var e=i>>1,o=-e;o<this.rows-e;o++)t(new u(i,o));else for(var o=0;o<this.rows;o++)for(var n=o>>1,i=-n;i<this.cols-n;i++)t(new u(i,o))},t.prototype.cubeAt=function(t){if(this.orientation===p.FlatTop){var i=t/this.rows>>0,e=t%this.rows-(i>>1);return new u(i,e)}var e=t/this.cols>>0,i=t%this.cols-(e>>1);return new u(i,e)},t.prototype.offsetAt=function(t){if(this.orientation===p.FlatTop){var i=t/this.rows,e=t%this.rows;return new r.Point(i>>0,e>>0)}var i=t%this.cols,e=t/this.cols;return new r.Point(i>>0,e>>0)},t.prototype.indexOfCube=function(t){if(this.orientation===p.FlatTop){if(0<=t.q&&t.q<this.cols){var i=t.q>>1;if(-i<=t.r&&t.r<this.rows-i)return this.rows*t.q+t.r+i}}else if(0<=t.r&&t.r<this.rows){var e=t.r>>1;if(-e<=t.q&&t.q<this.cols-e)return this.cols*t.r+t.q+e}return-1},t.prototype.indexOfOffset=function(t){return 0<=t.x&&t.x<this.cols&&0<=t.y&&t.y<this.rows?this.orientation===p.FlatTop?this.rows*t.x+t.y:this.cols*t.y+t.x:-1},t}();e.Grid=l;var f=function(){function t(t,i){void 0===i&&(i=new ArrayBuffer(4*t.size)),this.grid=t,this.hexels=new DataView(i),this.bounds=r.Rect.fromLRBT(0,t.width(),0,t.height()),this.hexelsPerSection=Math.min(t.size,8192),this.sections=t.size/this.hexelsPerSection}return t.prototype.sectionWidth=function(){var t=this.grid;return t.orientation==p.FlatTop?.75*t.orientation.width*t.cols/this.sections:t.orientation.width*t.cols/this.sections},t.prototype.sectionHeight=function(){var t=this.grid;return t.orientation==p.FlatTop?t.orientation.height*t.rows/this.sections:.75*t.rows*t.orientation.height/this.sections},t.prototype.generateVertices=function(){var t=this.hexelsPerSection,i=c(2,h*t,Float32Array),e=this.grid.orientation;return this.grid.orientation===p.FlatTop?this.forEachCenterVertex(function(t,o,n){i.push(t-e.right,o+e.up),i.push(t-1,o),i.push(t-e.right,o-e.up),i.push(t+e.right,o-e.up),i.push(t+1,o),i.push(t+e.right,o+e.up)},t):this.forEachCenterVertex(function(t,o,n){i.push(t,o+1),i.push(t-e.right,o+e.up),i.push(t-e.right,o-e.up),i.push(t,o-1),i.push(t+e.right,o-e.up),i.push(t+e.right,o+e.up)},t),i},t.prototype.generateIndices=function(){for(var t=this.hexelsPerSection,i=c(1,12*t,Uint16Array),e=0;t>e;e++){var o=e*h;i.push(o,o+1,o+2,o,o+2,o+3,o,o+3,o+4,o,o+4,o+5)}return i},t.prototype.generateTexCoords=function(){for(var t=this.hexelsPerSection,i=c(2,h*t,Float32Array),e=this.grid.rows,o=this.grid.cols,n=0,r=0;e>r;r++)for(var s=0;o>s;s++){var a=s/o,p=r/e;if(i.push(a,p,a,p,a,p,a,p,a,p,a,p),++n===t)return i}return i},t.prototype.generateGradientAttribs=function(){for(var t=this.hexelsPerSection,i=c(1,h*t,Float32Array),e=18/256,o=.125,n=50/256,r=0;t>r;r++)i.push(e,o,n,-e,-o,-n);return i},t.prototype.forEachCenterVertex=function(t,i){void 0===i&&(i=this.grid.size);var e=this.grid,o=e.orientation,n=this.bounds.left+o.width/2,r=this.bounds.bottom+o.height/2,s=0;if(o===p.FlatTop)for(var h=0;h<e.cols;h++)for(var a=h/2-(h>>1),c=a;c<e.rows+a;c++){var u=n+h*o.width*.75,l=r+c*o.height;if(t(u,l,s++),s===i)return}else for(var c=0;c<e.rows;c++)for(var f=c/2-(c>>1),h=f;h<e.cols+f;h++){var u=n+h*o.width,l=r+c*o.height*.75;if(t(u,l,s++),s===i)return}},t.prototype.cubeToClip=function(t){var i=this.grid.orientation,e=this.bounds.left+i.width/2,o=this.bounds.bottom+i.height/2;return this.grid.orientation===p.FlatTop?(e+=t.q*i.width*.75,o+=(t.r+t.q/2)*i.height):(e+=(t.q+t.r/2)*i.width,o+=t.r*i.height*.75),new r.Point(e,o)},t.prototype.clipToCube=function(t){var i=this.grid.orientation,e=t.x-(i.width/2+this.bounds.left),o=t.y-(i.height/2+this.bounds.bottom),n=i.inverse.mapX(e,o),r=i.inverse.mapY(e,o);return new u(n,r)},t.prototype.indexOfHexel=function(t){var i=this.clipToCube(t);return i.round(),this.grid.indexOfCube(i)},t.prototype.getColor=function(t){return this.hexels.getUint32(4*t,a)},t.prototype.setColor=function(t,i){this.hexels.setUint32(4*t,i,a)},t.prototype.mixColor=function(t,i){var e=this.getColor(t),o=r.blend(i,e);this.setColor(t,o)},t.prototype.addLine=function(t,i,e){var o=this;this.forEachCenterVertex(function(n,r,s){t.contains(n,r,i)&&o.mixColor(s,e)})},t.prototype.eraseLine=function(t,i){
var e=this;this.forEachCenterVertex(function(o,n,r){t.contains(o,n,i)&&e.setColor(r,0)})},t.prototype.addShape=function(t,i){var e=this;this.forEachCenterVertex(function(o,n,r){t.contains(o,n)&&e.mixColor(r,i)})},t.prototype.eraseShape=function(t){var i=this;this.forEachCenterVertex(function(e,o,n){t.contains(e,o)&&i.setColor(n,0)})},t.prototype.addStroke=function(t,i,e,o){var r=this;n(t,i,e,function(t){var i=r.grid.indexOfCube(t);-1!=i&&r.mixColor(i,o)})},t.prototype.eraseStroke=function(t,i,e){var o=this;n(t,i,e,function(t){var i=o.grid.indexOfCube(t);-1!=i&&o.setColor(i,0)})},t.prototype.setRange=function(t,i,e){var n=this;o(t,i,function(t){var i=n.grid.indexOfCube(t);-1!=i&&n.mixColor(i,e)})},t.prototype.eraseRange=function(t,i){var e=this;o(t,i,function(t){var i=e.grid.indexOfCube(t);-1!=i&&e.setColor(i,0)})},t.prototype.floodFill=function(t,i){var e=this.getColor(t);if(i=r.blend(i,e),e!==i){var o=this.grid.offsetAt(t);this.floodFillScanLine(o.x,o.y,i,e)}},t.prototype.floodFillErase=function(t){var i=this.getColor(t);if(0!==i){var e=this.grid.offsetAt(t);this.floodFillScanLine(e.x,e.y,0,i)}},t.prototype.floodFillScanLine=function(t,i,e,o){var n,s,h,a,c,p=this.grid.cols,u=this.grid.rows,l=[],f=new r.Point(t,i);for(l.push(f);l.length>0;){for(f=l.pop(),t=f.x,i=f.y,n=i*p,s=n+p,h=n-p,a=!1,c=!1;t>=0&&this.getColor(t+n)==o;)t--;for(0==(1&i)&&t>=0&&(i>0&&this.getColor(t+h)==o&&(l.push(new r.Point(t,i-1)),a=!0),u-1>i&&this.getColor(t+s)==o&&(l.push(new r.Point(t,i+1)),c=!0)),t++;p>t&&this.getColor(t+n)==o;t++)this.setColor(t+n,e),i>0&&(a||this.getColor(t+h)!=o?a&&this.getColor(t+h)!=o&&(a=!1):(l.push(new r.Point(t,i-1)),a=!0)),u-1>i&&(c||this.getColor(t+s)!=o?c&&this.getColor(t+s)!=o&&(c=!1):(l.push(new r.Point(t,i+1)),c=!0));1&i&&p>t&&(!a&&i>0&&this.getColor(t+h)==o&&l.push(new r.Point(t,i-1)),!c&&u-1>i&&this.getColor(t+s)==o&&l.push(new r.Point(t,i+1)))}},t.prototype.recursiveFloodFillScanLine=function(t,i,e,o){var n,r=this.grid.cols,s=this.grid.rows,h=i*r;for(n=t;r>n&&this.getColor(n+h)==o;n++)this.setColor(n+h,e);for(n=t-1;n>=0&&this.getColor(n+h)==o;n--)this.setColor(n+h,e);if(i>0){var a=h-r;for(n=t;r>n&&this.getColor(n+h)==e;n++)this.getColor(n+a)==o&&this.recursiveFloodFillScanLine(n,i-1,e,o);for(1&i&&r>n&&this.getColor(n+a)==o&&this.recursiveFloodFillScanLine(n,i-1,e,o),n=t-1;n>=0&&this.getColor(n+h)==e;n--)this.getColor(n+a)==o&&this.recursiveFloodFillScanLine(n,i-1,e,o);0==(1&i)&&n>=0&&this.getColor(n+a)==o&&this.recursiveFloodFillScanLine(n,i-1,e,o)}if(s-1>i){var c=h+r;for(n=t;r>n&&this.getColor(n+h)==e;n++)this.getColor(n+c)==o&&this.recursiveFloodFillScanLine(n,i+1,e,o);for(1&i&&r>n&&this.getColor(n+c)==o&&this.recursiveFloodFillScanLine(n,i+1,e,o),n=t-1;n>=0&&this.getColor(n+h)==e;n--)this.getColor(n+c)==o&&this.recursiveFloodFillScanLine(n,i+1,e,o);0==(1&i)&&n>=0&&this.getColor(n+c)==o&&this.recursiveFloodFillScanLine(n,i+1,e,o)}},t}();e.Layout=f;var d=function(){function t(t,i,e){this.region=new r.Rect,this.matrix=twgl.m4.identity(),this.zoom=1,this.pan=new r.Vec2,this.bounds=t,this.minZoom=i,this.maxZoom=e}return t.prototype.fillViewport=function(t,i){this.region.setRect(this.bounds);var e=this.bounds.width(),o=this.bounds.height(),n=t/i,r=e/o;n>r?this.region.scale(n/r,1):this.region.scale(1,r/n),this.region.stretch(1/this.zoom),this.region.offset(this.pan.x,this.pan.y),this.applyChangesToMatrix()},t.prototype.panByVector=function(t){this.applyChangeInPan(t),this.applyChangesToMatrix()},t.prototype.zoomToPoint=function(t,i){var e=this.region.pointAt(i.x,i.y);this.applyChangeInZoom(t);var o=this.region.pointAt(i.x,i.y),n=r.Vec2.fromPointToPoint(o,e);this.applyChangeInPan(n),this.applyChangesToMatrix()},t.prototype.applyChangeInZoom=function(t){var i=this.zoom*t;i<this.minZoom?(t=this.minZoom/this.zoom,this.zoom=this.minZoom):i>this.maxZoom?(t=this.maxZoom/this.zoom,this.zoom=this.maxZoom):this.zoom=i,this.region.stretch(1/t)},t.prototype.applyChangeInPan=function(t){var i=new r.Vec2;i.add(this.pan),i.add(t);var e=r.Rect.fromRect(this.bounds);e.mulScalar((this.zoom-this.minZoom)/this.zoom),e.offset(-e.centerX(),-e.centerY()),i.x<e.left?t.x=e.left-this.pan.x:i.x>e.right&&(t.x=e.right-this.pan.x),i.y<e.bottom?t.y=e.bottom-this.pan.y:i.y>e.top&&(t.y=e.top-this.pan.y),this.region.offset(t.x,t.y),this.pan.add(t)},t.prototype.applyChangesToMatrix=function(){twgl.m4.ortho(this.region.left,this.region.right,this.region.bottom,this.region.top,.1,10,this.matrix)},t}();e.Projection=d;var m=function(){function t(t,i,e,o){this.needToRender=!1,this.program=-1,this.rgba=[0,0,0,1],this.alpha=1,this.gl=t,this.layout=i,this.projection=e,this.packedMeshInfo=o}return Object.defineProperty(t.prototype,"color",{set:function(t){this.rgba[0]=(t>>24&255)/255,this.rgba[1]=(t>>16&255)/255,this.rgba[2]=(t>>8&255)/255,this.rgba[3]=(t>>0&255)/255,this.rgba[0]*=this.rgba[3],this.rgba[1]*=this.rgba[3],this.rgba[2]*=this.rgba[3]},enumerable:!0,configurable:!0}),t.prototype.onSurfaceCreated=function(){this.gl.clearColor(0,0,0,0),this.gl.cullFace(this.gl.BACK),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.ellipseShader=twgl.createProgramInfo(this.gl,["vs-ellipse","fs-ellipse"]),this.hexelShader=twgl.createProgramInfo(this.gl,["vs-hexel","fs-hexel"]),this.lineShader=twgl.createProgramInfo(this.gl,["vs-line","fs-line"]),this.polyShader=twgl.createProgramInfo(this.gl,["vs-poly","fs-poly"]),this.ellipseShader.bufferInfo=twgl.createBufferInfoFromArrays(this.gl,{indices:{numComponents:1,data:r.Mesh.generatePolygonIndices(4)},a_texCoord:{numComponents:2,data:new Float32Array([0,1,0,0,1,0,1,1])}}),this.hexelShader.bufferInfo=twgl.createBufferInfoFromArrays(this.gl,{indices:this.layout.generateIndices(),a_position:this.layout.generateVertices(),a_texCoord:this.layout.generateTexCoords(),a_gradient:this.layout.generateGradientAttribs()}),this.lineShader.bufferInfo=twgl.createBufferInfoFromArrays(this.gl,{indices:{numComponents:1,data:r.Mesh.generatePolygonIndices(4)},a_position:{numComponents:2,data:new Float32Array([0,.5,0,-.5,1,-.5,1,.5])}}),this.polyShader.bufferInfo=twgl.createBufferInfoFromArrays(this.gl,{indices:{numComponents:1,data:this.packedMeshInfo.indices},a_position:{numComponents:2,data:this.packedMeshInfo.vertices}}),this.texOptions={width:this.layout.grid.cols,height:this.layout.grid.rows,minMag:this.gl.NEAREST,wrap:this.gl.CLAMP_TO_EDGE,src:new Uint8Array(this.layout.hexels.buffer)},this.texture=twgl.createTexture(this.gl,this.texOptions)},t.prototype.onSurfaceChanged=function(t,i){this.gl.viewport(0,0,t,i),this.projection.fillViewport(t,i),this.needToRender=!0},t.prototype.onDrawFrame=function(){this.clear(),this.renderLayout(this.layout),this.shape&&this.renderShape(this.shape),this.ellipse&&this.renderEllipse(this.ellipse),this.line&&this.renderLine(this.line)},t.prototype.clear=function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},t.prototype.renderLayout=function(t){this.useShader(this.hexelShader)&&(this.gl.enable(this.gl.CULL_FACE),this.gl.disable(this.gl.BLEND)),twgl.setUniforms(this.hexelShader,{u_tex:this.texture});var i=r.Rect.fromRect(this.projection.region),e=twgl.m4.identity(),o=0,n=0;t.grid.orientation==p.FlatTop?o=-t.sectionWidth():n=-t.sectionHeight();var s=new Float32Array(2);s[0]=.5/t.grid.cols,s[1]=.5/t.grid.rows;var h=1/t.sections,a=t.clipToCube(new r.Point(0,i.bottom)).r-1,c=t.clipToCube(new r.Point(0,i.top)).r+1,u=t.hexelsPerSection/t.grid.cols,l=Math.max(0,Math.floor(a/u)),f=Math.min(t.sections,Math.ceil(c/u));i.offset(l*o,l*n),s[1]+=h*l;for(var d=l;f>d;d++)twgl.m4.ortho(i.left,i.right,i.bottom,i.top,.1,10,e),twgl.setUniforms(this.hexelShader,{u_MVP:e,u_baseTexCoord:s}),twgl.drawBufferInfo(this.gl,this.hexelShader.bufferInfo),i.offset(o,n),s[1]+=h},t.prototype.renderShape=function(t){this.useShader(this.polyShader)&&(this.gl.disable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND));var i=[];i[0]=t.matrix.m11,i[1]=t.matrix.m21,i[2]=0,i[3]=t.matrix.m12,i[4]=t.matrix.m22,i[5]=0,i[6]=t.matrix.m13,i[7]=t.matrix.m23,i[8]=0,twgl.setUniforms(this.polyShader,{u_MVP:this.projection.matrix,u_shapeMatrix:i,u_color:this.rgba,u_alpha:this.alpha});var e=this.gl.TRIANGLES,o=t.mesh.indices.length,n=this.gl.UNSIGNED_SHORT,r=this.packedMeshInfo.meshes.indexOf(t.mesh),s=2*this.packedMeshInfo.offsets[r];this.gl.drawElements(e,o,n,s)},t.prototype.renderEllipse=function(t){this.useShader(this.ellipseShader)&&this.gl.enable(this.gl.BLEND);var i=[];i[0]=t.left,i[1]=t.bottom,i[2]=t.width(),i[3]=t.height(),twgl.setUniforms(this.ellipseShader,{u_MVP:this.projection.matrix,u_rect:i,u_color:this.rgba}),twgl.drawBufferInfo(this.gl,this.ellipseShader.bufferInfo)},t.prototype.renderLine=function(t){this.useShader(this.lineShader)&&this.gl.enable(this.gl.BLEND);var i=[];i[0]=t.x1,i[1]=t.y1,i[2]=t.x2,i[3]=t.y2,twgl.setUniforms(this.lineShader,{u_MVP:this.projection.matrix,u_color:this.rgba,u_thickness:this.lineThickness,u_line:i}),twgl.drawBufferInfo(this.gl,this.lineShader.bufferInfo)},t.prototype.useShader=function(t){return this.program!=t.program?(this.gl.useProgram(t.program),this.program=t.program,twgl.setBuffersAndAttributes(this.gl,t,t.bufferInfo),!0):!1},t.prototype.applyColorChanges=function(){twgl.setTextureFromArray(this.gl,this.texture,this.texOptions.src,this.texOptions),this.needToRender=!0},t.prototype.applyLayoutChanges=function(){var t=this.gl,i=this.hexelShader.bufferInfo,e=this.hexelShader.bufferInfo.attribs,o=this.layout.generateIndices(),n=this.layout.generateVertices(),r=this.layout.generateTexCoords(),s=this.layout.generateGradientAttribs();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.indices),t.bufferData(t.ELEMENT_ARRAY_BUFFER,o,t.STATIC_DRAW),i.numElements=o.length,twgl.setAttribInfoBufferFromArray(t,e.a_position,n),twgl.setAttribInfoBufferFromArray(t,e.a_texCoord,r),twgl.setAttribInfoBufferFromArray(t,e.a_gradient,s),this.texOptions={width:this.layout.grid.cols,height:this.layout.grid.rows,minMag:this.gl.NEAREST,wrap:this.gl.CLAMP_TO_EDGE,src:new Uint8Array(this.layout.hexels.buffer)},this.gl.deleteTexture(this.texture),this.texture=twgl.createTexture(this.gl,this.texOptions),this.needToRender=!0},t.prototype.enableShadows=function(){twgl.setAttribInfoBufferFromArray(this.gl,this.hexelShader.bufferInfo.attribs.a_gradient,this.layout.generateGradientAttribs()),this.needToRender=!0},t.prototype.disableShadows=function(){twgl.setAttribInfoBufferFromArray(this.gl,this.hexelShader.bufferInfo.attribs.a_gradient,new Float32Array(this.layout.hexelsPerSection*h)),this.needToRender=!0},t}();e.Renderer=m;var g=function(){function t(t,i){this.canvas=t,this.renderer=i;var e=this.canvas.clientWidth,o=this.canvas.clientHeight;this.renderer.onSurfaceCreated(),this.renderer.onSurfaceChanged(e,o)}return t.prototype.requestRender=function(){this.renderer.needToRender=!0},t.prototype.resize=function(){var t=window.devicePixelRatio,i=Math.floor(this.canvas.clientWidth*t),e=Math.floor(this.canvas.clientHeight*t);return this.canvas.width!==i||this.canvas.height!==e?(this.canvas.width=i,this.canvas.height=e,this.renderer.onSurfaceChanged(i,e),!0):!1},t.prototype.screenToCanvas=function(t,i){return void 0===i&&(i=new r.Point),r.getEventPosition(this.canvas,t,i)},t.prototype.screenToNdc=function(t,i){return void 0===i&&(i=new r.Point),this.screenToCanvas(t,i),this.canvasToNdc(i,i),i},t.prototype.screenToClip=function(t,i){return void 0===i&&(i=new r.Point),this.screenToCanvas(t,i),this.canvasToNdc(i,i),this.ndcToClip(i,i),i},t.prototype.canvasToNdc=function(t,i){void 0===i&&(i=new r.Point);var e=this.canvas.clientWidth,o=this.canvas.clientHeight;return i.x=t.x/e,i.y=(o-t.y)/o,i},t.prototype.ndcToClip=function(t,i){return void 0===i&&(i=new r.Point),this.renderer.projection.region.pointAt(t.x,t.y,i)},t}();e.Surface=g,e.forEachCubeInRange=o,e.forEachCubeInLine=n},{"./graphics2d":1}],3:[function(t,i,e){"use strict";function o(t,i){t!=z&&($(O).children("i").addClass("md-inactive").removeClass("md-active"),$(i).children("i").addClass("md-active").removeClass("md-inactive"),U=z,V=O,z=t,O=i)}function n(){(A.resize()||R.needToRender)&&(R.needToRender=!1,R.onDrawFrame()),requestAnimationFrame(n)}function r(t){t.preventDefault(),t.stopPropagation();var i=t.detail<0||t.wheelDelta>0,e=i?1.5:.666666,o=A.screenToNdc(t);R.projection.zoomToPoint(e,o),R.needToRender=!0}function s(t){for(var i=-1;0!=t;)t>>=1,i++;return i}function h(t,i){var e=new FileReader;e.onload=function(t){var e=new Image;e.onload=function(){i(e)},e.src=t.target.result},e.readAsDataURL(t)}function a(t,i,e,o,n,r,s){void 0===o&&(o=0),void 0===n&&(n=0),void 0===r&&(r=P.cols),void 0===s&&(s=P.rows),i.clearRect(0,0,t.width,t.height),i.drawImage(e,0,0,e.width,e.height,o,n,r,s)}function c(t,i,e){for(var o=i.getImageData(0,0,P.cols,P.rows).data,n=new DataView(o.buffer),r=0,s=t.height-1;s>=0;s--)for(var h=0;h<t.width;h++,r++){var a=t.width*s+h,c=n.getUint32(4*a,!1);if(0!=c){var p=u.blend(c,e.getColor(r));e.setColor(r,p)}}R.applyColorChanges()}function p(t,i,e){for(var o=new Uint8ClampedArray(t.hexels.buffer),n=new Uint8ClampedArray(o.byteLength),r=0,s=0,h=P.rows-1;h>=0;h--)for(var a=0;a<P.cols;a++)s=4*(i.width*h+a),n[s++]=o[r++],n[s++]=o[r++],n[s++]=o[r++],n[s++]=o[r++];var c=new ImageData(n,P.cols,P.rows);e.clearRect(0,0,i.width,i.height),e.putImageData(c,0,0)}var u=t("./graphics2d"),l=t("./hexel");vex.defaultOptions.className="vex-theme-wireframe";var f=document.getElementById("onscreen-canvas"),d=twgl.getWebGLContext(f),m=8388863,g=0,y=1,v=!0,w=!0,x=8,b=8,C="hexel-art",P=new l.Grid(1<<x,1<<b,l.Orientation.PointyTop),T=new l.Layout(P),S=new l.Projection(T.bounds,1,Math.max(P.rows,P.cols)),M=[u.Mesh.polygon(3),u.Mesh.square(),u.Mesh.diamond(),u.Mesh.polygon(5),u.Mesh.polygon(6),u.Mesh.star5(),u.Mesh.heart(),u.Mesh.flower(),u.Mesh.bat()],R=new l.Renderer(d,T,S,u.PackedMeshInfo.fromMeshes(M)),A=new l.Surface(f,R),I=document.getElementById("offscreen-canvas"),_=I.getContext("2d");I.width=P.cols,I.height=P.rows;var F={handleDragAction:function(t,i){switch(i){case 0:this.previous=A.screenToClip(t);break;case 1:var e=A.screenToClip(t),o=u.Vec2.fromPointToPoint(e,this.previous);R.projection.panByVector(o),R.needToRender=!0,this.previous.x=e.x+o.x,this.previous.y=e.y+o.y}}},E={handleDragAction:function(t,i){switch(i){case 0:var e=A.screenToClip(t),o=T.clipToCube(e);o.round();var n=T.indexOfHexel(e);-1!==n&&(T.setRange(o,g,m),R.applyColorChanges()),this.previous=o;case 1:var r=T.clipToCube(A.screenToClip(t));r.round();var s=r.distanceToCube(this.previous);s>0&&(-1==m?T.eraseStroke(this.previous,r,g):T.addStroke(this.previous,r,g,m),R.applyColorChanges(),this.previous=r)}}},L={handleDragAction:function(t,i){switch(i){case 0:if(R.needToRender)return;var e=A.screenToClip(t),o=T.indexOfHexel(e);-1!==o&&(-1==m?T.floodFillErase(o):T.floodFill(o,m),R.applyColorChanges())}}},k={handleDragAction:function(t,i){switch(i){case 0:case 1:var e=A.screenToClip(t),n=T.indexOfHexel(e);-1!=n&&(m=T.getColor(n),X=Y=(255&m)/255,$("#color-picker").spectrum("set",u.rgbaToString(m)),R.color=m);break;case 2:o(U,V)}}},q={handleDragAction:function(t,i){switch(i){case 0:this.start=A.screenToClip(t);break;case 1:if(R.needToRender)return;var e=A.screenToClip(t);R.line=u.Line.fromPointToPoint(this.start,e),R.needToRender=!0;break;case 2:case 3:R.line&&(-1==m?T.eraseLine(R.line,R.lineThickness):T.addLine(R.line,R.lineThickness,m),R.line=null,R.applyColorChanges())}}},B={handleDragAction:function(t,i){switch(i){case 0:this.start=A.screenToClip(t);break;case 1:if(R.needToRender)return;var e=A.screenToClip(t),o=u.Rect.fromPointToPoint(this.start,e);v&&o.expandToSquare(),R.ellipse=o,R.needToRender=!0;break;case 2:case 3:if(R.ellipse){var n=u.Ellipse.fromRect(R.ellipse);-1==m?T.eraseShape(n):T.addShape(n,m),R.ellipse=null,R.applyColorChanges()}}}},D={handleDragAction:function(t,i){switch(i){case 0:this.start=A.screenToClip(t);break;case 1:if(R.needToRender)return;R.shape||(R.shape=new u.Shape(N));var e=A.screenToClip(t);if(v)R.shape.stretchAcrossLine(this.start,e);else{var o=this.start,n=e,r=u.Rect.fromLBRT(n.x,n.y,o.x,o.y);R.shape.fitInRect(r,2)}R.needToRender=!0;break;case 2:case 3:R.shape&&(-1==m?T.eraseShape(R.shape):T.addShape(R.shape,m),R.shape=null,R.applyColorChanges())}}},z=E,O="#brush",U=z,V="#brush",N=M[0],H="icon-circle";n(),f.addEventListener("DOMMouseScroll",r,!1),f.addEventListener("mousewheel",r,!1);var j=1;u.addDragListener(f,function(t,i){switch(0==i&&t instanceof MouseEvent&&(t.altKey&&(m=u.randomRgba(255*X>>0),$("#color-picker").spectrum("set",u.rgbaToString(m)),R.color=m),j=t.which),j){case 1:z.handleDragAction(t,i);break;case 2:F.handleDragAction(t,i);break;case 3:return}});var X=1,Y=1;R.color=m,$("#color-picker").spectrum({color:"#008000",flat:!1,showInput:!1,showInitial:!1,allowEmpty:!1,showAlpha:!0,disabled:!1,showPalette:!0,showPaletteOnly:!0,togglePaletteOnly:!0,showSelectionPalette:!1,clickoutFiresChange:!0,hideAfterPaletteSelect:!0,preferredFormat:"rgb",palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(t){if(t){X=Y,t.setAlpha(X);var i=t.toHex8String();$(this).spectrum("set",i),m=u.stringToRgba(i),R.color=m}else m=-1,R.color=255},hide:function(t){Y=X}}),$("#color-picker").on("dragstop.spectrum",function(t,i){Y=i.getAlpha()}),$("#brush").click(function(){o(E,"#brush")}),$("#line").click(function(){o(q,"#line")}),$("#color-sampler").click(function(){o(k,"#color-sampler")}),$("#paint-bucket").click(function(){o(L,"#paint-bucket")}),$("#shape").click(function(){$(this).children("i").hasClass("icon-circle")?o(B,"#shape"):o(D,"#shape")}),$("#circle").click(function(){z=B;var t="icon-circle";$("#shape").children("i").removeClass(H).addClass(t),H=t});for(var G=["triangle","square","diamond","pentagon","hexagon","star","heart","flower","bat"],W=function(t){$("#"+G[t]).click(function(){z=D,N=M[t];var i="icon-"+G[t];$("#shape").children("i").removeClass(H).addClass(i),H=i})},Z=0;Z<G.length;Z++)W(Z);R.lineThickness=1.5,$("#options").click(function(){vex.dialog.open({message:"Options",input:'\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n        <label for="enableShadows">Enable shadows:</label>\n        <input name="enableShadows" type="checkbox" '+(w?"checked":"")+'/>\n    </div>\n</div>\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n        <label for="maintainAspect">Maintain shape ratios:</label>\n        <input name="maintainAspect" type="checkbox" '+(v?"checked":"")+'/>\n    </div>\n</div>\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n        <label for="brushRadius">Brush radius:</label>\n        <input name="brushRadius" type="number" min="0" max="15"/>\n    </div>\n</div>\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n        <label for="lineThickness">Line width:</label>\n        <input name="lineThickness" type="number" min="1" max="100" />\n    </div>\n</div>\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n          <label for="gridWidth">Grid width:</label>\n          <input name="gridWidth" type="number" min="5" max="10" />\n    </div>\n</div>\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n          <label for="gridHeight">Grid height:</label>\n          <input name="gridHeight" type="number" min="5" max="10" />\n    </div>\n</div>\n',callback:function(t){if(t){if(t.brushRadius!==g&&(g=parseInt(t.brushRadius)),t.lineThickness!==y&&(y=parseInt(t.lineThickness),R.lineThickness=1.5*y),t.gridWidth!=x||t.gridHeight!=b){x=parseInt(t.gridWidth),b=parseInt(t.gridHeight);for(var i=I.width=1<<x,e=I.height=1<<b,o=new Uint32Array(T.hexels.buffer),n=new Uint32Array(i*e),r=Math.min(e,P.rows),s=Math.min(i,P.cols),h=0;r>h;h++)for(var a=0;s>a;a++)n[h*i+a]=o[h*P.cols+a];P=new l.Grid(i,e),T=new l.Layout(P,n.buffer),S=new l.Projection(T.bounds,1,Math.max(P.rows,P.cols)),S.fillViewport(f.clientWidth,f.clientHeight),R.projection=S,R.layout=T,R.applyLayoutChanges()}v=t.maintainAspect?!0:!1,t.enableShadows?w||(R.enableShadows(),w=!0):w&&(R.disableShadows(),w=!1)}}}),$("input[name=brushRadius]").slider({min:0,max:15,step:1,value:g,tooltip:"show"}),$("input[name=lineThickness]").slider({min:1,max:100,step:1,value:y,tooltip:"show"}),$("input[name=gridWidth]").slider({ticks:[5,6,7,8,9,10],ticks_labels:["32","64","128","256","512","1024"],min:5,max:10,step:1,value:s(P.cols),tooltip:"hide"}),$("input[name=gridHeight]").slider({ticks:[5,6,7,8,9,10],ticks_labels:["32","64","128","256","512","1024"],min:5,max:10,step:1,value:s(P.rows),tooltip:"hide"})}),$("#upload").click(function(){var t;vex.dialog.open({message:"Upload image onto this "+P.cols+"x"+P.rows+" grid.",input:'\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n        <label for="imagefile">Image:</label>\n        <input name="imagefile" type="file" accept="image/*" required>\n    </div>\n    <div class="vex-custom-input-wrapper">\n        <label for="x">X (hexels from left):</label>\n        <input name="x" type="number" min="0" max="'+P.cols+'">\n    </div>\n    <div class="vex-custom-input-wrapper">\n        <label for="y">Y (hexels from top):</label>\n        <input name="y" type="number" min="0" max="'+P.rows+'">\n    </div>\n    <div class="vex-custom-input-wrapper">\n        <label for="width">Width (in hexels):</label>\n        <input name="width" type="number" min="0">\n    </div>\n    <div class="vex-custom-input-wrapper">\n        <label for="height">Height (in hexels):</label>\n        <input name="height" type="number" min="0">\n    </div>\n</div>\n',callback:function(i){if(t&&i){var e=i.x,o=i.y,n=i.width,r=i.height;a(I,_,t,e,o,n,r),c(I,_,T)}t=null}}),$("input[name=imagefile]").change(function(i){if(i.target.files[0]){var e=i.target.files[0];h(e,function(i){var e=I.width/i.width,o=I.height/i.height,n=Math.min(e,o),r=Math.round(i.width*n),s=Math.round(i.height*n),h=Math.round((I.width-r)/2),a=Math.round((I.height-s)/2);$("input[name=x]").val(h),$("input[name=y]").val(a),$("input[name=width]").val(r),$("input[name=height]").val(s),t=i})}})}),$("#download").click(function(){vex.dialog.open({message:"Download hexel art as a "+P.cols+"x"+P.rows+" image file.",input:'\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n        <label for="filename">Filename:</label>\n        <input name="filename" type="text" value="'+C+'"/>\n    </div>\n</div>\n<p> Note: an image viewer will interpret the file as pixel art, but if you reupload the file to this app, you will be able to view and modify the original hexel art.</p>\n',callback:function(t){t&&t.filename&&(C=t.filename,p(T,I,_),I.toBlob(function(t){saveAs(t,C,!0)},"image/png"))}})})},{"./graphics2d":1,"./hexel":2}]},{},[3]);