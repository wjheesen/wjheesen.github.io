(function e(n,t,i){function r(u,e){var s,h,o;if(!t[u]){if(!n[u]){if(s=typeof require=="function"&&require,!e&&s)return s(u,!0);if(f)return f(u,!0);h=new Error("Cannot find module '"+u+"'");throw h.code="MODULE_NOT_FOUND",h;}o=t[u]={exports:{}};n[u][0].call(o.exports,function(t){var i=n[u][1][t];return r(i?i:t)},o,o.exports,e,n,t,i)}return t[u].exports}for(var f=typeof require=="function"&&require,u=0;u<i.length;u++)r(i[u]);return r})({1:[function(n,t,i){"use strict";function s(n,t){return Math.floor(Math.random()*(t-n+1))+n}function p(n){n===void 0&&(n=255);var t=s(0,255)<<24,i=s(0,255)<<16,r=s(0,255)<<8;return(t|i|r|n)>>>0}function w(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n),i=parseInt(t[2],16)<<24,r=parseInt(t[3],16)<<16,u=parseInt(t[4],16)<<8,f=parseInt(t[1],16);return(i|r|u|f)>>>0}function b(n){var t=h((n>>24&255).toString(16)),i=h((n>>16&255).toString(16)),r=h((n>>8&255).toString(16)),u=h((n&255).toString(16));return"#"+u+t+i+r}function h(n){return n.length==1?"0"+n:n}function k(n){var t=n>>24&255,i=n>>16&255,r=n>>8&255,u=n>>0&255;console.log("{r: "+t+", g: "+i+", b: "+r+", a: "+u+"}")}function d(n,t){var f=n>>24&255,e=n>>16&255,o=n>>8&255,u=n>>0&255,s=t>>24&255,h=t>>16&255,c=t>>8&255,i=u+1,r=256-u,l=i*f+r*s>>8,a=i*e+r*h>>8,v=i*o+r*c>>8;return(l<<24|a<<16|v<<8|255)>>>0}function g(n,t,i){return i<n?n:i>t?t:i}var r=function(){function n(n,t){n===void 0&&(n=0);t===void 0&&(t=0);this.x=n;this.y=t}return n.fromPoint=function(t){return new n(t.x,t.y)},n.between=function(t,i){var r=.5*(t.x+i.x),u=.5*(t.y+i.y);return new n(r,u)},n.prototype.distanceToOrigin=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.distanceToPoint=function(n){var t=this.x-n.x,i=this.y-n.y,r=t*t+i*i;return Math.sqrt(r)},n.prototype.set=function(n,t){this.x=n;this.y=t},n.prototype.setPoint=function(n){this.x=n.x;this.y=n.y},n.prototype.offset=function(n,t){this.x+=n;this.y+=t},n.prototype.log=function(){console.log(this.toString())},n.prototype.toString=function(){return"{x: "+this.x+", y: "+this.y+"}"},n.prototype.equals=function(n){return this.x==n.x&&this.y==n.y},n}(),u,o,l,a,e,f,c,v,y;i.Point=r;u=function(){function n(n,t){n===void 0&&(n=0);t===void 0&&(t=0);this.x=n;this.y=t}return n.fromVec2=function(t){return new n(t.x,t.y)},n.fromPointToPoint=function(t,i){return new n(i.x-t.x,i.y-t.y)},n.prototype.isZero=function(){return this.x==0&&this.y==0},n.prototype.length=function(){return Math.sqrt(this.length2())},n.prototype.length2=function(){return this.x*this.x+this.y*this.y},n.prototype.set=function(n,t){this.x=n;this.y=t},n.prototype.setVec2=function(n){this.x=n.x;this.y=n.y},n.prototype.normalize=function(){this.divScalar(this.length())},n.prototype.rotateLeft=function(){n=[-this.y,this.x];this.x=n[0];this.y=n[1];var n},n.prototype.rotateRight=function(){n=[this.y,-this.x];this.x=n[0];this.y=n[1];var n},n.prototype.mulScalar=function(n){this.x*=n;this.y*=n},n.prototype.divScalar=function(n){this.x/=n;this.y/=n},n.prototype.add=function(n){this.x+=n.x;this.y+=n.y},n.prototype.subtract=function(n){this.x-=n.x;this.y-=n.y},n.prototype.multiply=function(n){this.x*=n.x;this.y*=n.y},n.prototype.divide=function(n){this.x/=n.x;this.y/=n.y},n.prototype.dot=function(n){return this.x*n.x+this.y*n.y},n.prototype.cross=function(n){return this.x*n.y-this.y*n.x},n.prototype.negate=function(){this.x=-this.x;this.y=-this.y},n.prototype.log=function(){console.log(this.toString())},n.prototype.toString=function(){return"{x: "+this.x+", y: "+this.y+" len: "+this.length()+"}"},n.prototype.equals=function(n){return this.x==n.x&&this.y==n.y},n}();i.Vec2=u;o=function(){function n(n,t,i,r){n===void 0&&(n=0);t===void 0&&(t=0);i===void 0&&(i=0);r===void 0&&(r=0);this.left=n;this.top=t;this.right=i;this.bottom=r}return n.fromRect=function(t){return new n(t.left,t.top,t.right,t.bottom)},n.fromLBRT=function(t,i,r,u){return new n(t,u,r,i)},n.fromLRBT=function(t,i,r,u){return new n(t,u,i,r)},n.fromPointToPoint=function(t,i){var r=new n(t.x,t.y,t.x,t.y);return r.unionPoint(i),r},n.fromUnion=function(t,i,r){var u=new n(0,0,0,0);return u.setUnion(t,i,r),u},n.fromIntersection=function(t,i){var r=n.fromRect(t);return r.intersectRect(i),r},n.fromDimensions=function(t,i,r,u){return new n(t,i+u,t+r,i)},n.prototype.isEmpty=function(){this.left>=this.right||this.bottom>=this.top},n.prototype.isValid=function(){return this.right>=this.left&&this.top>=this.bottom},n.prototype.width=function(){return this.right-this.left},n.prototype.height=function(){return this.top-this.bottom},n.prototype.area=function(){return this.width()*this.height()},n.prototype.center=function(){return new r(this.centerX(),this.centerY())},n.prototype.centerX=function(){return.5*(this.left+this.right)},n.prototype.centerY=function(){return.5*(this.bottom+this.top)},n.prototype.bottomLeft=function(){return new r(this.left,this.bottom)},n.prototype.bottomRight=function(){return new r(this.right,this.bottom)},n.prototype.topLeft=function(){return new r(this.left,this.top)},n.prototype.topRight=function(){return new r(this.right,this.top)},n.prototype.pointAt=function(n,t,i){return i===void 0&&(i=new r),i.x=this.left+n*this.width(),i.y=this.bottom+t*this.height(),i},n.prototype.vertices=function(){var n=new Float32Array(8);return n[0]=this.left,n[1]=this.top,n[2]=this.left,n[3]=this.bottom,n[4]=this.right,n[5]=this.bottom,n[6]=this.right,n[7]=this.top,n},n.prototype.setRect=function(n){this.left=n.left;this.top=n.top;this.right=n.right;this.bottom=n.bottom},n.prototype.setLTRB=function(n,t,i,r){this.left=n;this.top=t;this.right=i;this.bottom=r},n.prototype.setLBRT=function(n,t,i,r){this.left=n;this.top=r;this.right=i;this.bottom=t},n.prototype.setLRBT=function(n,t,i,r){this.left=n;this.top=r;this.right=t;this.bottom=i},n.prototype.setEmpty=function(){this.left=0;this.top=0;this.right=0;this.bottom=0},n.prototype.setUnion=function(n,t,i){this.left=this.right=n[t++];this.top=this.bottom=n[t++];this.unionPoints(n,t,i-1)},n.prototype.contains=function(n,t){return this.left<=n&&n<=this.right&&this.bottom<=t&&t<=this.top},n.prototype.containsPoint=function(n){return this.contains(n.x,n.y)},n.prototype.containsRect=function(n){return this.left<=n.left&&n.right<=this.right&&this.bottom<=n.bottom&&n.top<=this.top},n.prototype.intersectRect=function(n){this.left=Math.max(this.left,n.left);this.right=Math.min(this.right,n.right);this.bottom=Math.max(this.bottom,n.bottom);this.top=Math.min(this.top,n.top)},n.prototype.intersectsRect=function(n){return this.right>=n.left&&n.right>=this.left&&this.top>=n.bottom&&n.top>=this.bottom},n.prototype.intersectsRectByPercent=function(t,i){var r=n.fromIntersection(this,t);return r.isValid()&&r.area()/t.area()>=i},n.prototype.union=function(n,t){this.left=Math.min(n,this.left);this.top=Math.max(t,this.top);this.right=Math.max(n,this.right);this.bottom=Math.min(t,this.bottom)},n.prototype.unionPoint=function(n){this.union(n.x,n.y)},n.prototype.unionPoints=function(n,t,i){for(var r=0;r<i;r++)this.union(n[t++],n[t++])},n.prototype.unionRect=function(n){this.left=Math.min(this.left,n.left);this.right=Math.max(this.right,n.right);this.bottom=Math.min(this.bottom,n.bottom);this.top=Math.max(this.top,n.top)},n.prototype.inset=function(n,t){this.left+=n;this.top-=t;this.right-=n;this.bottom+=t},n.prototype.offset=function(n,t){this.left+=n;this.top+=t;this.right+=n;this.bottom+=t},n.prototype.mulScalar=function(n){this.left*=n;this.top*=n;this.right*=n;this.bottom*=n},n.prototype.divScalar=function(n){this.left/=n;this.top/=n;this.right/=n;this.bottom/=n},n.prototype.scale=function(n,t){var i=this.centerX(),r=this.centerY();this.offset(-i,-r);this.left*=n;this.right*=n;this.bottom*=t;this.top*=t;this.offset(i,r)},n.prototype.stretch=function(n){this.scale(n,n)},n.prototype.shrinkToSquare=function(){var n=this.width(),t=this.height();t>n?this.scale(1,n/t):n>t&&this.scale(t/n,1)},n.prototype.expandToSquare=function(){var n=this.width(),t=this.height();t>n?this.scale(t/n,1):n>t&&this.scale(1,n/t)},n.prototype.sort=function(){var n,t;this.bottom>this.top&&(n=this.top,this.top=this.bottom,this.bottom=n);this.left>this.right&&(t=this.right,this.right=this.left,this.left=t)},n.prototype.log=function(){console.log(this.toString())},n.prototype.toString=function(){return"{bottom: "+this.bottom+", left: "+this.left+", width: "+this.width()+", height: "+this.height()+", isValid: "+this.isValid()+"}"},n.prototype.equals=function(n){return this.left==n.left&&this.top==n.top&&this.right==n.right&&this.bottom==n.bottom},n}();i.Rect=o;l=function(){function n(n,t,i,r){n===void 0&&(n=1);t===void 0&&(t=1);i===void 0&&(i=0);r===void 0&&(r=0);this.rx=n;this.ry=t;this.cx=i;this.cy=r}return n.fromRect=function(t){var i=t.width()/2,r=t.height()/2,u=t.centerX(),f=t.centerY();return new n(i,r,u,f)},n.fromEllipse=function(t){return new n(t.rx,t.ry,t.cx,t.cy)},n.prototype.contains=function(n,t){var u=this.cx-n,f=this.cy-t,i=u/this.rx,r=f/this.ry;return i*i+r*r<=1},n.prototype.containsPoint=function(n){return this.contains(n.x,n.y)},n}();i.Ellipse=l;a=function(){function n(n,t,i,r){this.x1=n;this.y1=t;this.x2=i;this.y2=r}return n.fromLine=function(t){return new n(t.x1,t.y1,t.x2,t.y2)},n.fromPointToPoint=function(t,i){return new n(t.x,t.y,i.x,i.y)},n.prototype.contains=function(n,t,i){var e=new r(this.x1,this.y1),o=new u(this.x2-this.x1,this.y2-this.y1),f=-1,l=new u(n-e.x,t-e.y),a=o.dot(l),s=o.length2();if(s!=0&&(f=a/s),f<0||f>1)return!1;var v=e.x+f*o.x,y=e.y+f*o.y,h=n-v,c=t-y,p=h*h+c*c;return p<i*i/4},n.prototype.containsPoint=function(n,t){return this.contains(n.x,n.y,t)},n}();i.Line=a;e=function(){function n(n,t,i,r,u,f){n===void 0&&(n=0);t===void 0&&(t=0);i===void 0&&(i=0);r===void 0&&(r=0);u===void 0&&(u=0);f===void 0&&(f=0);this.m11=n;this.m12=t;this.m13=i;this.m21=r;this.m22=u;this.m23=f}return n.test=function(){console.log("Matrix test");var e=new r(50,50),i=new r(100,0),u=new r(0,100),f=n.stretchRotateFromPointToPoint(i,u,e.x,e.y),t=new r;f.mapPoint(i,t);console.log("end:"+u);console.log("end?"+t);f.invert();f.mapPoint(u,t);console.log("start:"+i);console.log("start?"+t);console.log("End test")},n.fromMatrix=function(t){return new n(t.m11,t.m12,t.m13,t.m21,t.m22,t.m23)},n.from2x2=function(t,i,r,u){return new n(t,i,0,r,u,0)},n.identity=function(){return new n(1,0,0,0,1,0)},n.rectToRect=function(t,i,r){var u=new n;return u.setRectToRect(t,i,r),u},n.rotateByAngle=function(t,i,r){i===void 0&&(i=0);r===void 0&&(r=0);var u=Math.sin(t),f=Math.cos(t);return n.rotateBySinCos(u,f,i,r)},n.rotateBySinCos=function(t,i,r,u){r===void 0&&(r=0);u===void 0&&(u=0);var f=new n;return f.setSinCos(t,i),f.preTranslate(-r,-u),f.postTranslate(r,u),f},n.rotateFromPointToPoint=function(t,i,f,e){var c,l;f===void 0&&(f=0);e===void 0&&(e=0);var h=new r(f,e),o=u.fromPointToPoint(h,t),s=u.fromPointToPoint(h,i);return o.normalize(),s.normalize(),c=o.cross(s),l=o.dot(s),n.rotateBySinCos(c,l,f,e)},n.scale=function(t,i,r,u){r===void 0&&(r=0);u===void 0&&(u=0);var f=new n;return f.setScale(t,i),f.preTranslate(-r,-u),f.postTranslate(r,u),f},n.scaleFromPointToPoint=function(t,i,r,u){r===void 0&&(r=0);u===void 0&&(u=0);var f=(i.x-r)/(t.x-r),e=(i.y-u)/(t.y-u);return n.scale(f,e,r,u)},n.stretch=function(t,i,r){return n.scale(t,t,i,r)},n.stretchFromPointToPoint=function(t,i,f,e){f===void 0&&(f=0);e===void 0&&(e=0);var o=new r(f,e),s=u.fromPointToPoint(o,t).length(),h=u.fromPointToPoint(o,i).length(),c=h/s;return n.stretch(c,f,e)},n.stretchRotateFromPointToPoint=function(t,i,f,e){f===void 0&&(f=0);e===void 0&&(e=0);var c=new r(f,e),s=u.fromPointToPoint(c,t),h=u.fromPointToPoint(c,i),l=s.length(),a=h.length(),v=a/l;s.mulScalar(1/l);h.mulScalar(1/a);var y=s.cross(h),p=s.dot(h),o=new n;return o.setSinCos(y,p),o.postStretch(v),o.preTranslate(-f,-e),o.postTranslate(f,e),o},n.translate=function(t,i){return new n(1,0,t,0,1,i)},n.translateFromPointToPoint=function(t,i){return n.translate(i.x-t.x,i.y-t.y)},n.concat=function(t,i){var r=new n;return r.setConcat(t,i),r},n.prototype.determinant=function(){return this.m11*this.m22-this.m12*this.m21},n.prototype.inverse=function(){var t=new n;return t.setInverse(this),t},n.prototype.invert=function(){this.setInverse(this)},n.prototype.postConcat=function(n){this.setConcat(n,this)},n.prototype.preConcat=function(n){this.setConcat(this,n)},n.prototype.postRotate=function(n){var t=Math.cos(n),i=Math.sin(n),r=this.m11,u=this.m12,f=this.m13;this.m11=i*r-t*this.m21;this.m12=i*u-t*this.m22;this.m13=i*f-t*this.m23;this.m21=t*r+i*this.m21;this.m22=t*u+i*this.m22;this.m23=t*f+t*this.m23},n.prototype.preRotate=function(n){var t=Math.cos(n),i=Math.sin(n),r=this.m11,u=this.m21;this.m11=r*i+this.m12*t;this.m21=u*i+this.m22*t;this.m12=r*-t+this.m12*i;this.m22=u*-t+this.m22*i},n.prototype.postScale=function(n,t){this.m11*=n;this.m12*=n;this.m13*=n;this.m21*=t;this.m22*=t;this.m23*=t},n.prototype.preScale=function(n,t){this.m11*=n;this.m21*=n;this.m12*=t;this.m22*=t},n.prototype.postStretch=function(n){this.postScale(n,n)},n.prototype.preStretch=function(n){this.preScale(n,n)},n.prototype.postTranslate=function(n,t){this.m13+=n;this.m23+=t},n.prototype.preTranslate=function(n,t){this.m13+=this.m11*n+this.m12*t;this.m23+=this.m21*n+this.m22*t},n.prototype.set=function(n,t,i,r,u,f){this.m11=n;this.m12=t;this.m13=i;this.m21=r;this.m22=u;this.m23=f},n.prototype.setMatrix=function(n){this.m11=n.m11;this.m12=n.m12;this.m13=n.m13;this.m21=n.m21;this.m22=n.m22;this.m23=n.m23},n.prototype.setConcat=function(n,t){this.set(n.m11*t.m11+n.m12*t.m21,n.m11*t.m12+n.m12*t.m22,n.m11*t.m13+n.m12*t.m23+n.m13,n.m21*t.m11+n.m22*t.m21,n.m21*t.m12+n.m22*t.m22,n.m21*t.m13+n.m22*t.m23+n.m23)},n.prototype.setIdentity=function(){this.m11=1;this.m12=0;this.m13=0;this.m21=0;this.m22=1;this.m23=0},n.prototype.setInverse=function(n){var t=1/n.determinant(),i=n.m22*t,r=-n.m12*t,u=(n.m12*n.m23-n.m13*n.m22)*t,f=-n.m21*t,e=n.m11*t,o=(n.m21*n.m13-n.m11*n.m23)*t;this.set(i,r,u,f,e,o)},n.prototype.setRectToRect=function(n,t,i){var r,u,f,e;switch(i){case 0:r=n.center();u=t.center();break;case 1:r=n.bottomRight();u=t.bottomRight();break;default:r=n.topLeft();u=t.topLeft()}f=t.width()/n.width();e=t.height()/n.height();this.setTranslate(-r.x,-r.y);i===2?this.postScale(f,e):this.postStretch(Math.min(f,e));this.postTranslate(u.x,u.y)},n.prototype.setRotate=function(n){var t=Math.sin(n),i=Math.cos(n);this.setSinCos(t,i)},n.prototype.setSinCos=function(n,t){this.m11=t;this.m12=-n;this.m13=0;this.m21=n;this.m22=t;this.m23=0},n.prototype.setScale=function(n,t){this.m11=n;this.m12=0;this.m13=0;this.m21=0;this.m22=t;this.m23=0},n.prototype.setStretch=function(n){this.setScale(n,n)},n.prototype.setTranslate=function(n,t){this.m11=1;this.m12=0;this.m13=n;this.m21=0;this.m22=1;this.m23=t},n.prototype.mapX=function(n,t){return this.m11*n+this.m12*t+this.m13},n.prototype.mapY=function(n,t){return this.m21*n+this.m22*t+this.m23},n.prototype.map=function(n,t,i){return i===void 0&&(i=new r),i.x=this.mapX(n,t),i.y=this.mapY(n,t),i},n.prototype.mapPoint=function(n,t){return t===void 0&&(t=new r),this.map(n.x,n.y,t)},n.prototype.mapPoints=function(n,t,i,r,u){var f,e,o;for(r===void 0&&(r=n),u===void 0&&(u=t),f=0;f<i;f++)e=n[t++],o=n[t++],r[u++]=this.mapX(e,o),r[u++]=this.mapY(e,o)},n.prototype.mapRect=function(n,t){t===void 0&&(t=new o);var i=n.topLeft(),r=n.bottomLeft(),u=n.bottomRight(),f=n.topRight();return this.mapPoint(i,i),this.mapPoint(r,r),this.mapPoint(u,u),this.mapPoint(f,f),t.left=t.right=i.x,t.top=t.bottom=i.y,t.unionPoint(r),t.unionPoint(u),t.unionPoint(f),t},n.prototype.log=function(){console.log(this.toString())},n.prototype.toString=function(){return"m11: "+this.m11+", m12: "+this.m12+", m13: "+this.m13+", m21: "+this.m21+", m22: "+this.m22+", m23: "+this.m23},n.prototype.equals=function(n){this.m11==n.m11&&this.m12==n.m12&&this.m13==n.m13&&this.m21==n.m21&&this.m22==n.m22&&this.m23==n.m23},n}();i.Matrix=e;f=function(){function n(n,t){t===void 0&&(t=0);this._data=n;this._size=t;this._capacity=n.length/2}return n.fromPath=function(t){return new n(new Float32Array(t._data),t._size)},n.withCapacity=function(t){return new n(new Float32Array(t*2))},Object.defineProperty(n.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),n.prototype.pointAt=function(n){var t=n*2,i=this._data[t],u=this._data[t+1];return new r(i,u)},n.prototype.xAt=function(n){return this._data[n*2]},n.prototype.yAt=function(n){return this._data[n*2+1]},n.prototype.pointBetween=function(n,t){return r.between(this.pointAt(n),this.pointAt(t))},n.prototype.forEach=function(n,t,i){var r,u;for(t===void 0&&(t=0),i===void 0&&(i=this._size),r=2*t,u=0;u<i;u++)n(this._data[r++],this._data[r++],t++)},n.prototype.forEachEdge=function(n,t,i){t===void 0&&(t=0);i===void 0&&(i=this._size);for(var r=this._data,u=2*t,f=2*(t+i),s=r[f-2],h=r[f-1],e=0,o=0;u<f;)e=r[u++],o=r[u++],n(s,h,e,o),s=e,h=o},n.prototype.put=function(n,t){this.set(this._size++,n,t)},n.prototype.putPoint=function(n){this.setPoint(this._size++,n)},n.prototype.putPath=function(n){this.putData(n._data,0,n._size)},n.prototype.putData=function(n,t,i){this.setData(this._size,n,t,i);this._size+=i},n.prototype.set=function(n,t,i){var r=n*2;this._data[r]=t;this._data[r+1]=i},n.prototype.setPoint=function(n,t){this.set(n,t.x,t.y)},n.prototype.setPath=function(n,t){this.setData(n,t._data,0,t._size)},n.prototype.setData=function(n,t,i,r){for(var u=n*2,f=0;f<r;f++)this._data[u++]=t[i++],this._data[u++]=t[i++]},n.prototype.calculateBounds=function(n,t){return n===void 0&&(n=0),t===void 0&&(t=this._size),o.fromUnion(this._data,n*2,t)},n.prototype.contains=function(n,t,i,r){i===void 0&&(i=0);r===void 0&&(r=this._size);var u=!1;return this.forEachEdge(function(i,r,f,e){r>t!=e>t&&n<(f-i)*(t-r)/(e-r)+i&&(u=!u)},i,r),u},n.prototype.containsPoint=function(n,t,i){return t===void 0&&(t=0),i===void 0&&(i=this._size),this.contains(n.x,n.y,t,i)},n.prototype.offset=function(n,t,i,r){var u,f;for(i===void 0&&(i=0),r===void 0&&(r=this.size),u=i*2,f=0;f<=r;f++)this._data[u++]+=n,this._data[u++]+=t},n.prototype.transform=function(n,t,i){t===void 0&&(t=0);i===void 0&&(i=this.size);n.mapPoints(this._data,t*2,i,this._data,t*2)},n.prototype.log=function(){console.log(this.toString())},n.prototype.toString=function(){return"{capacity: "+this._capacity+", count: "+this._size+", data: "+this._data+"}"},n.prototype.logData=function(){var n="";this.forEach(function(t,i){n+=t+", "+i+" "});console.log(n)},n}();i.Path=f;c=function(){function n(n,t,i,r){this.vertices=n;this.indices=t;this.bounds=n.calculateBounds();this.fixedPoint=i;this.controlPoint=r}return n.polygon=function(t){var i=n.generatePolygonVertices(t),u=n.generatePolygonIndices(t),f=i.pointAt(0),r=t>>1,e=t&1?i.pointBetween(r,r+1):i.pointAt(r);return new n(i,u,f,e)},n.generatePolygonVertices=function(n){var t=f.withCapacity(n),i=new r(0,100),u;for(t.putPoint(i),u=e.rotateByAngle(2*Math.PI/n);t.size<t.capacity;)u.mapPoint(i,i),t.putPoint(i);return t},n.generatePolygonIndices=function(n){for(var t=new Uint16Array(3*(n-2)),i=0,r=1,u=2;i<t.length;r=u++)t[i++]=0,t[i++]=r,t[i++]=u;return t},n.star=function(t,i,r){var u=n.generateStarVertices(t,i,r),f=n.generateStarIndices(t),e=u.pointAt(0),o=t&1?u.pointBetween(t-1,t+1):u.pointAt(t);return new n(u,f,e,o)},n.generateStarVertices=function(n,t,i){var u=f.withCapacity(n+n),c=2*Math.PI/n,s=new e,h=new r(0,i*100),o;for(u.putPoint(h),o=new r(0,t*100),s.setRotate(.5*c),s.mapPoint(o,o),u.putPoint(o),s.setRotate(c);u.size<u.capacity;)s.mapPoint(h,h),s.mapPoint(o,o),u.putPoint(h),u.putPoint(o);return u},n.generateStarIndices=function(n){for(var f=3*(n-2),o=3*n,t=new Uint16Array(f+o),i=0,u=3,r=5;i<f;u=r++,r++)t[i++]=1,t[i++]=u,t[i++]=r;for(var e=2*n-1,u=0,r=1;i<t.length;e=r++,u=r++)t[i++]=e,t[i++]=u,t[i++]=r;return t},n.diamond=function(){return n.star(2,.5,1)},n.square=function(){var t=f.withCapacity(10);t.put(-100,100);t.put(-100,-100);t.put(100,-100);t.put(100,100);var i=n.generatePolygonIndices(4),u=new r(0,100),e=new r(0,-100);return new n(t,i,u,e)},n.star5=function(){return n.star(5,.4,1)},n.bat=function(){var t=f.withCapacity(20);t.put(0,3);t.put(-2,5);t.put(-3,2);t.put(-5,0);t.put(-8,3);t.put(-10,7);t.put(-17,10);t.put(-13,5);t.put(-12,-1);t.put(-3,-7);t.put(0,-10);t.put(3,-7);t.put(12,-1);t.put(13,5);t.put(17,10);t.put(10,7);t.put(8,3);t.put(5,0);t.put(3,2);t.put(2,5);var i=new Uint16Array([0,1,2,0,2,3,0,3,9,0,9,10,0,10,11,0,11,17,0,17,18,0,18,19,4,5,6,4,6,7,4,7,8,4,8,9,4,9,3,16,14,15,16,13,14,16,12,13,16,11,12,16,17,11]),r=t.pointBetween(1,19),u=t.pointAt(10);return new n(t,i,r,u)},n.heart=function(){var t=f.withCapacity(10);t.put(0,12);t.put(-3,16);t.put(-5,16);t.put(-8,12);t.put(-8,8);t.put(0,0);t.put(8,8);t.put(8,12);t.put(5,16);t.put(3,16);var i=n.generatePolygonIndices(10),r=t.pointBetween(1,9),u=t.pointAt(5);return new n(t,i,r,u)},n.flower=function(){var t=f.withCapacity(20);t.put(0,-2);t.put(-1,-1);t.put(-2,-1);t.put(-2,-2);t.put(-3,-3);t.put(-1,-3);t.put(-2,-4);t.put(-2,-5);t.put(-1,-5);t.put(0,-6);t.put(0,-4);t.put(1,-5);t.put(2,-5);t.put(2,-4);t.put(3,-3);t.put(1,-3);t.put(2,-2);t.put(2,-1);t.put(1,-1);t.put(0,0);var i=new Uint16Array([5,0,1,5,1,2,5,2,3,5,3,4,5,6,7,5,7,8,5,8,9,5,9,10,5,10,0,15,0,10,15,10,11,15,11,12,15,12,13,15,13,14,15,16,17,15,17,18,15,18,19,15,19,0]),r=t.pointAt(19),u=t.pointAt(9);return new n(t,i,r,u)},n.prototype.contains=function(n,t){return this.bounds.contains(n,t)&&this.vertices.contains(n,t)},n.prototype.containsPoint=function(n){return this.contains(n.x,n.y)},n.prototype.log=function(){console.log(this.toString())},n.prototype.toString=function(){return"vertices: "+this.vertices+", bounds: "+this.bounds+",\n                    fixedPoint: "+this.fixedPoint+", controlPoint: "+this.controlPoint},n}();i.Mesh=c;v=function(){function n(n,t,i,r){this.meshes=n;this.vertices=t;this.indices=i;this.offsets=r}return n.fromMeshes=function(t){for(var a,e,r,o=0,s=0,i=0;i<t.length;i++)o+=t[i].vertices.size,s+=t[i].indices.length;var u=f.withCapacity(o),h=new Uint16Array(s),c=new Uint16Array(t.length),l=0;for(i=0;i<t.length;i++)for(a=u.size,c[i]=l,u.putPath(t[i].vertices),e=t[i].indices,r=0;r<e.length;r++)h[l++]=e[r]+a;return new n(t,u.data,h,c)},n}();i.PackedMeshInfo=v;y=function(){function n(n){this.mesh=n;this.matrix=e.identity();this.inverse=e.identity()}return n.test=function(){console.log("Shape test");var t=c.diamond(),i=new n(t),f=new r(0,100),e=new r(0,0),u=new r,s=o.fromLRBT(0,100,0,100),h=new o;i.stretchAcrossLine(f,e);i.matrix.mapPoint(t.fixedPoint,u);console.log("start:"+f);console.log("start?"+u);i.matrix.mapPoint(t.controlPoint,u);console.log("end:"+e);console.log("end?"+u);i.fitInRect(s,2);t.vertices.transform(i.matrix);h=t.vertices.calculateBounds();console.log("rect:"+s);console.log("rect?:"+h);console.log("End test")},n.prototype.contains=function(n,t){var i=this.inverse.map(n,t);return this.mesh.containsPoint(i)},n.prototype.containsPoint=function(n){return this.contains(n.x,n.y)},n.prototype.offset=function(n,t){this.matrix.postTranslate(n,t);this.inverse.postTranslate(-n,-t)},n.prototype.transform=function(n){this.matrix.postConcat(n);this.inverse.setInverse(this.matrix)},n.prototype.fitInRect=function(n,t){this.matrix.setRectToRect(this.mesh.bounds,n,t);this.inverse.setRectToRect(n,this.mesh.bounds,t)},n.prototype.stretchAcrossLine=function(n,t){var i=u.fromPointToPoint(this.mesh.fixedPoint,n),o=n.x,s=n.y,f=r.fromPoint(this.mesh.controlPoint);f.offset(i.x,i.y);this.matrix=e.stretchRotateFromPointToPoint(f,t,o,s);this.matrix.preTranslate(i.x,i.y);this.inverse.setInverse(this.matrix)},n.prototype.log=function(){console.log(this.toString())},n.prototype.toString=function(){return"mesh: "+this.mesh.toString()+", matrix: "+this.matrix+", inverse: "+this.inverse},n}();i.Shape=y;i.randomInt=s;i.randomRgba=p;i.stringToRgba=w;i.rgbaToString=b;i.logRgba=k;i.blend=d;i.clamp=g},{}],2:[function(n,t,i){"use strict";function h(n,t,i){for(var e,o,u,r=-t;r<=t;r++)for(e=Math.max(-t,-r-t),o=Math.min(t,-r+t),u=e;u<=o;u++)i(new f(r+n.q,u+n.r))}function c(n,t,i,r){var e=f.fromCube(t),c,l,o,s,u;for(e.subtract(n),c=e.distanceToOrigin(),l=1/Math.max(c,1),o=0;o<=c;o++)s=l*o,u=f.fromCube(n),u.q+=e.q*s,u.r+=e.r*s,u.s+=e.s*s,u.round(),h(u,i,r)}var r=n("./graphics2d"),e=Math.sqrt(3),o=6,l=!1,s=twgl.primitives.createAugmentedTypedArray,u=function(){function n(n,t,i,r,u,f){t===void 0&&(t=n.inverse());this.matrix=n;this.inverse=t;this.width=i;this.height=r;this.right=u;this.up=f}return n}(),f,a,v,y,p,w;u.FlatTop=new u(r.Matrix.from2x2(3/2,0,e/2,e),r.Matrix.from2x2(2/3,0,-1/3,e/3),2,e,.5,e/2);u.PointyTop=new u(r.Matrix.from2x2(e,e/2,0,3/2),r.Matrix.from2x2(e/3,-1/3,0,2/3),e,2,e/2,.5);i.Orientation=u;f=function(){function n(n,t,i){n===void 0&&(n=0);t===void 0&&(t=0);i===void 0&&(i=-n-t);this.q=n;this.r=t;this.s=i}return n.fromCube=function(t){return new n(t.q,t.r,t.s)},n.prototype.set=function(n,t,i){i===void 0&&(i=-n-t);this.q=n;this.r=t;this.s=i},n.prototype.distanceToCube=function(n){return Math.max(Math.abs(this.q-n.q),Math.abs(this.r-n.r),Math.abs(this.s-n.s))},n.prototype.distanceToOrigin=function(){return Math.max(Math.abs(this.q),Math.abs(this.r),Math.abs(this.s))},n.prototype.neighbors=function(){for(var t=[],n=0;n<i.Directions.length;n++)t.push(this.neighbor(i.Directions[n]));return t},n.prototype.neighbor=function(t){var i=n.fromCube(this);return i.add(t),i},n.prototype.forEachNeighbor=function(n){for(var t=0;t<i.Directions.length;t++)n(this.neighbor(i.Directions[t]))},n.prototype.add=function(n){this.q+=n.q;this.r+=n.r;this.s+=n.s},n.prototype.subtract=function(n){this.q-=n.q;this.r-=n.r;this.s-=n.s},n.prototype.round=function(){var n=this.q,t=this.r,i=this.s;this.q=Math.round(n);this.r=Math.round(t);this.s=Math.round(i);var r=Math.abs(this.q-n),u=Math.abs(this.r-t),f=Math.abs(this.s-i);r>u&&r>f?this.q=-this.r-this.s:u>f?this.r=-this.q-this.s:this.s=-this.q-this.r},n.prototype.equals=function(n){return this.q===n.q&&this.r===n.r&&this.s===n.s},n.prototype.log=function(){console.log(this.toString())},n.prototype.toString=function(){return"{q: "+this.q+", r: "+this.r+" s: "+this.s+"}"},n}();i.Cube=f;i.Directions=[new f(1,-1,0),new f(1,0,-1),new f(0,1,-1),new f(-1,1,0),new f(-1,0,1),new f(0,-1,1)];a=function(){function n(n,t,i){i===void 0&&(i=u.PointyTop);this.rows=t;this.cols=n;this.size=t*n;this.orientation=i}return n.prototype.width=function(){return this.orientation===u.FlatTop?this.orientation.width*(.75*this.cols+.25):this.orientation.width*(this.cols+.5)},n.prototype.height=function(){return this.orientation===u.FlatTop?this.orientation.height*(this.rows+.5):this.orientation.height*(.75*this.rows+.25)},n.prototype.forEachCube=function(n){var r,i,e,t;if(this.orientation===u.FlatTop)for(t=0;t<this.cols;t++)for(r=t>>1,i=-r;i<this.rows-r;i++)n(new f(t,i));else for(i=0;i<this.rows;i++)for(e=i>>1,t=-e;t<this.cols-e;t++)n(new f(t,i))},n.prototype.cubeAt=function(n){var i,t;return this.orientation===u.FlatTop?(t=n/this.rows>>0,i=n%this.rows-(t>>1),new f(t,i)):(i=n/this.cols>>0,t=n%this.cols-(i>>1),new f(t,i))},n.prototype.offsetAt=function(n){var t,i;return this.orientation===u.FlatTop?(t=n/this.rows,i=n%this.rows,new r.Point(t>>0,i>>0)):(t=n%this.cols,i=n/this.cols,new r.Point(t>>0,i>>0))},n.prototype.indexOfCube=function(n){var t,i;if(this.orientation===u.FlatTop){if(0<=n.q&&n.q<this.cols&&(t=n.q>>1,-t<=n.r&&n.r<this.rows-t))return this.rows*n.q+n.r+t}else if(0<=n.r&&n.r<this.rows&&(i=n.r>>1,-i<=n.q&&n.q<this.cols-i))return this.cols*n.r+n.q+i;return-1},n.prototype.indexOfOffset=function(n){return 0<=n.x&&n.x<this.cols&&0<=n.y&&n.y<this.rows?this.orientation===u.FlatTop?this.rows*n.x+n.y:this.cols*n.y+n.x:-1},n}();i.Grid=a;v=function(){function n(n,t){t===void 0&&(t=new ArrayBuffer(n.size*4));this.grid=n;this.hexels=new DataView(t);this.bounds=r.Rect.fromLRBT(0,n.width(),0,n.height());this.hexelsPerSection=Math.min(n.size,8192);this.sections=n.size/this.hexelsPerSection}return n.prototype.sectionWidth=function(){var n=this.grid;return n.orientation==u.FlatTop?n.orientation.width*.75*n.cols/this.sections:n.orientation.width*n.cols/this.sections},n.prototype.sectionHeight=function(){var n=this.grid;return n.orientation==u.FlatTop?n.orientation.height*n.rows/this.sections:n.rows*.75*n.orientation.height/this.sections},n.prototype.generateVertices=function(){var i=this.hexelsPerSection,t=s(2,o*i,Float32Array),n=this.grid.orientation;return this.grid.orientation===u.FlatTop?this.forEachCenterVertex(function(i,r){t.push(i-n.right,r+n.up);t.push(i-1,r);t.push(i-n.right,r-n.up);t.push(i+n.right,r-n.up);t.push(i+1,r);t.push(i+n.right,r+n.up)},i):this.forEachCenterVertex(function(i,r){t.push(i,r+1);t.push(i-n.right,r+n.up);t.push(i-n.right,r-n.up);t.push(i,r-1);t.push(i+n.right,r-n.up);t.push(i+n.right,r+n.up)},i),t},n.prototype.generateIndices=function(){for(var n,i=this.hexelsPerSection,r=s(1,12*i,Uint16Array),t=0;t<i;t++)n=t*o,r.push(n,n+1,n+2,n,n+2,n+3,n,n+3,n+4,n,n+4,n+5);return r},n.prototype.generateTexCoords=function(){for(var i,n,t,f=this.hexelsPerSection,r=s(2,o*f,Float32Array),e=this.grid.rows,h=this.grid.cols,c=0,u=0;u<e;u++)for(i=0;i<h;i++)if(n=i/h,t=u/e,r.push(n,t,n,t,n,t,n,t,n,t,n,t),++c===f)return r;return r},n.prototype.generateGradientAttribs=function(){for(var n=this.hexelsPerSection,t=s(1,o*n,Float32Array),i=18/256,r=32/256,u=50/256,f=0;f<n;f++)t.push(i,r,u,-i,-r,-u);return t},n.prototype.forEachCenterVertex=function(n,t){var c,r,l,i,s,h;t===void 0&&(t=this.grid.size);var e=this.grid,f=e.orientation,a=this.bounds.left+f.width/2,v=this.bounds.bottom+f.height/2,o=0;if(f===u.FlatTop){for(i=0;i<e.cols;i++)for(c=i/2-(i>>1),r=c;r<e.rows+c;r++)if(s=a+i*f.width*.75,h=v+r*f.height,n(s,h,o++),o===t)return}else for(r=0;r<e.rows;r++)for(l=r/2-(r>>1),i=l;i<e.cols+l;i++)if(s=a+i*f.width,h=v+r*f.height*.75,n(s,h,o++),o===t)return},n.prototype.cubeToClip=function(n){var t=this.grid.orientation,i=this.bounds.left+t.width/2,f=this.bounds.bottom+t.height/2;return this.grid.orientation===u.FlatTop?(i+=n.q*t.width*.75,f+=(n.r+n.q/2)*t.height):(i+=(n.q+n.r/2)*t.width,f+=n.r*t.height*.75),new r.Point(i,f)},n.prototype.clipToCube=function(n){var t=this.grid.orientation,i=n.x-(t.width/2+this.bounds.left),r=n.y-(t.height/2+this.bounds.bottom),u=t.inverse.mapX(i,r),e=t.inverse.mapY(i,r);return new f(u,e)},n.prototype.indexOfHexel=function(n){var t=this.clipToCube(n);return t.round(),this.grid.indexOfCube(t)},n.prototype.getColor=function(n){return this.hexels.getUint32(4*n,l)},n.prototype.setColor=function(n,t){this.hexels.setUint32(n*4,t,l)},n.prototype.mixColor=function(n,t){var i=this.getColor(n),u=r.blend(t,i);this.setColor(n,u)},n.prototype.addLine=function(n,t,i){var r=this;this.forEachCenterVertex(function(u,f,e){n.contains(u,f,t)&&r.mixColor(e,i)})},n.prototype.eraseLine=function(n,t){var i=this;this.forEachCenterVertex(function(r,u,f){n.contains(r,u,t)&&i.setColor(f,0)})},n.prototype.addShape=function(n,t){var i=this;this.forEachCenterVertex(function(r,u,f){n.contains(r,u)&&i.mixColor(f,t)})},n.prototype.eraseShape=function(n){var t=this;this.forEachCenterVertex(function(i,r,u){n.contains(i,r)&&t.setColor(u,0)})},n.prototype.addStroke=function(n,t,i,r){var u=this;c(n,t,i,function(n){var t=u.grid.indexOfCube(n);t!=-1&&u.mixColor(t,r)})},n.prototype.eraseStroke=function(n,t,i){var r=this;c(n,t,i,function(n){var t=r.grid.indexOfCube(n);t!=-1&&r.setColor(t,0)})},n.prototype.setRange=function(n,t,i){var r=this;h(n,t,function(n){var t=r.grid.indexOfCube(n);t!=-1&&r.mixColor(t,i)})},n.prototype.eraseRange=function(n,t){var i=this;h(n,t,function(n){var t=i.grid.indexOfCube(n);t!=-1&&i.setColor(t,0)})},n.prototype.floodFill=function(n,t){var i=this.getColor(n),u;t=r.blend(t,i);i!==t&&(u=this.grid.offsetAt(n),this.floodFillScanLine(u.x,u.y,t,i))},n.prototype.floodFillErase=function(n){var i=this.getColor(n),t;i!==0&&(t=this.grid.offsetAt(n),this.floodFillScanLine(t.x,t.y,0,i))},n.prototype.floodFillScanLine=function(n,t,i,u){var s,h,c,e,o,l=this.grid.cols,v=this.grid.rows,f=[],a=new r.Point(n,t);for(f.push(a);f.length>0;){for(a=f.pop(),n=a.x,t=a.y,s=t*l,h=s+l,c=s-l,e=!1,o=!1;n>=0&&this.getColor(n+s)==u;)n--;for((t&1)==0&&n>=0&&(t>0&&this.getColor(n+c)==u&&(f.push(new r.Point(n,t-1)),e=!0),t<v-1&&this.getColor(n+h)==u&&(f.push(new r.Point(n,t+1)),o=!0)),n++;n<l&&this.getColor(n+s)==u;n++)this.setColor(n+s,i),t>0&&(e||this.getColor(n+c)!=u?e&&this.getColor(n+c)!=u&&(e=!1):(f.push(new r.Point(n,t-1)),e=!0)),t<v-1&&(o||this.getColor(n+h)!=u?o&&this.getColor(n+h)!=u&&(o=!1):(f.push(new r.Point(n,t+1)),o=!0));t&1&&n<l&&(!e&&t>0&&this.getColor(n+c)==u&&f.push(new r.Point(n,t-1)),!o&&t<v-1&&this.getColor(n+h)==u&&f.push(new r.Point(n,t+1)))}},n.prototype.recursiveFloodFillScanLine=function(n,t,i,r){for(var e=this.grid.cols,h=this.grid.rows,f=t*e,o,s,u=n;u<e&&this.getColor(u+f)==r;u++)this.setColor(u+f,i);for(u=n-1;u>=0&&this.getColor(u+f)==r;u--)this.setColor(u+f,i);if(t>0){for(o=f-e,u=n;u<e&&this.getColor(u+f)==i;u++)this.getColor(u+o)==r&&this.recursiveFloodFillScanLine(u,t-1,i,r);for(t&1&&u<e&&this.getColor(u+o)==r&&this.recursiveFloodFillScanLine(u,t-1,i,r),u=n-1;u>=0&&this.getColor(u+f)==i;u--)this.getColor(u+o)==r&&this.recursiveFloodFillScanLine(u,t-1,i,r);(t&1)==0&&u>=0&&this.getColor(u+o)==r&&this.recursiveFloodFillScanLine(u,t-1,i,r)}if(t<h-1){for(s=f+e,u=n;u<e&&this.getColor(u+f)==i;u++)this.getColor(u+s)==r&&this.recursiveFloodFillScanLine(u,t+1,i,r);for(t&1&&u<e&&this.getColor(u+s)==r&&this.recursiveFloodFillScanLine(u,t+1,i,r),u=n-1;u>=0&&this.getColor(u+f)==i;u--)this.getColor(u+s)==r&&this.recursiveFloodFillScanLine(u,t+1,i,r);(t&1)==0&&u>=0&&this.getColor(u+s)==r&&this.recursiveFloodFillScanLine(u,t+1,i,r)}},n}();i.Layout=v;y=function(){function n(n,t,i){this.region=new r.Rect;this.matrix=twgl.m4.identity();this.zoom=1;this.pan=new r.Vec2;this.bounds=n;this.minZoom=t;this.maxZoom=i}return n.prototype.fillViewport=function(n,t){this.region.setRect(this.bounds);var u=this.bounds.width(),f=this.bounds.height(),i=n/t,r=u/f;r<i?this.region.scale(i/r,1):this.region.scale(1,r/i);this.region.stretch(1/this.zoom);this.region.offset(this.pan.x,this.pan.y);this.applyChangesToMatrix()},n.prototype.panByVector=function(n){this.applyChangeInPan(n);this.applyChangesToMatrix()},n.prototype.zoomToPoint=function(n,t){var f=this.region.pointAt(t.x,t.y),i,u;this.applyChangeInZoom(n);i=this.region.pointAt(t.x,t.y);u=r.Vec2.fromPointToPoint(i,f);this.applyChangeInPan(u);this.applyChangesToMatrix()},n.prototype.applyChangeInZoom=function(n){var t=this.zoom*n;t<this.minZoom?(n=this.minZoom/this.zoom,this.zoom=this.minZoom):t>this.maxZoom?(n=this.maxZoom/this.zoom,this.zoom=this.maxZoom):this.zoom=t;this.region.stretch(1/n)},n.prototype.applyChangeInPan=function(n){var i=new r.Vec2,t;i.add(this.pan);i.add(n);t=r.Rect.fromRect(this.bounds);t.mulScalar((this.zoom-this.minZoom)/this.zoom);t.offset(-t.centerX(),-t.centerY());i.x<t.left?n.x=t.left-this.pan.x:i.x>t.right&&(n.x=t.right-this.pan.x);i.y<t.bottom?n.y=t.bottom-this.pan.y:i.y>t.top&&(n.y=t.top-this.pan.y);this.region.offset(n.x,n.y);this.pan.add(n)},n.prototype.applyChangesToMatrix=function(){twgl.m4.ortho(this.region.left,this.region.right,this.region.bottom,this.region.top,.1,10,this.matrix)},n}();i.Projection=y;p=function(){function n(n,t,i,r){this.needToRender=!1;this.program=-1;this.rgba=[0,0,0,1];this.alpha=1;this.gl=n;this.layout=t;this.projection=i;this.packedMeshInfo=r}return Object.defineProperty(n.prototype,"color",{set:function(n){this.rgba[0]=(n>>24&255)/255;this.rgba[1]=(n>>16&255)/255;this.rgba[2]=(n>>8&255)/255;this.rgba[3]=(n>>0&255)/255;this.rgba[0]*=this.rgba[3];this.rgba[1]*=this.rgba[3];this.rgba[2]*=this.rgba[3]},enumerable:!0,configurable:!0}),n.prototype.onSurfaceCreated=function(){this.gl.clearColor(0,0,0,0);this.gl.cullFace(this.gl.BACK);this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA);this.ellipseShader=twgl.createProgramInfo(this.gl,["vs-ellipse","fs-ellipse"]);this.hexelShader=twgl.createProgramInfo(this.gl,["vs-hexel","fs-hexel"]);this.lineShader=twgl.createProgramInfo(this.gl,["vs-line","fs-line"]);this.polyShader=twgl.createProgramInfo(this.gl,["vs-poly","fs-poly"]);this.ellipseShader.bufferInfo=twgl.createBufferInfoFromArrays(this.gl,{indices:{numComponents:1,data:r.Mesh.generatePolygonIndices(4)},a_texCoord:{numComponents:2,data:new Float32Array([0,1,0,0,1,0,1,1])}});this.hexelShader.bufferInfo=twgl.createBufferInfoFromArrays(this.gl,{indices:this.layout.generateIndices(),a_position:this.layout.generateVertices(),a_texCoord:this.layout.generateTexCoords(),a_gradient:this.layout.generateGradientAttribs()});this.lineShader.bufferInfo=twgl.createBufferInfoFromArrays(this.gl,{indices:{numComponents:1,data:r.Mesh.generatePolygonIndices(4)},a_position:{numComponents:2,data:new Float32Array([0,.5,0,-.5,1,-.5,1,.5])}});this.polyShader.bufferInfo=twgl.createBufferInfoFromArrays(this.gl,{indices:{numComponents:1,data:this.packedMeshInfo.indices},a_position:{numComponents:2,data:this.packedMeshInfo.vertices}});this.texOptions={width:this.layout.grid.cols,height:this.layout.grid.rows,minMag:this.gl.NEAREST,wrap:this.gl.CLAMP_TO_EDGE,src:new Uint8Array(this.layout.hexels.buffer)};this.texture=twgl.createTexture(this.gl,this.texOptions)},n.prototype.onSurfaceChanged=function(n,t){this.gl.viewport(0,0,n,t);this.projection.fillViewport(n,t);this.needToRender=!0},n.prototype.onDrawFrame=function(){this.clear();this.renderLayout(this.layout);this.shape&&this.renderShape(this.shape);this.ellipse&&this.renderEllipse(this.ellipse);this.line&&this.renderLine(this.line)},n.prototype.clear=function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},n.prototype.renderLayout=function(n){var i,s;this.useShader(this.hexelShader)&&(this.gl.enable(this.gl.CULL_FACE),this.gl.disable(this.gl.BLEND));twgl.setUniforms(this.hexelShader,{u_tex:this.texture});var t=r.Rect.fromRect(this.projection.region),h=twgl.m4.identity(),e=0,o=0;n.grid.orientation==u.FlatTop?e=-n.sectionWidth():o=-n.sectionHeight();i=new Float32Array(2);i[0]=.5/n.grid.cols;i[1]=.5/n.grid.rows;var c=1/n.sections,a=n.clipToCube(new r.Point(0,t.bottom)).r-1,v=n.clipToCube(new r.Point(0,t.top)).r+1,l=n.hexelsPerSection/n.grid.cols,f=Math.max(0,Math.floor(a/l)),y=Math.min(n.sections,Math.ceil(v/l));for(t.offset(f*e,f*o),i[1]+=c*f,s=f;s<y;s++)twgl.m4.ortho(t.left,t.right,t.bottom,t.top,.1,10,h),twgl.setUniforms(this.hexelShader,{u_MVP:h,u_baseTexCoord:i}),twgl.drawBufferInfo(this.gl,this.hexelShader.bufferInfo),t.offset(e,o),i[1]+=c},n.prototype.renderShape=function(n){var t;this.useShader(this.polyShader)&&(this.gl.disable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND));t=[];t[0]=n.matrix.m11;t[1]=n.matrix.m21;t[2]=0;t[3]=n.matrix.m12;t[4]=n.matrix.m22;t[5]=0;t[6]=n.matrix.m13;t[7]=n.matrix.m23;t[8]=0;twgl.setUniforms(this.polyShader,{u_MVP:this.projection.matrix,u_shapeMatrix:t,u_color:this.rgba,u_alpha:this.alpha});var i=this.gl.TRIANGLES,r=n.mesh.indices.length,u=this.gl.UNSIGNED_SHORT,f=this.packedMeshInfo.meshes.indexOf(n.mesh),e=this.packedMeshInfo.offsets[f]*2;this.gl.drawElements(i,r,u,e)},n.prototype.renderEllipse=function(n){this.useShader(this.ellipseShader)&&this.gl.enable(this.gl.BLEND);var t=[];t[0]=n.left;t[1]=n.bottom;t[2]=n.width();t[3]=n.height();twgl.setUniforms(this.ellipseShader,{u_MVP:this.projection.matrix,u_rect:t,u_color:this.rgba});twgl.drawBufferInfo(this.gl,this.ellipseShader.bufferInfo)},n.prototype.renderLine=function(n){this.useShader(this.lineShader)&&this.gl.enable(this.gl.BLEND);var t=[];t[0]=n.x1;t[1]=n.y1;t[2]=n.x2;t[3]=n.y2;twgl.setUniforms(this.lineShader,{u_MVP:this.projection.matrix,u_color:this.rgba,u_thickness:this.lineThickness,u_line:t});twgl.drawBufferInfo(this.gl,this.lineShader.bufferInfo)},n.prototype.useShader=function(n){return this.program!=n.program?(this.gl.useProgram(n.program),this.program=n.program,twgl.setBuffersAndAttributes(this.gl,n,n.bufferInfo),!0):!1},n.prototype.applyColorChanges=function(){twgl.setTextureFromArray(this.gl,this.texture,this.texOptions.src,this.texOptions);this.needToRender=!0},n.prototype.applyLayoutChanges=function(){var n=this.gl,i=this.hexelShader.bufferInfo,t=this.hexelShader.bufferInfo.attribs,r=this.layout.generateIndices(),u=this.layout.generateVertices(),f=this.layout.generateTexCoords(),e=this.layout.generateGradientAttribs();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.indices);n.bufferData(n.ELEMENT_ARRAY_BUFFER,r,n.STATIC_DRAW);i.numElements=r.length;twgl.setAttribInfoBufferFromArray(n,t.a_position,u);twgl.setAttribInfoBufferFromArray(n,t.a_texCoord,f);twgl.setAttribInfoBufferFromArray(n,t.a_gradient,e);this.texOptions={width:this.layout.grid.cols,height:this.layout.grid.rows,minMag:this.gl.NEAREST,wrap:this.gl.CLAMP_TO_EDGE,src:new Uint8Array(this.layout.hexels.buffer)};this.gl.deleteTexture(this.texture);this.texture=twgl.createTexture(this.gl,this.texOptions);this.needToRender=!0},n.prototype.enableShadows=function(){twgl.setAttribInfoBufferFromArray(this.gl,this.hexelShader.bufferInfo.attribs.a_gradient,this.layout.generateGradientAttribs());this.needToRender=!0},n.prototype.disableShadows=function(){twgl.setAttribInfoBufferFromArray(this.gl,this.hexelShader.bufferInfo.attribs.a_gradient,new Float32Array(this.layout.hexelsPerSection*o));this.needToRender=!0},n}();i.Renderer=p;w=function(){function n(n,t){this.canvas=n;this.renderer=t;this.bb=n.getBoundingClientRect();var i=this.canvas.clientWidth,r=this.canvas.clientHeight;this.renderer.onSurfaceCreated();this.renderer.onSurfaceChanged(i,r)}return n.prototype.requestRender=function(){this.renderer.needToRender=!0},n.prototype.resize=function(){var i=window.devicePixelRatio,n=Math.floor(this.canvas.clientWidth*i),t=Math.floor(this.canvas.clientHeight*i);if(this.canvas.width!==n||this.canvas.height!==t){this.canvas.width=n;this.canvas.height=t;this.bb=this.canvas.getBoundingClientRect();this.renderer.onSurfaceChanged(n,t);return!0}return!1},n.prototype.screenToCanvas=function(n,t){return t===void 0&&(t=new r.Point),t.x=n.x-this.bb.left,t.y=n.y-this.bb.top,t},n.prototype.screenToNdc=function(n,t){return t===void 0&&(t=new r.Point),this.screenToCanvas(n,t),this.canvasToNdc(t,t),t},n.prototype.screenToClip=function(n,t){return t===void 0&&(t=new r.Point),this.screenToCanvas(n,t),this.canvasToNdc(t,t),this.ndcToClip(t,t),t},n.prototype.canvasToNdc=function(n,t){t===void 0&&(t=new r.Point);var u=this.canvas.clientWidth,i=this.canvas.clientHeight;return t.x=n.x/u,t.y=(i-n.y)/i,t},n.prototype.ndcToClip=function(n,t){return t===void 0&&(t=new r.Point),this.renderer.projection.region.pointAt(n.x,n.y,t)},n}();i.Surface=w;i.forEachCubeInRange=h;i.forEachCubeInLine=c},{"./graphics2d":1}],3:[function(n){"use strict";function a(n,t){n!=o&&($(ot).children("i").addClass("md-inactive").removeClass("md-active"),$(t).children("i").addClass("md-active").removeClass("md-inactive"),lt=o,at=ot,o=n,ot=t)}function yt(){(e.resize()||t.needToRender)&&(t.needToRender=!1,t.onDrawFrame());requestAnimationFrame(yt)}function pt(n){n.preventDefault();n.stopPropagation();var i=n.detail<0||n.wheelDelta>0,r=i?1.5:.666666,u=e.screenToNdc(n);t.projection.zoomToPoint(r,u);t.needToRender=!0}function bt(n){for(var t=-1;n!=0;)n>>=1,t++;return t}function ii(n,t){var i=new FileReader;i.onload=function(n){var i=new Image;i.onload=function(){t(i)};i.src=n.target.result};i.readAsDataURL(n)}function ri(n,t,r,u,f,e,o){u===void 0&&(u=0);f===void 0&&(f=0);e===void 0&&(e=i.cols);o===void 0&&(o=i.rows);t.clearRect(0,0,n.width,n.height);t.drawImage(r,0,0,r.width,r.height,u,f,e,o)}function ui(n,r,f){for(var e,c,h,l,a=r.getImageData(0,0,i.cols,i.rows).data,v=new DataView(a.buffer),o=0,s=n.height-1;s>=0;s--)for(e=0;e<n.width;e++,o++)c=n.width*s+e,h=v.getUint32(c*4,!1),h!=0&&(l=u.blend(h,f.getColor(o)),f.setColor(o,l));t.applyColorChanges()}function fi(n,t,r){for(var s,c,u=new Uint8ClampedArray(n.hexels.buffer),f=new Uint8ClampedArray(u.byteLength),o=0,e=0,h=i.rows-1;h>=0;h--)for(s=0;s<i.cols;s++)e=(t.width*h+s)*4,f[e++]=u[o++],f[e++]=u[o++],f[e++]=u[o++],f[e++]=u[o++];c=new ImageData(f,i.cols,i.rows);r.clearRect(0,0,t.width,t.height);r.putImageData(c,0,0)}var u=n("./graphics2d"),h=n("./hexel"),ti,c,w,b,it,wt,rt;vex.defaultOptions.className="vex-theme-wireframe";var l=document.getElementById("onscreen-canvas"),kt=twgl.getWebGLContext(l),f=8388863,v=0,k=1,y=!0,p=!0,d=8,g=8,ut="hexel-art",i=new h.Grid(1<<d,1<<g,h.Orientation.PointyTop),r=new h.Layout(i),nt=new h.Projection(r.bounds,1,Math.max(i.rows,i.cols)),ft=[u.Mesh.polygon(3),u.Mesh.square(),u.Mesh.diamond(),u.Mesh.polygon(5),u.Mesh.polygon(6),u.Mesh.star5(),u.Mesh.heart(),u.Mesh.flower(),u.Mesh.bat(),],t=new h.Renderer(kt,r,nt,u.PackedMeshInfo.fromMeshes(ft)),e=new h.Surface(l,t),s=document.getElementById("offscreen-canvas"),et=s.getContext("2d");s.width=i.cols;s.height=i.rows;var ei={onPanStart:function(n){this.previous=e.screenToClip(n.center)},onPan:function(n){if(this.previous){var i=e.screenToClip(n.center),r=u.Vec2.fromPointToPoint(i,this.previous);t.projection.panByVector(r);t.needToRender=!0;this.previous.x=i.x+r.x;this.previous.y=i.y+r.y}},onPanEnd:function(){this.previous=null}},st={onTap:function(n){var u=e.screenToClip(n.center),o=r.indexOfHexel(u),i;o!==-1&&(i=r.clipToCube(u),i.round(),r.setRange(i,v,f),t.applyColorChanges())},onPanStart:function(n){var t=e.screenToClip(n.center);this.previous=r.clipToCube(t);this.previous.round()},onPan:function(n){var i,u;this.previous&&(i=r.clipToCube(e.screenToClip(n.center)),i.round(),u=i.distanceToCube(this.previous),u>0&&(f==-1?r.eraseStroke(this.previous,i,v):r.addStroke(this.previous,i,v,f),t.applyColorChanges(),this.previous=i))},onPanEnd:function(){this.previous=null}},dt={onTap:function(n){if(!t.needToRender){var u=e.screenToClip(n.center),i=r.indexOfHexel(u);i!==-1&&(f==-1?r.floodFillErase(i):r.floodFill(i,f),t.applyColorChanges())}},onPanStart:function(n){this.onTap(n)}},gt={onTap:function(n){this.onPan(n);this.onPanEnd(n)},onPan:function(n){var o=e.screenToClip(n.center),i=r.indexOfHexel(o);i!=-1&&(f=r.getColor(i),w=b=(f&255)/255,$("#color-picker").spectrum("set",u.rgbaToString(f)),t.color=f)},onPanEnd:function(){a(lt,at)}},ni={onPanStart:function(n){this.start=e.screenToClip(n.center)},onPan:function(n){if(this.start){var i=e.screenToClip(n.center);t.line=u.Line.fromPointToPoint(this.start,i);t.needToRender=!0}},onPanEnd:function(){this.start=null;t.line&&(f==-1?r.eraseLine(t.line,t.lineThickness):r.addLine(t.line,t.lineThickness,f),t.line=null,t.applyColorChanges())}},ht={onPanStart:function(n){this.start=e.screenToClip(n.center)},onPan:function(n){if(this.start){var r=e.screenToClip(n.center),i=u.Rect.fromPointToPoint(this.start,r);y&&i.expandToSquare();t.ellipse=i;t.needToRender=!0}},onPanEnd:function(){if(this.start=null,t.ellipse){var n=u.Ellipse.fromRect(t.ellipse);f==-1?r.eraseShape(n):r.addShape(n,f);t.ellipse=null;t.applyColorChanges()}}},ct={onPanStart:function(n){this.start=e.screenToClip(n.center)},onPan:function(n){var i;if(this.start){if(i=e.screenToClip(n.center),t.shape||(t.shape=new u.Shape(vt)),y)t.shape.stretchAcrossLine(this.start,i);else{var r=this.start,f=i,o=u.Rect.fromLBRT(f.x,f.y,r.x,r.y);t.shape.fitInRect(o,2)}t.needToRender=!0}},onPanEnd:function(){this.start=null;t.shape&&(f==-1?r.eraseShape(t.shape):r.addShape(t.shape,f),t.shape=null,t.applyColorChanges())}},o=st,ot="#brush",lt=o,at="#brush",vt=ft[0],tt="icon-circle";yt();l.addEventListener("DOMMouseScroll",pt,!1);l.addEventListener("mousewheel",pt,!1);ti=1;c=new Hammer.Manager(l);c.add(new Hammer.Tap);c.add(new Hammer.Pan({direction:Hammer.DIRECTION_ALL,threshold:0}));c.add(new Hammer.Pinch({enable:!0}));c.on("tap",function(n){if(o.onTap)o.onTap(n)});c.on("panstart",function(n){if(o.onPanStart)o.onPanStart(n)});c.on("pan",function(n){if(o.onPan)o.onPan(n)});c.on("panend",function(n){if(o.onPanEnd)o.onPanEnd(n)});c.on("pinch",function(n){var i=e.canvasToNdc(n.center);t.projection.zoomToPoint(n.scale,i);t.needToRender=!0});w=1;b=1;t.color=f;$("#color-picker").spectrum({color:"#008000",flat:!1,showInput:!1,showInitial:!1,allowEmpty:!1,showAlpha:!0,disabled:!1,showPalette:!0,showPaletteOnly:!0,togglePaletteOnly:!0,showSelectionPalette:!1,clickoutFiresChange:!0,hideAfterPaletteSelect:!0,preferredFormat:"rgb",palette:[["#000","#444","#666","#999","#ccc","#eee","#f3f3f3","#fff"],["#f00","#f90","#ff0","#0f0","#0ff","#00f","#90f","#f0f"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"],["#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6fa8dc","#8e7cc3","#c27ba0"],["#c00","#e69138","#f1c232","#6aa84f","#45818e","#3d85c6","#674ea7","#a64d79"],["#900","#b45f06","#bf9000","#38761d","#134f5c","#0b5394","#351c75","#741b47"],["#600","#783f04","#7f6000","#274e13","#0c343d","#073763","#20124d","#4c1130"]],change:function(n){if(n){w=b;n.setAlpha(w);var i=n.toHex8String();$(this).spectrum("set",i);f=u.stringToRgba(i);t.color=f}else f=-1,t.color=255},hide:function(){b=w}});$("#color-picker").on("dragstop.spectrum",function(n,t){b=t.getAlpha()});for($("#brush").click(function(){a(st,"#brush")}),$("#line").click(function(){a(ni,"#line")}),$("#color-sampler").click(function(){a(gt,"#color-sampler")}),$("#paint-bucket").click(function(){a(dt,"#paint-bucket")}),$("#shape").click(function(){$(this).children("i").hasClass("icon-circle")?a(ht,"#shape"):a(ct,"#shape")}),$("#circle").click(function(){o=ht;var n="icon-circle";$("#shape").children("i").removeClass(tt).addClass(n);tt=n}),it=["triangle","square","diamond","pentagon","hexagon","star","heart","flower","bat"],wt=function(n){$("#"+it[n]).click(function(){o=ct;vt=ft[n];var t="icon-"+it[n];$("#shape").children("i").removeClass(tt).addClass(t);tt=t})},rt=0;rt<it.length;rt++)wt(rt);t.lineThickness=1.5;$("#options").click(function(){vex.dialog.open({message:"Options",input:'\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n        <label for="enableShadows">Enable shadows:<\/label>\n        <input name="enableShadows" type="checkbox" '+(p?"checked":"")+'/>\n    <\/div>\n<\/div>\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n        <label for="maintainAspect">Maintain shape ratios:<\/label>\n        <input name="maintainAspect" type="checkbox" '+(y?"checked":"")+'/>\n    <\/div>\n<\/div>\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n        <label for="brushRadius">Brush radius:<\/label>\n        <input name="brushRadius" type="number" min="0" max="15"/>\n    <\/div>\n<\/div>\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n        <label for="lineThickness">Line width:<\/label>\n        <input name="lineThickness" type="number" min="1" max="100" />\n    <\/div>\n<\/div>\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n          <label for="gridWidth">Grid width:<\/label>\n          <input name="gridWidth" type="number" min="5" max="10" />\n    <\/div>\n<\/div>\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n          <label for="gridHeight">Grid height:<\/label>\n          <input name="gridHeight" type="number" min="5" max="10" />\n    <\/div>\n<\/div>\n',callback:function(n){var u,f;if(n){if(n.brushRadius!==v&&(v=parseInt(n.brushRadius)),n.lineThickness!==k&&(k=parseInt(n.lineThickness),t.lineThickness=1.5*k),n.gridWidth!=d||n.gridHeight!=g){d=parseInt(n.gridWidth);g=parseInt(n.gridHeight);var e=s.width=1<<d,o=s.height=1<<g,a=new Uint32Array(r.hexels.buffer),c=new Uint32Array(e*o),w=Math.min(o,i.rows),b=Math.min(e,i.cols);for(u=0;u<w;u++)for(f=0;f<b;f++)c[u*e+f]=a[u*i.cols+f];i=new h.Grid(e,o);r=new h.Layout(i,c.buffer);nt=new h.Projection(r.bounds,1,Math.max(i.rows,i.cols));nt.fillViewport(l.clientWidth,l.clientHeight);t.projection=nt;t.layout=r;t.applyLayoutChanges()}y=n.maintainAspect?!0:!1;n.enableShadows?p||(t.enableShadows(),p=!0):p&&(t.disableShadows(),p=!1)}}});$("input[name=brushRadius]").slider({min:0,max:15,step:1,value:v,tooltip:"show"});$("input[name=lineThickness]").slider({min:1,max:100,step:1,value:k,tooltip:"show"});$("input[name=gridWidth]").slider({ticks:[5,6,7,8,9,10],ticks_labels:["32","64","128","256","512","1024"],min:5,max:10,step:1,value:bt(i.cols),tooltip:"hide"});$("input[name=gridHeight]").slider({ticks:[5,6,7,8,9,10],ticks_labels:["32","64","128","256","512","1024"],min:5,max:10,step:1,value:bt(i.rows),tooltip:"hide"})});$("#upload").click(function(){var n;vex.dialog.open({message:"Upload image onto this "+i.cols+"x"+i.rows+" grid.",input:'\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n        <label for="imagefile">Image:<\/label>\n        <input name="imagefile" type="file" accept="image/*" required>\n    <\/div>\n    <div class="vex-custom-input-wrapper">\n        <label for="x">X (hexels from left):<\/label>\n        <input name="x" type="number" min="0" max="'+i.cols+'">\n    <\/div>\n    <div class="vex-custom-input-wrapper">\n        <label for="y">Y (hexels from top):<\/label>\n        <input name="y" type="number" min="0" max="'+i.rows+'">\n    <\/div>\n    <div class="vex-custom-input-wrapper">\n        <label for="width">Width (in hexels):<\/label>\n        <input name="width" type="number" min="0">\n    <\/div>\n    <div class="vex-custom-input-wrapper">\n        <label for="height">Height (in hexels):<\/label>\n        <input name="height" type="number" min="0">\n    <\/div>\n<\/div>\n',callback:function(t){if(n&&t){var i=t.x,u=t.y,f=t.width,e=t.height;ri(s,et,n,i,u,f,e);ui(s,et,r)}n=null}});$("input[name=imagefile]").change(function(t){if(t.target.files[0]){var i=t.target.files[0];ii(i,function(t){var f=s.width/t.width,e=s.height/t.height,i=Math.min(f,e),r=Math.round(t.width*i),u=Math.round(t.height*i),o=Math.round((s.width-r)/2),h=Math.round((s.height-u)/2);$("input[name=x]").val(o);$("input[name=y]").val(h);$("input[name=width]").val(r);$("input[name=height]").val(u);n=t})}})});$("#download").click(function(){vex.dialog.open({message:"Download hexel art as a "+i.cols+"x"+i.rows+" image file.",input:'\n<div class="vex-custom-field-wrapper">\n    <div class="vex-custom-input-wrapper">\n        <label for="filename">Filename:<\/label>\n        <input name="filename" type="text" value="'+ut+'"/>\n    <\/div>\n<\/div>\n<p> Note: an image viewer will interpret the file as pixel art, but if you reupload the file to this app, you will be able to view and modify the original hexel art.<\/p>\n',callback:function(n){n&&n.filename&&(ut=n.filename,fi(r,s,et),s.toBlob(function(n){saveAs(n,ut,!0)},"image/png"))}})})},{"./graphics2d":1,"./hexel":2}]},{},[3]);